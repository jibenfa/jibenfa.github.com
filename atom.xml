<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

 <title>Welcome to Coffeecatâ€˜s Blog</title>
 <link href="https://jibenfa.github.io/atom.xml" rel="self"/>
 <link href="https://jibenfa.github.io"/>
 <updated>2025-09-08T05:48:28+00:00</updated>
 <id>https://jibenfa.github.io</id>
 <author>
   <name>Coffeecat</name>
   <email></email>
 </author>

 
 <entry>
   <title>æç®€v2rayæµé‡ç»Ÿè®¡é¢æ¿</title>
   <link href="https://jibenfa.github.io/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/2025/09/02/E69E81E7AE80v2rayE6B581E9878FE7BB9FE8AEA1E99DA2E69DBF/"/>
   <updated>2025-09-02T00:12:13+00:00</updated>
   <id>https://jibenfa.github.io/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/2025/09/02/E69E81E7AE80v2rayE6B581E9878FE7BB9FE8AEA1E99DA2E69DBF</id>
   <content type="html">&lt;p&gt;v2rayè‡ªå¸¦æµé‡ç»Ÿè®¡åŠŸèƒ½ï¼Œæ‰§è¡Œå¦‚ä¸‹è¯­å¥å°±èƒ½è·å¾—å®æ—¶ç´¯è®¡æµé‡ï¼ˆéœ€æ‰“å¼€æµé‡ç»Ÿè®¡é…ç½®ï¼Œè¯¦è§ä¸‹é¢æ­¥éª¤1ï¼‰ï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
/usr/bin/v2ray/v2ray api stats &lt;span class=&quot;nt&quot;&gt;--server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;127.0.0.1:10085

    Value       Name
1   22.62KB     inbound&amp;gt;&amp;gt;&amp;gt;api&amp;gt;&amp;gt;&amp;gt;traffic&amp;gt;&amp;gt;&amp;gt;downlink
2   13.01KB     inbound&amp;gt;&amp;gt;&amp;gt;api&amp;gt;&amp;gt;&amp;gt;traffic&amp;gt;&amp;gt;&amp;gt;uplink
3   26.40MB     inbound&amp;gt;&amp;gt;&amp;gt;main&amp;gt;&amp;gt;&amp;gt;traffic&amp;gt;&amp;gt;&amp;gt;downlink
4   11.36MB     inbound&amp;gt;&amp;gt;&amp;gt;main&amp;gt;&amp;gt;&amp;gt;traffic&amp;gt;&amp;gt;&amp;gt;uplink
5   10.92MB     user&amp;gt;&amp;gt;&amp;gt;home&amp;gt;&amp;gt;&amp;gt;traffic&amp;gt;&amp;gt;&amp;gt;downlink
6   4.51MB      user&amp;gt;&amp;gt;&amp;gt;home&amp;gt;&amp;gt;&amp;gt;traffic&amp;gt;&amp;gt;&amp;gt;uplink
7   15.47MB     user&amp;gt;&amp;gt;&amp;gt;mobile&amp;gt;&amp;gt;&amp;gt;traffic&amp;gt;&amp;gt;&amp;gt;downlink
8   6.76MB      user&amp;gt;&amp;gt;&amp;gt;mobile&amp;gt;&amp;gt;&amp;gt;traffic&amp;gt;&amp;gt;&amp;gt;uplink

Total: 75.45MB

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ä½†æ˜¯é‡å¯æœåŠ¡ä»¥åï¼Œæµé‡å°±æ¸…é›¶äº†ï¼Œä¸ºäº†æŒä¹…åŒ–ï¼Œæˆ‘åšäº†ä¸€ä¸ªæç®€çš„ç»Ÿè®¡v2rayæµé‡çš„webé¢æ¿ï¼Œæ”¯æŒæŒ‰ç”¨æˆ·ç»Ÿè®¡ï¼Œæ¯æœˆåˆæ¸…é›¶ï¼Œå¹¶é€šè¿‡å£ä»¤æ§åˆ¶è®¿é—®æƒé™ã€‚&lt;/p&gt;

&lt;p&gt;çº¯é™æ€é¡µé¢ï¼åªéœ€è¦å®‰è£…python3å’Œä»»ä¸€ä¸€ä¸ªwebæœåŠ¡ç«¯å³å¯ï¼Œæˆ‘è¿™é‡Œç”¨çš„æ˜¯nginxã€‚&lt;/p&gt;

&lt;p&gt;æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;1.ä¿®æ”¹v2rayé…ç½®æ–‡ä»¶ï¼Œå¢åŠ æµé‡ç»Ÿè®¡ï¼ˆæ³¨æ„ï¼šé…ç½®æ–‡ä»¶ä¸­çš„emailæ˜¯å¿…é¡»çš„ï¼Œç”¨äºåŒºåˆ†ä¸åŒç”¨æˆ·çš„æµé‡ï¼‰ï¼š&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
{
  &quot;stats&quot;: {},
  &quot;api&quot;: {
    &quot;tag&quot;: &quot;api&quot;,
    &quot;services&quot;: [
      &quot;StatsService&quot;
    ]
  },
  &quot;policy&quot;: {
    &quot;levels&quot;: {
      &quot;0&quot;: {
        &quot;statsUserUplink&quot;: true,
        &quot;statsUserDownlink&quot;: true
      }
    },
    &quot;system&quot;: {
      &quot;statsInboundUplink&quot;: true,
      &quot;statsInboundDownlink&quot;: true
    }
  },
  &quot;inbounds&quot;: [
    {
      &quot;port&quot;: 23456,
      &quot;listen&quot;:&quot;127.0.0.1&quot;,
      &quot;protocol&quot;: &quot;vless&quot;,
      &quot;settings&quot;: {
        &quot;clients&quot;: [
          {
            &quot;email&quot;: &quot;user1&quot;,
            &quot;id&quot;: &quot;****************uuid1****************&quot;
          },
          {
            &quot;email&quot;: &quot;user2&quot;,
            &quot;id&quot;: &quot;****************uuid2****************&quot;
          },
          {
            &quot;email&quot;: &quot;user3&quot;,
            &quot;id&quot;: &quot;****************uuid3****************&quot;
          }
        ],
        &quot;decryption&quot;: &quot;none&quot;
      },
      &quot;streamSettings&quot;: {
        &quot;network&quot;: &quot;ws&quot;,
        &quot;wsSettings&quot;: {
        &quot;path&quot;: &quot;/mypath&quot;
        }
      },
      &quot;tag&quot;: &quot;main&quot;
    },
    {
      &quot;tag&quot;: &quot;api&quot;,
      &quot;protocol&quot;: &quot;dokodemo-door&quot;,
      &quot;listen&quot;: &quot;127.0.0.1&quot;,
      &quot;port&quot;: 10085,
      &quot;settings&quot;: {
        &quot;address&quot;: &quot;127.0.0.1&quot;
      }
    }
  ],
  &quot;outbounds&quot;: [
    {
      &quot;protocol&quot;: &quot;socks&quot;,
      &quot;settings&quot;: {
        &quot;servers&quot;: [
          {
            &quot;address&quot;: &quot;127.0.0.1&quot;,
            &quot;port&quot;: 40000
          }
        ]
      },
      &quot;tag&quot;: &quot;warp&quot;
    },
    {
      &quot;protocol&quot;: &quot;freedom&quot;,
      &quot;tag&quot;: &quot;direct&quot;
    }
  ],
  &quot;routing&quot;: {
    &quot;domainStrategy&quot;: &quot;AsIs&quot;,
    &quot;rules&quot;: [
      {
        &quot;type&quot;: &quot;field&quot;,
        &quot;inboundTag&quot;:[&quot;main&quot;],
        &quot;outboundTag&quot;: &quot;direct&quot;,
        &quot;domain&quot;: [
          &quot;geosite:netflix&quot;,
          &quot;geosite:youtube&quot;,
          &quot;openai.com&quot;,
          &quot;*.openai.com&quot;,
          &quot;chatgpt.com&quot;,
          &quot;*.chatgpt.com&quot;
        ]
      },
      {
        &quot;type&quot;: &quot;field&quot;,
        &quot;inboundTag&quot;:[&quot;main&quot;],
        &quot;outboundTag&quot;: &quot;direct&quot;,
        &quot;ip&quot;: [
            &quot;127.0.0.1&quot;, 
            &quot;::1&quot;,
            &quot;8.8.8.8&quot;,
            &quot;8.8.4.4&quot;,
            &quot;1.1.1.1&quot;
        ]
      },
      {
        &quot;type&quot;:&quot;field&quot;,
        &quot;inboundTag&quot;:[&quot;main&quot;],
        &quot;outboundTag&quot;:&quot;warp&quot;,
        &quot;network&quot;:&quot;tcp,udp&quot;
      },
      {
        &quot;type&quot;: &quot;field&quot;,
        &quot;inboundTag&quot;: [&quot;api&quot;],
        &quot;outboundTag&quot;: &quot;api&quot;
      }
    ]
  }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2.åœ¨nginxé¡µé¢æ ¹ç›®å½•ä¸‹åˆ›å»ºindex.htmlï¼Œæˆ‘è¿™é‡Œæ˜¯ubuntuï¼Œè·¯å¾„æ˜¯ï¼š/usr/share/nginx/html/ ï¼Œå†…å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html lang=&quot;zh-CN&quot;&amp;gt;
&amp;lt;head&amp;gt;
&amp;lt;meta charset=&quot;utf-8&quot;&amp;gt;
&amp;lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&amp;gt;
&amp;lt;title&amp;gt;ç™»å½•&amp;lt;/title&amp;gt;
&amp;lt;link href=&quot;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css&quot; rel=&quot;stylesheet&quot;&amp;gt;
&amp;lt;style&amp;gt;
* { box-sizing: border-box; }
body {
    font-family: &apos;Arial&apos;, sans-serif;
    background: linear-gradient(135deg, #6fb1fc, #4364f7);
    margin: 0;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
}
.login-container, .stats-container {
    background: #fff;
    padding: 40px 30px;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    width: 100%;
    max-width: 600px;
    text-align: center;
}
h2 {
    margin-bottom: 25px;
    color: #4364f7;
    font-size: 24px;
}
.input-group {
    position: relative;
    margin-bottom: 20px;
    width: 100%;
}
.input-group i {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: #888;
    pointer-events: none;
}
input[type=&quot;password&quot;] {
    width: 100%;
    padding: 12px 12px 12px 36px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 16px;
    transition: border 0.3s, box-shadow 0.3s;
}
input[type=&quot;password&quot;]:focus {
    outline: none;
    border-color: #4364f7;
    box-shadow: 0 0 5px rgba(67,100,247,0.5);
}
button {
    width: 100%;
    padding: 12px;
    background-color: #4364f7;
    border: none;
    border-radius: 6px;
    color: #fff;
    font-size: 16px;
    cursor: pointer;
    transition: background 0.3s, transform 0.2s;
}
button:hover {
    background-color: #6fb1fc;
    transform: translateY(-2px);
}
.footer {
    margin-top: 15px;
    font-size: 13px;
    color: #888;
}
.stats-content {
    text-align: left;
    max-height: 70vh;
    overflow: auto;
}
.stats-content table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}
.stats-content th, .stats-content td {
    border: 1px solid #ddd;
    padding: 8px;
}
.stats-content th {
    background: #4364f7;
    color: white;
}
.stats-content tr:nth-child(even) { background: #f9f9f9; }
.stats-content tr:hover { background: #e9f5ff; }
&amp;lt;/style&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;
&amp;lt;div class=&quot;login-container&quot; id=&quot;loginBox&quot;&amp;gt;
    &amp;lt;h2&amp;gt;&amp;lt;i class=&quot;fas fa-shield-alt&quot;&amp;gt;&amp;lt;/i&amp;gt; ç™»å½•&amp;lt;/h2&amp;gt;
    &amp;lt;div class=&quot;input-group&quot;&amp;gt;
        &amp;lt;i class=&quot;fas fa-key&quot;&amp;gt;&amp;lt;/i&amp;gt;
        &amp;lt;input type=&quot;password&quot; id=&quot;key&quot; placeholder=&quot;è¯·è¾“å…¥å£ä»¤&quot;&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;button onclick=&quot;decrypt()&quot;&amp;gt;éªŒè¯&amp;lt;/button&amp;gt;
    &amp;lt;div class=&quot;footer&quot;&amp;gt;è¯·è¾“å…¥å£ä»¤&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;

&amp;lt;div class=&quot;stats-container&quot; id=&quot;statsBox&quot; style=&quot;display:none;&quot;&amp;gt;
    &amp;lt;div class=&quot;stats-content&quot; id=&quot;statsContent&quot;&amp;gt;
        &amp;lt;!-- è§£å¯†åçš„å†…å®¹ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ --&amp;gt;
    &amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;

&amp;lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js&quot;&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;script&amp;gt;
let lastAttempt = 0;          // ä¸Šæ¬¡è§£å¯†å°è¯•æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
let attemptTimes = [];        // æœ€è¿‘å°è¯•æ—¶é—´æˆ³æ•°ç»„

const MAX_ATTEMPTS = 5;       // 1 åˆ†é’Ÿå†…æœ€å¤§å°è¯•æ¬¡æ•°
const TIME_WINDOW = 60000;    // 1 åˆ†é’Ÿçª—å£ï¼ˆæ¯«ç§’ï¼‰
const MIN_INTERVAL = 2000;    // æœ€å°é—´éš” 2 ç§’

document.getElementById(&quot;key&quot;).addEventListener(&quot;keyup&quot;, function(event) {
    if (event.key === &quot;Enter&quot;) decrypt();
});

async function decrypt() {
    const now = Date.now();

    // é™åˆ¶è¿ç»­ç‚¹å‡»é—´éš”
    if (now - lastAttempt &amp;lt; MIN_INTERVAL) {
        alert(&quot;æ“ä½œå¤ªé¢‘ç¹ï¼Œè¯·ç¨å€™å†è¯•&quot;);
        return;
    }
    lastAttempt = now;

    // æ¸…ç† 1 åˆ†é’Ÿå‰çš„è®°å½•
    attemptTimes = attemptTimes.filter(t =&amp;gt; now - t &amp;lt; TIME_WINDOW);

    // æ£€æŸ¥ 1 åˆ†é’Ÿå†…å°è¯•æ¬¡æ•°
    if (attemptTimes.length &amp;gt;= MAX_ATTEMPTS) {
        alert(&quot;å°è¯•æ¬¡æ•°è¿‡å¤šï¼Œè¯·ç¨å€™å†è¯•&quot;);
        return;
    }
    attemptTimes.push(now);

    const keyInput = document.getElementById(&quot;key&quot;).value;
    if (!keyInput) return alert(&quot;è¯·è¾“å…¥å£ä»¤&quot;);

    try {
        const resp = await fetch(&quot;encrypt.txt&quot;);
        const b64 = await resp.text();
        const raw = CryptoJS.enc.Base64.parse(b64);
        const rawHex = raw.toString(CryptoJS.enc.Hex);

        const iv = CryptoJS.enc.Hex.parse(rawHex.slice(0, 32));
        const ct = CryptoJS.enc.Hex.parse(rawHex.slice(32));

        const keyStr = keyInput.padEnd(16, &quot;\0&quot;).slice(0,16);
        const key = CryptoJS.enc.Utf8.parse(keyStr);

        const decrypted = CryptoJS.AES.decrypt({ciphertext: ct}, key, {
            iv: iv,
            mode: CryptoJS.mode.CBC,
            padding: CryptoJS.pad.Pkcs7
        });
        const decoded = decrypted.toString(CryptoJS.enc.Utf8);
        if (!decoded) throw &quot;éªŒè¯å¤±è´¥&quot;;

        // éšè—ç™»å½•æ¡†ï¼Œæ˜¾ç¤ºç»Ÿè®¡å®¹å™¨
        document.getElementById(&quot;loginBox&quot;).style.display = &quot;none&quot;;
        const statsBox = document.getElementById(&quot;statsBox&quot;);
        statsBox.style.display = &quot;block&quot;;

        // é˜² XSSï¼šåªæ’å…¥æ–‡æœ¬å†…å®¹ï¼Œä¸æ‰§è¡Œ HTML
        const statsContent = document.getElementById(&quot;statsContent&quot;);
        statsContent.textContent = decoded;

        // ä½¿ç”¨ DOMParser + åˆ›å»ºå…ƒç´ æ–¹å¼ï¼Œç¡®ä¿å®‰å…¨
        const parser = new DOMParser();
        const doc = parser.parseFromString(decoded, &quot;text/html&quot;);
        const bodyElems = doc.body ? Array.from(doc.body.children) : [];
        statsContent.innerHTML = &apos;&apos;; // æ¸…ç©º
        bodyElems.forEach(el =&amp;gt; statsContent.appendChild(el.cloneNode(true)));

    } catch(e) {
        alert(&quot;éªŒè¯å¤±è´¥ï¼Œå£ä»¤é”™è¯¯&quot;);
        console.error(e);
    }
}
&amp;lt;/script&amp;gt;
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3.åˆ›å»ºpythonæ–‡ä»¶v2ray-stats.pyï¼Œæ”¾åœ¨/rootä¸‹ï¼Œæ–‡ä»¶ä¸­çš„keyå°±æ˜¯è®¿é—®å£ä»¤ï¼ˆé»˜è®¤123456ï¼‰ï¼Œå¯ä»¥æ”¹æˆè‡ªå·±çš„ï¼š&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

from Cryptodome.Cipher import AES
from Cryptodome.Util.Padding import pad, unpad
from Cryptodome.Random import get_random_bytes
import base64
import subprocess
import datetime
import os

API_CMD = [&quot;/usr/bin/v2ray/v2ray&quot;, &quot;api&quot;, &quot;stats&quot;, &quot;--server=127.0.0.1:10085&quot;]
DATA_FILE = &quot;/var/lib/v2ray-stats/data.db&quot;
HTML_FILE = &quot;/root/plaintext.html&quot;
OUTPUT_FILE = &quot;/usr/share/nginx/html/encrypt.txt&quot;
#ç™»å½•å¯†é’¥
key = b&quot;123456&quot;

os.makedirs(os.path.dirname(DATA_FILE), exist_ok=True)
now = datetime.datetime.now()

# æ¯æœˆ1æ—¥0ç‚¹æ¸…é›¶ data.db
if now.day == 1 and now.hour == 0:
    open(DATA_FILE, &quot;w&quot;).close()
    subprocess.run([&quot;systemctl&quot;, &quot;restart&quot;, &quot;v2ray&quot;], check=True)

# è¯»å–æ—§æ•°æ®
OLD = {}  # name -&amp;gt; (total_bytes, last_api_bytes)
if os.path.exists(DATA_FILE):
    with open(DATA_FILE, &quot;r&quot;) as f:
        for line in f:
            parts = line.strip().split()
            if len(parts) == 3:
                name, total_str, last_str = parts
                try:
                    OLD[name] = (int(total_str), int(last_str))
                except:
                    OLD[name] = (0, 0)

# è°ƒç”¨ V2Ray API è·å–æœ¬æ¬¡ç´¯è®¡æµé‡
result = subprocess.run(API_CMD, capture_output=True, text=True)
lines = result.stdout.strip().splitlines()
stats_lines = lines[1:]  # è·³è¿‡æ ‡é¢˜

for line in stats_lines:
    line = line.strip()
    if line.startswith(&quot;Total:&quot;):
        continue
    parts = line.split()
    if len(parts) &amp;lt; 2:
        continue
    value = parts[1]
    name = &quot; &quot;.join(parts[2:]) if len(parts) &amp;gt; 2 else &quot;&quot;
    name = name.replace(&quot;&amp;gt;&quot;, &quot;-&quot;)

    # è½¬æ¢ä¸ºå­—èŠ‚
    try:
        num = float(value[:-2])
        unit = value[-2:]
    except:
        continue

    if unit == &quot;B&quot;:
        current_bytes = int(num)
    elif unit == &quot;KB&quot;:
        current_bytes = int(num * 1024)
    elif unit == &quot;MB&quot;:
        current_bytes = int(num * 1024 * 1024)
    elif unit == &quot;GB&quot;:
        current_bytes = int(num * 1024 * 1024 * 1024)
    else:
        current_bytes = 0

    total_prev, last_api_prev = OLD.get(name, (0, 0))
    delta = current_bytes - last_api_prev
    if delta &amp;lt; 0:  # V2Ray é‡å¯ï¼ŒAPI ç´¯è®¡ä»0å¼€å§‹
        delta = current_bytes
    total_new = total_prev + delta
    OLD[name] = (total_new, current_bytes)

# ä¿å­˜æœ€æ–°ç´¯è®¡åˆ° data.db
with open(DATA_FILE, &quot;w&quot;) as f:
    for name, (total_bytes, last_api_bytes) in OLD.items():
        f.write(f&quot;{name} {total_bytes} {last_api_bytes}\n&quot;)

# è‡ªåŠ¨å•ä½æ˜¾ç¤ºå‡½æ•°
def format_bytes(b):
    if b &amp;lt; 102.4:  # å°äº0.1 KB
        return f&quot;{b:.2f} B&quot;
    elif b &amp;lt; 1024*102.4:  # å°äº0.1 MB
        return f&quot;{b/1024:.2f} KB&quot;
    elif b &amp;lt; 1024*1024*102.4:  # å°äº0.1 GB
        return f&quot;{b/1024/1024:.2f} MB&quot;
    else:
        return f&quot;{b/1024/1024/1024:.2f} GB&quot;

# ç”Ÿæˆ HTML
html = &quot;&quot;&quot;
&amp;lt;html&amp;gt;
&amp;lt;head&amp;gt;
&amp;lt;meta charset=&quot;utf-8&quot;&amp;gt;
&amp;lt;title&amp;gt;æœ¬æœˆæµé‡ç»Ÿè®¡&amp;lt;/title&amp;gt;
&amp;lt;style&amp;gt;
body { font-family: Arial, sans-serif; background:#f4f6f9; color:#333; margin:40px; }
h2 { color:#007BFF; }
table { border-collapse: collapse; width: 60%; margin-top:20px; background:#fff; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
th { background:#007BFF; color:white; }
tr:nth-child(even) { background:#f9f9f9; }
tr:hover { background:#e9f5ff; }
.footer { margin-top:20px; font-size: 0.9em; color:#666; }
&amp;lt;/style&amp;gt;
&amp;lt;meta http-equiv=&quot;refresh&quot; content=&quot;60&quot;&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;
&amp;lt;h2&amp;gt;ğŸ“Š æœ¬æœˆæµé‡ç»Ÿè®¡&amp;lt;/h2&amp;gt;
&amp;lt;table&amp;gt;
&amp;lt;tr&amp;gt;&amp;lt;th&amp;gt;åç§°&amp;lt;/th&amp;gt;&amp;lt;th&amp;gt;ç´¯è®¡æµé‡&amp;lt;/th&amp;gt;&amp;lt;/tr&amp;gt;
&quot;&quot;&quot;

total_all = 0
for name in sorted(OLD.keys()):
    total_bytes, _ = OLD[name]
    html += f&quot;&amp;lt;tr&amp;gt;&amp;lt;td&amp;gt;{name}&amp;lt;/td&amp;gt;&amp;lt;td&amp;gt;{format_bytes(total_bytes)}&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;\n&quot;
    total_all += total_bytes

html += f&quot;&amp;lt;tr&amp;gt;&amp;lt;td&amp;gt;æ€»è®¡&amp;lt;/td&amp;gt;&amp;lt;td&amp;gt;{format_bytes(total_all)}&amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;\n&quot;
html += f&quot;&quot;&quot;
&amp;lt;/table&amp;gt;
&amp;lt;div class=&quot;footer&quot;&amp;gt;æ›´æ–°æ—¶é—´ï¼ˆUTCï¼‰: {now.strftime(&apos;%Y-%m-%d %H:%M:%S&apos;)} ï¼ˆé¡µé¢æ¯60ç§’è‡ªåŠ¨åˆ·æ–°ï¼‰&amp;lt;/div&amp;gt;
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&quot;&quot;&quot;

with open(HTML_FILE, &quot;w&quot;, encoding=&quot;utf-8&quot;) as f:
    f.write(html)

# è¾“å‡ºå¯†æ–‡
ENC_FILE = OUTPUT_FILE

# ----------------------
# AES-CBC åŠ å¯†
# ----------------------
# key é•¿åº¦ 16 å­—èŠ‚ï¼Œä¸è¶³è¡¥é›¶
key_bytes = key.ljust(16, b&apos;\0&apos;)
iv = get_random_bytes(16)
cipher = AES.new(key_bytes, AES.MODE_CBC, iv)
ct = cipher.encrypt(pad(html.encode(&quot;utf-8&quot;), AES.block_size))

# IV + å¯†æ–‡ Base64 ç¼–ç å¹¶ä»¥äºŒè¿›åˆ¶å†™å…¥æ–‡ä»¶ï¼ˆè·¨å¹³å°ä¸€è‡´ï¼‰
with open(ENC_FILE, &quot;wb&quot;) as f:
    f.write(base64.b64encode(iv + ct))

print(&quot;ç”Ÿæˆå¹¶åŠ å¯†å®Œæˆ -&amp;gt; encrypt.txt&quot;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;4.å®‰è£…åŠé…ç½®è‡ªåŠ¨è¿è¡Œï¼Œä»¥ubuntuä¸ºä¾‹&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;nb&quot;&gt;touch&lt;/span&gt; /var/lib/v2ray-stats/data.db
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get update
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;python3 python3-pycryptodome
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;å¦å¤–æ‰§è¡Œcrontab -eï¼Œæœ€åä¸€è¡Œæ·»åŠ è‡ªåŠ¨è¿è¡Œï¼š&lt;/p&gt;

&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
* * * * * &lt;span class=&quot;k&quot;&gt;python3&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;/root/&lt;/span&gt;v2ray&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;stats&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;py&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;5.æœ€åæ‰“å¼€ç½‘é¡µå°±æ˜¯è¿™æ ·äº†ï¼š&lt;/p&gt;

&lt;p&gt;ç™»é™†å‰ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://jibenfa.github.io/uploads/2025/09/web1.png&quot; width=&quot;1369&quot; height=&quot;776&quot; alt=&quot;ç™»å½•é¡µé¢&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç™»å½•åï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://jibenfa.github.io/uploads/2025/09/web2.png&quot; width=&quot;1368&quot; height=&quot;933&quot; alt=&quot;ç»Ÿè®¡é¡µé¢&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;

&lt;p&gt;1.chatgpt&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>åœ¨æ–°ç‰ˆlucié¡µé¢ä¸­åˆ›å»ºèœå•ç”¨äºåˆ‡æ¢v2rayè¿è¡Œæ¨¡å¼</title>
   <link href="https://jibenfa.github.io/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/2025/08/26/E59CA8E696B0E78988luciE9A1B5E99DA2E4B8ADE5889BE5BBBAE88F9CE58D95E794A8E4BA8EE58887E68DA2v2rayE8BF90E8A18CE6A8A1E5BC8F/"/>
   <updated>2025-08-26T00:12:13+00:00</updated>
   <id>https://jibenfa.github.io/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/2025/08/26/E59CA8E696B0E78988luciE9A1B5E99DA2E4B8ADE5889BE5BBBAE88F9CE58D95E794A8E4BA8EE58887E68DA2v2rayE8BF90E8A18CE6A8A1E5BC8F</id>
   <content type="html">&lt;p&gt;ä» OpenWrt 22.x å¼€å§‹ï¼ŒLuCI çš„å®ç°é€æ¸ä» Lua è¿ç§»åˆ° ubus + ucode + JavaScript (client-side JS)ï¼š&lt;/p&gt;

&lt;p&gt;æ—§ç‰ˆ (â‰¤21.02)&lt;/p&gt;
&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;sr&quot;&gt;/usr/&lt;/span&gt;lib&lt;span class=&quot;sr&quot;&gt;/lua/&lt;/span&gt;luci/      â† ä¸»è¦çš„ Lua MVC æ¡†æ¶ä»£ç 
&lt;span class=&quot;sr&quot;&gt;/usr/&lt;/span&gt;lib&lt;span class=&quot;sr&quot;&gt;/lua/&lt;/span&gt;luci&lt;span class=&quot;sr&quot;&gt;/controller/&lt;/span&gt;
&lt;span class=&quot;sr&quot;&gt;/usr/&lt;/span&gt;lib&lt;span class=&quot;sr&quot;&gt;/lua/&lt;/span&gt;luci&lt;span class=&quot;sr&quot;&gt;/model/&lt;/span&gt;
&lt;span class=&quot;sr&quot;&gt;/usr/&lt;/span&gt;lib&lt;span class=&quot;sr&quot;&gt;/lua/&lt;/span&gt;luci&lt;span class=&quot;sr&quot;&gt;/view/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;æ–°ç‰ˆ (22.03 / 23.05 / 24.x)&lt;/p&gt;
&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;sr&quot;&gt;/www/&lt;/span&gt;luci&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;static&lt;span class=&quot;sr&quot;&gt;/resources/&lt;/span&gt;       â† å‰ç«¯ JS&lt;span class=&quot;sr&quot;&gt;/HTML/&lt;/span&gt;CSS èµ„æºï¼Œç”¨äºç”Ÿæˆç½‘é¡µèœå•
&lt;span class=&quot;sr&quot;&gt;/usr/&lt;/span&gt;share&lt;span class=&quot;sr&quot;&gt;/luci/&lt;/span&gt;menu&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;d&lt;/span&gt;/           â† ç½‘é¡µèœå•é¡¹ï¼Œå³èœå•å…¥å£
&lt;span class=&quot;sr&quot;&gt;/usr/&lt;/span&gt;share&lt;span class=&quot;sr&quot;&gt;/rpcd/&lt;/span&gt;acl&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;d&lt;/span&gt;/            â† ACL èœå•è®¿é—®æƒé™ JSON å®šä¹‰
&lt;span class=&quot;sr&quot;&gt;/usr/&lt;/span&gt;share&lt;span class=&quot;sr&quot;&gt;/rpcd/&lt;/span&gt;ucode/            â†’ rpcd æ’ä»¶&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;ç³»ç»Ÿåç«¯ RPC æ¥å£ï¼ˆæ¯”å¦‚ UCIã€æ–‡ä»¶æ“ä½œã€iwinfo ç­‰ï¼‰ï¼Œä¾›æ‰€æœ‰ RPC å®¢æˆ·ç«¯ï¼ˆåŒ…æ‹¬ LuCIï¼‰è°ƒç”¨&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;sr&quot;&gt;/usr/&lt;/span&gt;share&lt;span class=&quot;sr&quot;&gt;/ucode/&lt;/span&gt;luci/            â†’ LuCI ä¸“ç”¨ ucode æ¨¡å—&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;æä¾› UI é…ç½®é¡µé¢æ‰€éœ€çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼šè¡¨å•ç”Ÿæˆã€æ•°æ®æ ¡éªŒã€è°ƒç”¨ rpcd æ¥å£ç­‰&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;æ‰€ä»¥opkgè½¯ä»¶æºä¸­å¾ˆå¤šluci-app-xxxçš„ç•Œé¢è½¯ä»¶åŒ…éƒ½æ²¡äº†ï¼Œä¸ºäº†èƒ½å¤Ÿåœ¨èœå•ä¸­çµæ´»åˆ‡æ¢v2rayçš„è¿è¡Œæ¨¡å¼ï¼Œè¿›è¡Œäº†ç›¸å…³ç ”ç©¶ã€‚&lt;/p&gt;

&lt;p&gt;0)æˆ‘åœ¨/etc/config/advancedconfigæ–‡ä»¶ä¸­å®šä¹‰äº†v2rayçš„ä¸‰ç§è¿è¡Œæ¨¡å¼ï¼š&lt;/p&gt;
&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;config rules
	option v2raymode &lt;span class=&quot;s1&quot;&gt;&apos;outlands&apos;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;å…¶ä¸­ï¼š&lt;/p&gt;

&lt;p&gt;aï¼‰å¢ƒå¤–å…¨å±€ä»£ç†æ¨¡å¼ï¼Œå³æ‰€æœ‰å›½å¤–ç½‘ç«™ï¼ˆéå›½å†…ipæ®µï¼‰éƒ½èµ°ä»£ç†ï¼Œå¯¹åº”å€¼ï¼šoutlands&lt;/p&gt;

&lt;p&gt;bï¼‰ç™½åå•ä»£ç†æ¨¡å¼ï¼Œå³æ‰€æœ‰è¢«å¢™çš„ç½‘ç«™ï¼ˆç™½åå•ä¸­çš„ç½‘ç«™ï¼‰éƒ½èµ°ä»£ç†ï¼Œå¯¹åº”å€¼ï¼šgfwlist&lt;/p&gt;

&lt;p&gt;cï¼‰å¢™å†…æ— ä»£ç†æ¨¡å¼ï¼Œå³è·Ÿå¹³å¸¸æ²¡æœ‰ä»£ç†ä¸Šç½‘ä¸€æ ·ï¼Œå¯¹åº”å€¼ï¼šingfw&lt;/p&gt;

&lt;p&gt;è¿™ä¸‰ç§æ¨¡å¼å¯¹åº”äº†/etc/init.d/v2rayä¸­çš„é…ç½®ï¼Œè¯¦è§&lt;a href=&quot;https://jibenfa.github.io/ç§‘å­¦ä¸Šç½‘/2025/08/19/E59CA8openwrtE4B88BE4BDBFE794A8chinadns-ngE690ADE9858Dv2rayE5AE9EE78EB0E9808FE6988EE4BBA3E79086/&quot;&gt;è¿™é‡Œ&lt;/a&gt;ï¼Œä¸ºäº†èƒ½é€šè¿‡èœå•è¿›è¡Œæ¨¡å¼åˆ‡æ¢ï¼Œå°±éœ€è¦åˆ›å»ºèœå•ã€‚&lt;/p&gt;

&lt;p&gt;1)åˆ›å»ºèœå•é¡¹jsonï¼ˆ/usr/share/luci/menu.d/luci-app-advancedconfig.jsonï¼‰&lt;/p&gt;
&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;admin/services/advancedconfig&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;title&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;v2ray&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;action&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;view&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;path&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;advancedconfig&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;depends&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;acl&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;luci-app-advancedconfig&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;uci&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;advancedconfig&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2)åˆ›å»ºèœå•é¡µé¢jsï¼ˆ/www/luci-static/resources/view/advancedconfig.jsï¼‰&lt;/p&gt;
&lt;div class=&quot;language-js highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;use strict&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;require view&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;require form&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;require uci&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;require rpc&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// å®šä¹‰ä¸€ä¸ª RPC è°ƒç”¨ï¼Œç”¨æ¥æ‰§è¡Œ /etc/init.d/v2ray restart&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;callExec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;rpc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;declare&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;exec&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;view&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// Map å¯¹è±¡åç§°å¿…é¡»å’Œ UCI æ–‡ä»¶åä¸€è‡´&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;Map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;advancedconfig&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;v2ray&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;Advanced config for v2ray&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;

        &lt;span class=&quot;c1&quot;&gt;// å¯¹åº” config rules&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;section&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;TypedSection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;Rules&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;anonymous&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;c1&quot;&gt;// ä¸‹æ‹‰é€‰é¡¹&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;o&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;option&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ListValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;v2raymode&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;ä»£ç†æ¨¡å¼&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;o&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;outlands&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;å¢ƒå¤–å…¨å±€ä»£ç†æ¨¡å¼(Outlands Mode)&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;o&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;gfwlist&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;ç™½åå•ä»£ç†æ¨¡å¼ (GFWlist Mode)&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;o&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;ingfw&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;å¢™å†…æ— ä»£ç†æ¨¡å¼ (China Mode)&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;

        &lt;span class=&quot;c1&quot;&gt;// write å‡½æ•°ï¼šåªæœ‰å€¼å˜åŒ–æ‰å†™å…¥ UCI å†…å­˜&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;o&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;write&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;section_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;formvalue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;oldVal&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;cfgvalue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;section_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;oldVal&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;formvalue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;uci&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;advancedconfig&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;section_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;v2raymode&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;formvalue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

        &lt;span class=&quot;c1&quot;&gt;// ä¿å­˜æ—¶æ‰§è¡Œ uci commit + restart&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;oncommit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;callExec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;/etc/init.d/v2ray&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;restart&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;force&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;æ­¤æ­¥å®Œæˆä»¥åéœ€è¦é‡å¯rpcdæœåŠ¡ï¼š&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/etc/init.d/rpcd restart
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3)åˆ›å»ºACLæƒé™jsonï¼ˆ/usr/share/rpcd/acl.d/luci-app-advancedconfig.jsonï¼‰&lt;/p&gt;
&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;luci-app-advancedconfig&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;description&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Grant UCI access for luci-app-advancedconfig&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;read&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;file&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;/etc/config/advancedconfig&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;read&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;uci&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;advancedconfig&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;write&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;file&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;/etc/config/advancedconfig&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;write&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;uci&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;advancedconfig&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;exec&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;file&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;/etc/init.d/v2ray&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;exec&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æœ€ç»ˆèœå•ç•Œé¢å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://jibenfa.github.io/uploads/2025/08/v2menu.png&quot; width=&quot;1390&quot; height=&quot;398&quot; alt=&quot;v2rayæ¨¡å¼èœå•&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;

&lt;p&gt;1ï¼‰chatgpt&lt;/p&gt;

&lt;p&gt;2ï¼‰luci-app-samba4çš„é…ç½®æ–‡ä»¶&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>v2rayä½¿ç”¨tproxyä»£ç†udpæµé‡</title>
   <link href="https://jibenfa.github.io/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/2025/08/25/v2rayE4BDBFE794A8tproxyE4BBA3E79086udpE6B581E9878F/"/>
   <updated>2025-08-25T00:12:13+00:00</updated>
   <id>https://jibenfa.github.io/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/2025/08/25/v2rayE4BDBFE794A8tproxyE4BBA3E79086udpE6B581E9878F</id>
   <content type="html">&lt;p&gt;openwrtä¸‹çš„v2rayé€æ˜ä»£ç†æœ‰redirectå’Œtproxyä¸¤ç§æ¨¡å¼ï¼Œå‰è€…åªèƒ½ä»£ç†tcpæµé‡ï¼Œä½†æ˜¯é€Ÿåº¦å¿«ï¼Œè·¯ç”±å¼€é”€å°ï¼Œåè€…å¯ä»¥ä»£ç†tcpå’Œudpæµé‡ï¼Œä½†æ˜¯é€Ÿåº¦æ…¢ï¼Œè·¯ç”±å¼€é”€è¾ƒé«˜ã€‚è€Œä¸”redirect ä¼šä¿®æ”¹ç›®æ ‡ IPï¼Œå¯¹äºä¸€äº›åº”ç”¨æˆ– UDP åè®®ï¼ˆæ¯”å¦‚æ¸¸æˆã€VoIPã€æŸäº› P2Pï¼‰å¯èƒ½æ— æ³•æ­£ç¡®å·¥ä½œã€‚tproxy èƒ½ä¿æŒåŸå§‹ç›®æ ‡åœ°å€ï¼Œé€‚åˆå¤æ‚çš„åˆ†æµåœºæ™¯ï¼Œæ¯”å¦‚ï¼šUDP é€æ˜ä»£ç†ã€å¤šç½‘å¡/ç­–ç•¥è·¯ç”±ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœåº”ç”¨åœºæ™¯åªæ˜¯ HTTP/HTTPS TCP æµé‡ï¼Œredirect æ€§èƒ½æœ€å¥½ï¼›å¦‚æœæœ‰å¤§é‡ UDP æˆ–éœ€è¦é€æ˜ä¿ç•™åŸå§‹ç›®æ ‡ IPï¼Œtproxy æ›´å¯é ï¼Œä½†æ¶ˆè€—ç•¥é«˜ã€‚&lt;/p&gt;

&lt;p&gt;æ³¨æ„ï¼šç”¨tproxyæ¨¡å¼ä¼šå¯¼è‡´btç­‰p2pèµ°vpsæµé‡ï¼Œå¯èƒ½ä¼šæ”¶åˆ°ç‰ˆæƒè­¦å‘Šï¼Œåˆ«é—®æˆ‘æ€ä¹ˆçŸ¥é“çš„~~&lt;/p&gt;

&lt;p&gt;ä¸‹é¢æ˜¯ç›¸å…³é…ç½®ï¼š&lt;/p&gt;

&lt;p&gt;1.ä¿®æ”¹/etc/config/v2ray.json&lt;/p&gt;
&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;inbounds&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;    
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;protocol&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;dokodemo-door&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;port&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1060&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;listen&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;0.0.0.0&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;sniffing&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;enabled&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;destOverride&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;http&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;tls&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
       &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;settings&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
         &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;network&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;tcp,udp&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
         &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;followRedirect&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
       &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
       &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;streamSettings&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
         &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;sockopt&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
           &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;tproxy&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;tproxy&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
           &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;mark&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
         &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
       &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;protocol&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;dokodemo-door&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;listen&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;0.0.0.0&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;port&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5354&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;settings&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;address&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;8.8.8.8&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;port&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;53&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;network&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;udp&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;timeout&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;followRedirect&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;streamSettings&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;sockopt&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
          &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;mark&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;protocol&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;dokodemo-door&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;listen&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;0.0.0.0&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;port&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5356&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;settings&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;address&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;8.8.8.8&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;port&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;53&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;network&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;tcp&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;timeout&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;followRedirect&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;streamSettings&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;sockopt&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
          &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;mark&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;protocol&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;dokodemo-door&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;listen&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;0.0.0.0&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;port&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5358&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;settings&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;address&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;1.1.1.1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;port&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;53&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;network&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;udp&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;timeout&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;followRedirect&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;streamSettings&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;sockopt&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
          &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;mark&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;protocol&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;dokodemo-door&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;listen&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;0.0.0.0&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;port&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5360&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;settings&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;address&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;8.8.4.4&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;port&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;53&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;network&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;udp&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;timeout&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;followRedirect&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;streamSettings&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;sockopt&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
          &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;mark&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;outbounds&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;protocol&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;vless&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;tag&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;proxy&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;settings&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;vnext&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
          &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;address&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;xxx.com&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;port&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;443&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;users&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
              &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;*************hidden uuid***************&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;encryption&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;none&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
              &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
          &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;streamSettings&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;network&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ws&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;security&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;tls&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;wsSettings&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
          &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;path&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/mypath&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;tcpSettings&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
          &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;allowInsecureCiphers&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;sockopt&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
          &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;mark&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2.ä¿®æ”¹/etc/init.d/v2ray_chinadns_ng&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/sh /etc/rc.common&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# This is free software, licensed under the GNU General Public License v3.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# See /LICENSE for more information.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# To use this file, install chinadns-ng,v2ray,knot-dig first&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;START&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;90
&lt;span class=&quot;nv&quot;&gt;USE_PROCD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1

&lt;span class=&quot;nv&quot;&gt;LAN_IPS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;10.0.0.1/16&quot;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#å±€åŸŸç½‘ipæ®µ&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;V2RAY_BIN&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/usr/bin/v2ray&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;V2RAY_CONF&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/etc/config/v2ray.json&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_BIN&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/usr/bin/chinadns-ng&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_CONF&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/etc/config/chinadns-ng&quot;&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;DEFAULT_DNS_SERVER&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;223.6.6.6&quot;&lt;/span&gt; 
&lt;span class=&quot;nv&quot;&gt;LOCAL_IP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;127.0.0.1&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;1060&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;V2RAY_DNS_PORTS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;5354 5356 5358 5360&quot;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#5356èµ°tcp&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_PORT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;5353&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_FILES_PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/etc/chinadns-ng/&quot;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# æœ¬é…ç½®æ–‡ä»¶ä¸­NFTé»˜è®¤å‚æ•°ä¸ºï¼š&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# family:inet&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# table:global&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# set:chnroute,chnroute6,gfwip,gfwip6&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ä¸Šè¿°å€¼éœ€ä¸chinadnsngé…ç½®æ–‡ä»¶ä¸­çš„ä¸€è‡´ï¼Œå¦åˆ™æ— æ³•ç”Ÿæ•ˆï¼š&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# add-taggfw-ip inet@global@gfwip,inet@global@gfwip6&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ipset-name4 inet@global@chnroute&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ipset-name6 inet@global@chnroute6&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ä¸”ä¸‹åˆ—NFTSETæ–‡ä»¶ä¸­ç›¸å…³ familyï¼Œtableï¼Œsetåç§°è¦ä¹Ÿä¸chinadnsngé…ç½®æ–‡ä»¶ä¸­çš„ä¸€è‡´ï¼Œå¦åˆ™æ— æ³•ç”Ÿæ•ˆ&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;CHNROUTE_NFT_NAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;chnroute.nftset&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;CHNROUTE6_NFT_NAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;chnroute6.nftset&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;CHAINS_NFT_NAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;chains.nftset&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;RESERVEDIP_NFT_NAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;reservedip.nftset&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;RESERVEDIP6_NFT_NAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;reservedip6.nftset&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;GFWIP_NFT_NAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;gfwip.nftset&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;GFWIP6_NFT_NAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;gfwip6.nftset&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;DISABLE_CHNROUTE_NFT_NAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;disable_chnroute.nftset&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;DISABLE_CHNROUTE6_NFT_NAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;disable_chnroute6.nftset&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;DISABLE_GFWIP_NFT_NAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;disable_gfwip.nftset&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;DISABLE_GFWIP6_NFT_NAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;disable_gfwip6.nftset&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;DIRECT_GROUP_FILE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;direct.txt&quot;&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#ä»v2rayçš„é…ç½®æ–‡ä»¶ä¸­è¯»å–ç½‘å€ï¼Œæ”¾åˆ°chinadns-ngçš„ç›´æ¥è§£ææ–‡ä»¶ä¸­ï¼Œé¿å…å› æ— æ³•è§£æå¯¼è‡´æ— æ³•è¿æ¥åˆ°æœåŠ¡ç«¯&lt;/span&gt;
add_v2ray_domain_to_direct_group&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;direct_file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_FILES_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DIRECT_GROUP_FILE&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; /usr/share/libubox/jshn.sh
    json_load_file &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_CONF&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
    json_select outbounds
    json_select 1
    json_select settings
    json_select vnext
    json_select 1
    json_get_var addr address
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;direct_file&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then 
        if &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-q&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;addr&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;direct_file&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
            &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] v2rayåŸŸåå·²ç»å­˜åœ¨äº&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;direct_file&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else
            &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] å°†v2rayåŸŸåæ·»åŠ åˆ°&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;direct_file&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;tail&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; 1 &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;direct_file&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
                &lt;span class=&quot;c&quot;&gt;# æœ€åä¸€è¡Œæ²¡æœ‰æ¢è¡Œç¬¦ï¼Œå…ˆè¡¥ä¸€ä¸ª&lt;/span&gt;
                &lt;span class=&quot;nb&quot;&gt;printf&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;\n&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;direct_file&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;fi
            &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;addr&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;direct_file&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;fi
    else
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] åˆ›å»º&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;direct_file&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;ï¼Œå°†v2rayåŸŸåæ·»åŠ åˆ°&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;direct_file&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;addr&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;direct_file&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

set_multi_domestic_dns&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;current_dns_servers_list&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;uci get dhcp.@dnsmasq[0].server 2&amp;gt;/dev/null&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;min_len&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$((&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${#&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DEFAULT_DNS_SERVER&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &amp;lt; &lt;span class=&quot;k&quot;&gt;${#&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;current_dns_servers_list&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; ? &lt;span class=&quot;k&quot;&gt;${#&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DEFAULT_DNS_SERVER&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; : &lt;span class=&quot;k&quot;&gt;${#&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;current_dns_servers_list&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; x&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DEFAULT_DNS_SERVER&lt;/span&gt;:0:&lt;span class=&quot;nv&quot;&gt;$min_len&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; x&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;current_dns_servers_list&lt;/span&gt;:0:&lt;span class=&quot;nv&quot;&gt;$min_len&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] è®¾ç½®ä½¿ç”¨å›½å†…DNSæœåŠ¡å™¨&quot;&lt;/span&gt;
        uci &lt;span class=&quot;nt&quot;&gt;-q&lt;/span&gt; delete dhcp.@dnsmasq[0].server
        uci add_list dhcp.@dnsmasq[0].server&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DEFAULT_DNS_SERVER&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
        uci &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;dhcp.@dnsmasq[0].noresolv&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0
        uci &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;dhcp.@dnsmasq[0].nohosts&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0
        uci commit dhcp
        &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] é‡å¯dnsmasqæœåŠ¡&quot;&lt;/span&gt;
        /etc/init.d/dnsmasq restart 1&amp;gt;/dev/null 2&amp;gt;&amp;amp;1
    &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

set_multi_foreign_dns&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;current_dns_servers_list&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;uci get dhcp.@dnsmasq[0].server 2&amp;gt;/dev/null&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;min_len&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$((&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${#&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_IP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &amp;lt; &lt;span class=&quot;k&quot;&gt;${#&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;current_dns_servers_list&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; ? &lt;span class=&quot;k&quot;&gt;${#&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_IP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; : &lt;span class=&quot;k&quot;&gt;${#&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;current_dns_servers_list&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; x&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_IP&lt;/span&gt;:0:&lt;span class=&quot;nv&quot;&gt;$min_len&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; x&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;current_dns_servers_list&lt;/span&gt;:0:&lt;span class=&quot;nv&quot;&gt;$min_len&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] è®¾ç½®ä½¿ç”¨ChinaDNSNG DNSæœåŠ¡å™¨&quot;&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;chinadnsng_addr_port&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_IP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;#&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
        uci &lt;span class=&quot;nt&quot;&gt;-q&lt;/span&gt; delete dhcp.@dnsmasq[0].server
        uci add_list dhcp.@dnsmasq[0].server&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;chinadnsng_addr_port&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
        uci &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;dhcp.@dnsmasq[0].noresolv&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1
        uci &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;dhcp.@dnsmasq[0].nohosts&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1
        uci commit dhcp
        &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] é‡å¯dnsmasqæœåŠ¡&quot;&lt;/span&gt;
        /etc/init.d/dnsmasq restart 1&amp;gt;/dev/null 2&amp;gt;&amp;amp;1
    &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

append_chnroute_list&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# åˆ›å»º setï¼šchnroute&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[*] åˆ›å»º inet global è¡¨å’Œ chnroute é›†åˆ&quot;&lt;/span&gt;
    nft &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_FILES_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHNROUTE_NFT_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null

    &lt;span class=&quot;c&quot;&gt;# åˆ›å»º setï¼šchnroute6&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[*] åˆ›å»º inet global è¡¨å’Œ chnroute6 é›†åˆ&quot;&lt;/span&gt;
    nft &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_FILES_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHNROUTE6_NFT_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

append_gfwip_list&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# åˆ›å»º setï¼šgfwip&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[*] åˆ›å»º inet global è¡¨å’Œ gfwip é›†åˆ&quot;&lt;/span&gt;
    nft &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_FILES_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;GFWIP_NFT_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null

    &lt;span class=&quot;c&quot;&gt;# åˆ›å»º setï¼šgfwip6&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[*] åˆ›å»º inet global è¡¨å’Œ gfwip6 é›†åˆ&quot;&lt;/span&gt;
    nft &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_FILES_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;GFWIP6_NFT_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

prepare_work&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# â€”â€” ç­–ç•¥è·¯ç”±ï¼šfwmark=1 èµ°æœ¬åœ°è·¯ç”±è¡¨ 100 â€”â€” &lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] åˆ›å»ºç­–ç•¥è·¯ç”±ï¼šfwmark=1 èµ°æœ¬åœ°è·¯ç”±è¡¨ 100 &quot;&lt;/span&gt;
    ip route flush table 100 2&amp;gt;/dev/null
    ip rule add fwmark 1 lookup 100 2&amp;gt;/dev/null
    ip route add &lt;span class=&quot;nb&quot;&gt;local &lt;/span&gt;0.0.0.0/0 dev lo table 100 2&amp;gt;/dev/null
    ip &lt;span class=&quot;nt&quot;&gt;-6&lt;/span&gt; route flush table 100 2&amp;gt;/dev/null
    ip &lt;span class=&quot;nt&quot;&gt;-6&lt;/span&gt; rule add fwmark 1 lookup 100 2&amp;gt;/dev/null
    ip &lt;span class=&quot;nt&quot;&gt;-6&lt;/span&gt; route add &lt;span class=&quot;nb&quot;&gt;local&lt;/span&gt; ::/0 dev lo table 100 2&amp;gt;/dev/null

    &lt;span class=&quot;c&quot;&gt;# â€”â€” å»ºè®®çš„å†…æ ¸å‚æ•°ï¼ˆOpenWrt å¯æ”¾ /etc/sysctl.d/*.confï¼‰â€”â€”&lt;/span&gt;
    sysctl &lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt; net.ipv4.ip_forward&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1 1&amp;gt;/dev/null
    sysctl &lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt; net.ipv4.conf.all.rp_filter&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0 1&amp;gt;/dev/null
    sysctl &lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt; net.ipv4.conf.default.rp_filter&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0 1&amp;gt;/dev/null
    &lt;span class=&quot;c&quot;&gt;# LAN å£æ˜¯ br-lanï¼š&lt;/span&gt;
    sysctl &lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt; net.ipv4.conf.br-lan.rp_filter&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0 1&amp;gt;/dev/null
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

create_empty_chain&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# åˆ›å»º prerouting output divert é“¾&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[*] åˆ›å»º inet global è¡¨å’Œ prerouting output diverté“¾&quot;&lt;/span&gt;
    nft &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_FILES_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHAINS_NFT_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 
      
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

create_chain_rules&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    create_empty_chain
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[*] åˆ›å»º inet global è¡¨å’Œ ä¿ç•™åœ°å€ @localnet_without_127 @localnet6 é›†&quot;&lt;/span&gt;
    nft &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_FILES_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;RESERVEDIP_NFT_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 
    nft &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_FILES_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;RESERVEDIP6_NFT_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 
    &lt;span class=&quot;c&quot;&gt;# 1) å·²æ‰“æ ‡çš„ä¸å†å¤„ç†ï¼Œé¿å…é€’å½’ï¼Œè¿™é‡Œ0xff å¯¹åº” v2ray é…ç½®æ–‡ä»¶ä¸­çš„markå€¼&lt;/span&gt;
    nft add rule inet global prerouting meta mark 0xff &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# 2) ç›®çš„ä¸ºæœ¬æœºçš„æµé‡æ”¾è¡Œï¼ˆLAN è®¿é—®è·¯ç”±å™¨æœåŠ¡ï¼‰&lt;/span&gt;
    nft add rule inet global prerouting ip daddr &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_IP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return
    &lt;/span&gt;nft add rule inet global prerouting ip daddr &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LAN_IPS&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; tcp dport 0-65535 &lt;span class=&quot;k&quot;&gt;return
    &lt;/span&gt;nft add rule inet global prerouting ip daddr &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LAN_IPS&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; udp dport &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\{&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;,&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_DNS_PORTS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;// /,&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# 3) è·³è¿‡å¸¸è§çš„ä¿ç•™/å†…ç½‘åœ°å€ï¼ˆIPv4ï¼‰_127.0.0.1ç½‘æ®µé™¤å¤–&lt;/span&gt;
    nft add rule inet global prerouting ip daddr @localnet_without_127 &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# 4) è·³è¿‡å¸¸è§çš„ä¿ç•™/å†…ç½‘åœ°å€ï¼ˆIPv6ï¼‰&lt;/span&gt;
    nft add rule inet global prerouting ip6 daddr @localnet6 &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# 1) å·²æ‰“æ ‡çš„ä¸å†å¤„ç†&lt;/span&gt;
    nft add rule inet global prerouting meta mark 0xff &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# 2) è·³è¿‡ç›®çš„ä¸ºæœ¬æœº/æœ¬åœ°æœåŠ¡&lt;/span&gt;
    nft add rule inet global output ip daddr &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_IP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return
    &lt;/span&gt;nft add rule inet global output ip daddr &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LAN_IPS&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; tcp dport 0-65535 &lt;span class=&quot;k&quot;&gt;return
    &lt;/span&gt;nft add rule inet global output ip daddr &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LAN_IPS&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; udp dport &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\{&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;,&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_DNS_PORTS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;// /,&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# 3) è·³è¿‡ä¿ç•™/å†…ç½‘åœ°å€ï¼ˆIPv4ï¼‰_127.0.0.1ç½‘æ®µé™¤å¤–&lt;/span&gt;
    nft add rule inet global output ip daddr @localnet_without_127 &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# 4) è·³è¿‡ä¿ç•™/å†…ç½‘åœ°å€ï¼ˆIPv6ï¼‰&lt;/span&gt;
    nft add rule inet global output ip6 daddr @localnet6 &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# 5) diverté“¾ï¼Œé¿å…å·²æœ‰è¿æ¥çš„åŒ…äºŒæ¬¡é€šè¿‡ TPROXYï¼Œä¸ç”¨ä¹Ÿå¯ä»¥&lt;/span&gt;
    nft add rule inet global divert socket transparent 1 tcp dport 0-65535 meta mark &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;1 accept
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

enable_chnroute_firewall_rules&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    create_chain_rules
    &lt;span class=&quot;c&quot;&gt;# IPv4 TCP/UDP ç›®æ ‡ä¸åœ¨ @chnroute æ‰ TPROXY åˆ° V2Ray&lt;/span&gt;
    nft add rule inet global prerouting ip daddr &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; @chnroute tcp dport 0-65535 tproxy ip to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; meta mark &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;1 accept
    nft add rule inet global prerouting ip daddr &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; @chnroute udp dport 0-65535 tproxy ip to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; meta mark &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;1 accept

    &lt;span class=&quot;c&quot;&gt;# IPv6 TCP/UDP ç›®æ ‡ä¸åœ¨ @chnroute6 æ‰ TPROXY åˆ° V2Ray&lt;/span&gt;
    nft add rule inet global prerouting ip6 daddr &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; @chnroute6 tcp dport 0-65535 tproxy ip6 to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; meta mark &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;1 accept
    nft add rule inet global prerouting ip6 daddr &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; @chnroute6 udp dport 0-65535 tproxy ip6 to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; meta mark &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;1 accept

    &lt;span class=&quot;c&quot;&gt;# IPv4 TCP/UDP ç›®æ ‡ä¸åœ¨ @chnroute æ‰æ‰“æ ‡&lt;/span&gt;
    nft add rule inet global output ip daddr &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; @chnroute tcp dport 0-65535 meta mark &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;1 accept
    nft add rule inet global output ip daddr &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; @chnroute udp dport 0-65535 meta mark &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;1 accept
    &lt;span class=&quot;c&quot;&gt;# IPv6 TCP/UDP ç›®æ ‡ä¸åœ¨ @chnroute6 æ‰æ‰“æ ‡&lt;/span&gt;
    nft add rule inet global output ip6 daddr &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; @chnroute6 tcp dport 0-65535 meta mark &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;1 accept
    nft add rule inet global output ip6 daddr &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; @chnroute6 udp dport 0-65535 meta mark &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;1 accept
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

enable_gfwip_firewall_rules&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    create_chain_rules
    &lt;span class=&quot;c&quot;&gt;# IPv4 TCP/UDP ç›®æ ‡åœ¨ @gfwip æ‰ TPROXY åˆ° V2Ray&lt;/span&gt;
    nft add rule inet global prerouting ip daddr @gfwip tcp dport 0-65535 tproxy ip to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; meta mark &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;1 accept
    nft add rule inet global prerouting ip daddr @gfwip udp dport 0-65535 tproxy ip to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; meta mark &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;1 accept

    &lt;span class=&quot;c&quot;&gt;# IPv6 TCP/UDP ç›®æ ‡åœ¨ @gfwip6 æ‰ TPROXY åˆ° V2Ray&lt;/span&gt;
    nft add rule inet global prerouting ip6 daddr @gfwip6 tcp dport 0-65535 tproxy ip6 to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; meta mark &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;1 accept
    nft add rule inet global prerouting ip6 daddr @gfwip6 udp dport 0-65535 tproxy ip6 to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; meta mark &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;1 accept

    &lt;span class=&quot;c&quot;&gt;# IPv4 TCP/UDP ç›®æ ‡åœ¨ @gfwip æ‰æ‰“æ ‡&lt;/span&gt;
    nft add rule inet global output ip daddr @gfwip tcp dport 0-65535 meta mark &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;1 accept
    nft add rule inet global output ip daddr @gfwip udp dport 0-65535 meta mark &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;1 accept

    &lt;span class=&quot;c&quot;&gt;# IPv6 TCP/UDP ç›®æ ‡åœ¨ @gfwip6 æ‰æ‰“æ ‡&lt;/span&gt;
    nft add rule inet global output ip6 daddr @gfwip6 tcp dport 0-65535 meta mark &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;1 accept
    nft add rule inet global output ip6 daddr @gfwip6 udp dport 0-65535 meta mark &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;1 accept
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

disable_nft_rules&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    create_empty_chain
    nft &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_FILES_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DISABLE_CHNROUTE_NFT_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
    nft &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_FILES_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DISABLE_CHNROUTE6_NFT_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
    nft &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_FILES_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DISABLE_GFWIP_NFT_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
    nft &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_FILES_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DISABLE_GFWIP6_NFT_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
    set_multi_domestic_dns
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ingfw&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /tmp/v2raymode.txt   
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

stop_service&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] åœæ­¢ v2ray æœåŠ¡&quot;&lt;/span&gt;
    disable_nft_rules
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

enable_nft_rules&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;running_v2ray_mode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /tmp/v2raymode.txt 2&amp;gt;/dev/null | &lt;span class=&quot;nb&quot;&gt;tr&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;\r&apos;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;uci get advancedconfig.@rules[0].v2raymode 2&amp;gt;/dev/null&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; x&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; x&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;running_v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] v2rayæ¨¡å¼æœªå˜åŒ–&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else
        &lt;/span&gt;disable_nft_rules
        prepare_work
        add_v2ray_domain_to_direct_group
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;outlands&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
            &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] è®¾ç½®&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;ï¼ˆå¢ƒå¤–å…¨å±€ä»£ç†æ¨¡å¼ï¼‰æ¨¡å¼ä¸­&quot;&lt;/span&gt;
            append_chnroute_list
            enable_chnroute_firewall_rules
            set_multi_foreign_dns
        
        &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;gfwlist&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
            &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] è®¾ç½®&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;ï¼ˆç™½åå•ä»£ç†æ¨¡å¼ï¼‰æ¨¡å¼ä¸­&quot;&lt;/span&gt;
            append_gfwip_list
            enable_gfwip_firewall_rules
            set_multi_foreign_dns
        
        &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ingfw&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
            &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] è®¾ç½®å¢™å†…è®¿é—®æ¨¡å¼&quot;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;fi
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /tmp/v2raymode.txt
    &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

start_service&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    enable_nft_rules
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] å¯åŠ¨ chinadns-ng æœåŠ¡&quot;&lt;/span&gt;
    procd_open_instance
    procd_set_param &lt;span class=&quot;nb&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CHINADNSNG_BIN&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-C&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CHINADNSNG_CONF&lt;/span&gt;
    procd_set_param respawn
    procd_set_param stdout 1
    procd_set_param stderr 1
    procd_close_instance
    &lt;span class=&quot;nb&quot;&gt;sleep &lt;/span&gt;2

    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] å¯åŠ¨ v2ray æœåŠ¡&quot;&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; /var/log/v2ray
    &lt;span class=&quot;nb&quot;&gt;ulimit&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; 65535
    procd_open_instance
    procd_set_param &lt;span class=&quot;nb&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$V2RAY_BIN&lt;/span&gt; run &lt;span class=&quot;nt&quot;&gt;-config&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$V2RAY_CONF&lt;/span&gt;
    procd_set_param file &lt;span class=&quot;nv&quot;&gt;$V2RAY_CONF&lt;/span&gt;
    procd_set_param respawn
    procd_set_param stdout 1
    procd_set_param stderr 1
    procd_set_param pidfile /var/run/v2ray.pid
    procd_close_instance
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

service_triggers&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    procd_add_reload_trigger &lt;span class=&quot;s2&quot;&gt;&quot;advancedconfig&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;3.ä¿®æ”¹/etc/chinadns-ng/chains.nftsetï¼Œç›¸å¯¹äºredirectï¼Œä¸»è¦æ˜¯å¢åŠ äº†divert&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;add table inet global 

add chain inet global prerouting &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;filter hook prerouting priority mangle&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; policy accept&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 
add chain inet global output    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;route  hook output    priority mangle&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; policy accept&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 
add chain inet global divert &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;filter hook prerouting priority &lt;span class=&quot;nt&quot;&gt;-150&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 

flush chain inet global prerouting
flush chain inet global output
flush chain inet global divert
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;4.ä¿®æ”¹/etc/chinadns-ng/ï¼Œç›¸å¯¹äºredirectï¼Œä¸»è¦æ˜¯åˆ é™¤ï¼š127.0.0.0/8&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;add table inet global

&lt;span class=&quot;c&quot;&gt;# å®šä¹‰ IPv4 æœ¬åœ°/ä¿ç•™ç½‘æ®µ&lt;/span&gt;
define ipv4_localnet &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    0.0.0.0/8,          &lt;span class=&quot;c&quot;&gt;# æœ¬ç½‘ç»œ/æœªæŒ‡å®š&lt;/span&gt;
    10.0.0.0/8,         &lt;span class=&quot;c&quot;&gt;# ç§æœ‰ç½‘ç»œ&lt;/span&gt;
    100.64.0.0/10,      &lt;span class=&quot;c&quot;&gt;# CGNAT / Carrier-grade NAT&lt;/span&gt;
                        &lt;span class=&quot;c&quot;&gt;# å›ç¯åœ°å€ï¼Œåˆ é™¤#127.0.0.0/8,        &lt;/span&gt;
    169.254.0.0/16,     &lt;span class=&quot;c&quot;&gt;# é“¾è·¯æœ¬åœ° / APIPA&lt;/span&gt;
    172.16.0.0/12,      &lt;span class=&quot;c&quot;&gt;# ç§æœ‰ç½‘ç»œ&lt;/span&gt;
    192.0.0.0/24,       &lt;span class=&quot;c&quot;&gt;# IETF åè®®ä¿ç•™&lt;/span&gt;
    192.0.2.0/24,       &lt;span class=&quot;c&quot;&gt;# æ–‡æ¡£/ç¤ºä¾‹åœ°å€ (TEST-NET-1)&lt;/span&gt;
    192.88.99.0/24,     &lt;span class=&quot;c&quot;&gt;# 6to4 ä¸­ç»§ï¼ˆå·²åºŸå¼ƒï¼‰&lt;/span&gt;
    192.168.0.0/16,     &lt;span class=&quot;c&quot;&gt;# ç§æœ‰ç½‘ç»œ&lt;/span&gt;
    198.18.0.0/15,      &lt;span class=&quot;c&quot;&gt;# æµ‹è¯•ç½‘ç»œ&lt;/span&gt;
    198.51.100.0/24,    &lt;span class=&quot;c&quot;&gt;# æ–‡æ¡£/ç¤ºä¾‹åœ°å€ (TEST-NET-2)&lt;/span&gt;
    203.0.113.0/24,     &lt;span class=&quot;c&quot;&gt;# æ–‡æ¡£/ç¤ºä¾‹åœ°å€ (TEST-NET-3)&lt;/span&gt;
    224.0.0.0/4,        &lt;span class=&quot;c&quot;&gt;# å¤šæ’­&lt;/span&gt;
    240.0.0.0/4         &lt;span class=&quot;c&quot;&gt;# æœªæ¥ä¿ç•™ å·²ç»åŒ…å« 255.255.255.255&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

add &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;inet global localnet_without_127 &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;ipv4_addr&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; flags interval&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; elements &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$ipv4_localnet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å…¶ä»–é…ç½®å‚è€ƒä¸Šä¸€ç¯‡ã€Šåœ¨openwrtä¸‹ä½¿ç”¨chinadns-ngæ­é…v2rayå®ç°é€æ˜ä»£ç†ã€‹&lt;/p&gt;

&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;

&lt;p&gt;1.v2rayå®˜æ–¹æ–‡æ¡£&lt;/p&gt;

&lt;p&gt;2.chatgpt&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>åœ¨openwrtä¸‹ä½¿ç”¨chinadns-ngæ­é…v2rayå®ç°é€æ˜ä»£ç†</title>
   <link href="https://jibenfa.github.io/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/2025/08/19/E59CA8openwrtE4B88BE4BDBFE794A8chinadns-ngE690ADE9858Dv2rayE5AE9EE78EB0E9808FE6988EE4BBA3E79086/"/>
   <updated>2025-08-19T00:12:13+00:00</updated>
   <id>https://jibenfa.github.io/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/2025/08/19/E59CA8openwrtE4B88BE4BDBFE794A8chinadns-ngE690ADE9858Dv2rayE5AE9EE78EB0E9808FE6988EE4BBA3E79086</id>
   <content type="html">&lt;p&gt;ä¹‹å‰åœ¨openwrtä¸‹ä¸€ç›´ç”¨chinadnsã€dnsmasqæ­é…v2rayå®ç°çš„é€æ˜ä»£ç†ä¸Šç½‘ï¼Œä½†æ˜¯chinadnså¾ˆä¹…æ²¡ç»´æŠ¤äº†ï¼Œå¦å¤–çœ‹åˆ°äº†chinadns-ngï¼Œé™¤äº†æ”¯æŒåŸç‰ˆchinadnsçš„åŠŸèƒ½å¤–ï¼Œè¿˜èƒ½å®ç°dns over tcp/tlsï¼ŒæŒ‰åŸŸåã€ipåˆ†æµï¼Œipv6ï¼Œè¿˜æ”¯æŒdnsç¼“å­˜ï¼Œæœ€æ–°ç‰ˆæœ¬å·²ç»å¯ä»¥å…¨é¢æ›¿ä»£dnsmasqï¼ŒdnsæŸ¥è¯¢æ€§èƒ½å¤§å¹…åº¦æå‡ã€‚æ‰€ä»¥ç ”ç©¶äº†ä¸€ä¸‹ï¼Œéƒ¨ç½²ä»¥åé€šè¿‡cdn warpåçš„ä»£ç†é€Ÿåº¦æ˜æ˜¾æå‡ï¼Œè®¿é—®githubç½‘é¡µé€Ÿåº¦æå‡äº†çº¦40-50%ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹é¢æ˜¯éƒ¨ç½²çš„æ­¥éª¤ï¼š&lt;/p&gt;

&lt;p&gt;1.ä¸‹è½½chinadns-ng&lt;/p&gt;

&lt;p&gt;1ï¼‰ä»&lt;a href=&quot;https://github.com/zfl9/chinadns-ng/releases/tag/2025.08.09&quot;&gt;github&lt;/a&gt;ä¸‹è½½çš„ç°æˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œéœ€æ³¨æ„CPUæ¶æ„è¦åŒ¹é…ï¼ˆä¹‹å‰è‡ªå·±ç¼–è¯‘openwrtä¸‹çš„chinadns-ngç‰ˆæœ¬æœªæˆåŠŸã€‚ã€‚ã€‚è”æœºç¼–è¯‘ç½‘ç»œç¯å¢ƒå¤ªå·®äº†ï¼Œå¦å¤–openwrtä¸‹çš„æºç ç‰ˆæœ¬æœ‰ç‚¹è€ï¼Œä¸æ”¯æŒå¾ˆå¤šæ–°ç‰¹æ€§ï¼Œæ‰€ä»¥è¿˜æ˜¯ç”¨åŸç‰ˆçš„é è°±ï¼‰ã€‚æŠŠäºŒè¿›åˆ¶æ–‡ä»¶æ‹·è´åˆ°/usr/binä¸‹ã€‚&lt;/p&gt;

&lt;p&gt;æ”¹åä¸ºchinadns-ngï¼Œå¹¶é™„åŠ æ‰§è¡Œæƒé™ï¼š&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;mv &lt;/span&gt;chinadns-ng+wolfssl@aarch64-linux-musl@generic+v8a@fast+lto /usr/bin/chinadns-ng
&lt;span class=&quot;nb&quot;&gt;chmod&lt;/span&gt; +x /usr/bin/chinadns-ng
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;è¿è¡Œä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/usr/bin/chinadns-ng &lt;span class=&quot;nt&quot;&gt;-V&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;å¦‚æœæ˜¾ç¤ºæ­£å¸¸å°±okäº†&lt;/p&gt;

&lt;p&gt;2ï¼‰ä»&lt;a href=&quot;https://github.com/zfl9/chinadns-ng&quot;&gt;github&lt;/a&gt;ä¸‹è½½sourceï¼Œæå–å…¶ä¸­çš„resæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ï¼Œæ‹·è´åˆ°/etc/chinadns-ngæ–‡ä»¶å¤¹ä¸‹ï¼Œæ²¡æœ‰çš„è¯å°±åˆ›å»ºä¸€ä¸ªï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼š&lt;/p&gt;

&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; # &lt;span class=&quot;k&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;/etc/&lt;/span&gt;chinadns&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;ng
chains&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;nftset             chnroute&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;nftset           direct&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;txt                disable_gfwip&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;nftset      gfwip6&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;nftset             reservedip6&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;nftset        &lt;span class=&quot;k&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;chnroute&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;nft&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sh&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;chnroute6&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sh&lt;/span&gt;
chnlist&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;txt               chnroute6&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;ipset           disable_chnroute&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;nftset   disable_gfwip6&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;nftset     gfwlist&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;txt               &lt;span class=&quot;k&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;all&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sh&lt;/span&gt;             &lt;span class=&quot;k&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;chnroute&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sh&lt;/span&gt;        &lt;span class=&quot;k&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;gfwlist&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sh&lt;/span&gt;
chnroute&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;ipset            chnroute6&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;nftset          disable_chnroute6&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;nftset  gfwip&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;nftset              reservedip&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;nftset         &lt;span class=&quot;k&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;chnlist&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sh&lt;/span&gt;         &lt;span class=&quot;k&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;chnroute6&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;nft&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sh&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;æ³¨æ„ï¼š
direct.txt,
disable_chnroute.nftset,
disable_chnroute6.nftset,
gfwip.nftset,
gfwip6.nftset,
disable_gfwip.nftset,
disable_gfwip6.nftset
chains.nftset
reservedip.nftset
reservedip6.nftset
æ˜¯æˆ‘åˆ›å»ºçš„ï¼Œåé¢ç»†è¯´ã€‚&lt;/p&gt;

&lt;p&gt;å»ºè®®å¯ç”¨å‰é€šè¿‡update*.shè¿›è¡Œæ›´æ–°&lt;/p&gt;

&lt;p&gt;a) å…¶ä¸­direct.txtä¸­å†…å®¹ä¸ºéœ€è¦é€šè¿‡å›½å†…114è§£æçš„åŸŸåï¼Œä¸»è¦æ˜¯v2rayæœåŠ¡ç«¯åŸŸåï¼è¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼Œv2rayæœåŠ¡ç«¯åŸŸåä¸€å®šè¦ç”±å›½å†…dnsè§£æï¼Œå¦åˆ™æ— æ³•è¿æ¥ã€‚ä¾‹å¦‚v2rayæœåŠ¡ç«¯åŸŸåæ˜¯xxx.comï¼Œåˆ™direct.txtå†…å®¹å¯ä»¥ä¸ºï¼š&lt;/p&gt;

&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;xxx&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;com&lt;/span&gt;
ntp&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;org
vultur&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;com&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;b) disable_chnroute.nftsetå†…å®¹ä¸ºï¼š&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;flush &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;inet global chnroute
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;c) disable_chnroute6.nftsetå†…å®¹ä¸ºï¼š&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;flush &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;inet global chnroute6
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;d) gfwip.nftsetå†…å®¹ä¸ºï¼š&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;add table inet global
add &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;inet global gfwip &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;ipv4_addr&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;flags interval&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;e) gfwip6.nftsetå†…å®¹ä¸ºï¼š&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;add table inet global
add &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;inet global gfwip6 &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;ipv4_addr&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;flags interval&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;f) disable_chnroute.nftsetå†…å®¹ä¸ºï¼š&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;flush &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;inet global gfwip
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;g) disable_chnroute6.nftsetå†…å®¹ä¸ºï¼š&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;flush &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;inet global gfwip6
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;h) chains.nftsetå†…å®¹ä¸ºï¼š&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;add table inet global

add chain inet global prerouting &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;nat hook prerouting priority dstnat&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
add chain inet global output &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;nat hook output priority &lt;span class=&quot;nt&quot;&gt;-100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

flush chain inet global prerouting
flush chain inet global output
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;i) reservedip.nftsetå†…å®¹ä¸ºï¼š&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;add table inet global

&lt;span class=&quot;c&quot;&gt;# å®šä¹‰ IPv4 æœ¬åœ°/ä¿ç•™ç½‘æ®µ&lt;/span&gt;
define ipv4_localnet &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    0.0.0.0/8,          &lt;span class=&quot;c&quot;&gt;# æœ¬ç½‘ç»œ/æœªæŒ‡å®š&lt;/span&gt;
    10.0.0.0/8,         &lt;span class=&quot;c&quot;&gt;# ç§æœ‰ç½‘ç»œ&lt;/span&gt;
    100.64.0.0/10,      &lt;span class=&quot;c&quot;&gt;# CGNAT / Carrier-grade NAT&lt;/span&gt;
    127.0.0.0/8,        &lt;span class=&quot;c&quot;&gt;# å›ç¯åœ°å€&lt;/span&gt;
    169.254.0.0/16,     &lt;span class=&quot;c&quot;&gt;# é“¾è·¯æœ¬åœ° / APIPA&lt;/span&gt;
    172.16.0.0/12,      &lt;span class=&quot;c&quot;&gt;# ç§æœ‰ç½‘ç»œ&lt;/span&gt;
    192.0.0.0/24,       &lt;span class=&quot;c&quot;&gt;# IETF åè®®ä¿ç•™&lt;/span&gt;
    192.0.2.0/24,       &lt;span class=&quot;c&quot;&gt;# æ–‡æ¡£/ç¤ºä¾‹åœ°å€ (TEST-NET-1)&lt;/span&gt;
    192.88.99.0/24,     &lt;span class=&quot;c&quot;&gt;# 6to4 ä¸­ç»§ï¼ˆå·²åºŸå¼ƒï¼‰&lt;/span&gt;
    192.168.0.0/16,     &lt;span class=&quot;c&quot;&gt;# ç§æœ‰ç½‘ç»œ&lt;/span&gt;
    198.18.0.0/15,      &lt;span class=&quot;c&quot;&gt;# æµ‹è¯•ç½‘ç»œ&lt;/span&gt;
    198.51.100.0/24,    &lt;span class=&quot;c&quot;&gt;# æ–‡æ¡£/ç¤ºä¾‹åœ°å€ (TEST-NET-2)&lt;/span&gt;
    203.0.113.0/24,     &lt;span class=&quot;c&quot;&gt;# æ–‡æ¡£/ç¤ºä¾‹åœ°å€ (TEST-NET-3)&lt;/span&gt;
    224.0.0.0/4,        &lt;span class=&quot;c&quot;&gt;# å¤šæ’­&lt;/span&gt;
    240.0.0.0/4         &lt;span class=&quot;c&quot;&gt;# æœªæ¥ä¿ç•™ å·²ç»åŒ…å« 255.255.255.255&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

add &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;inet global localnet &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;ipv4_addr&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; flags interval&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; elements &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$ipv4_localnet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;j) reservedip6.nftsetå†…å®¹ä¸ºï¼š&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;add table inet global

&lt;span class=&quot;c&quot;&gt;# å®šä¹‰ IPv6 æœ¬åœ°/ä¿ç•™ç½‘æ®µ&lt;/span&gt;
define ipv6_localnet &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    ::/128,             &lt;span class=&quot;c&quot;&gt;# æœªæŒ‡å®šåœ°å€&lt;/span&gt;
    ::1/128,            &lt;span class=&quot;c&quot;&gt;# å›ç¯åœ°å€&lt;/span&gt;
    ::ffff:0:0/96,      &lt;span class=&quot;c&quot;&gt;# IPv4 æ˜ å°„&lt;/span&gt;
    64:ff9b::/96,       &lt;span class=&quot;c&quot;&gt;# IPv4/IPv6 NAT64&lt;/span&gt;
    100::/64,           &lt;span class=&quot;c&quot;&gt;# ä¸¢å¼ƒç”¨é€”&lt;/span&gt;
    fc00::/7,           &lt;span class=&quot;c&quot;&gt;# å”¯ä¸€æœ¬åœ°åœ°å€ (ULA)&lt;/span&gt;
    fe80::/10,          &lt;span class=&quot;c&quot;&gt;# é“¾è·¯æœ¬åœ°&lt;/span&gt;
    ff00::/8            &lt;span class=&quot;c&quot;&gt;# å¤šæ’­&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

add &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;inet global localnet6 &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;ipv6_addr&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; flags interval&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; elements &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$ipv6_localnet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2.é…ç½®chinadns-ng&lt;/p&gt;

&lt;p&gt;1ï¼‰åˆ›å»ºå¹¶ä¿®æ”¹é…ç½®æ–‡ä»¶/etc/config/chinadns-ng:&lt;/p&gt;
&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
# ç›‘å¬åœ°å€å’Œç«¯å£
bind&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;addr &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
bind&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;port &lt;span class=&quot;m&quot;&gt;5353&lt;/span&gt;

# å›½å†… DNS
china&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;dns tls&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;101&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;226&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;6&lt;/span&gt;
china&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;dns tls&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;223&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
china&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;dns tls&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;223&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;6&lt;/span&gt;
china&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;dns tls&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;12&lt;/span&gt;
china&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;dns tls&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;120&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;53&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;53&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;53&lt;/span&gt;

# å›½å¤– DNS
trust&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;dns &lt;span class=&quot;m&quot;&gt;127&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;#&lt;span class=&quot;m&quot;&gt;5354&lt;/span&gt;
trust&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;dns tcp&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;127&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;#&lt;span class=&quot;m&quot;&gt;5356&lt;/span&gt;
trust&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;dns &lt;span class=&quot;m&quot;&gt;127&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;#&lt;span class=&quot;m&quot;&gt;5358&lt;/span&gt;
trust&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;dns &lt;span class=&quot;m&quot;&gt;127&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;#&lt;span class=&quot;m&quot;&gt;5360&lt;/span&gt;

# åˆ—è¡¨æ–‡ä»¶
chnlist&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;/etc/&lt;/span&gt;chinadns&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;ng/chnlist&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;txt
gfwlist&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;/etc/&lt;/span&gt;chinadns&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;ng/gfwlist&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;txt

# groupæ–‡ä»¶
group direct
group&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;dnl &lt;span class=&quot;sr&quot;&gt;/etc/&lt;/span&gt;chinadns&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;ng/direct&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;txt
group&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;upstream tls&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;223&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;tls&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;12&lt;/span&gt;
group&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;ipset inet@global@chnroute&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;inet@global@chnroute6

# æ”¶é›† &lt;span class=&quot;k&quot;&gt;tag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;chnã€&lt;span class=&quot;k&quot;&gt;tag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;gfw&lt;/span&gt; åŸŸåçš„ IP &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;å¯é€‰&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
# ç›¸å…³ familyï¼Œtableï¼Œsetåç§°è¦ä¸nftsetæ–‡ä»¶ä¸­çš„ä¸€è‡´ï¼Œå¦åˆ™æ— æ³•ç”Ÿæ•ˆ
# æˆ‘è¿™é‡ŒåªåŠ¨æ€æ”¶é›†gfwlistï¼ˆ&lt;span class=&quot;k&quot;&gt;tag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;gfw&lt;/span&gt;ï¼‰é‡Œç½‘å€è§£æå‡ºæ¥çš„gfwipå’Œgfwip6ï¼Œåº”ç”¨äºv&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;rayçš„gfwlistæ¨¡å¼ä¸­
#&lt;span class=&quot;nb&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;tagchn&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;ip inet@global@chnip&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;inet@global@chnip6
&lt;span class=&quot;nb&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;taggfw&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;ip inet@global@gfwip&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;inet@global@gfwip6

# æµ‹è¯• &lt;span class=&quot;k&quot;&gt;tag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;none åŸŸåçš„ IP &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;é’ˆå¯¹å›½å†…ä¸Šæ¸¸&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
# ç›¸å…³ familyï¼Œtableï¼Œsetåç§°è¦ä¸nftsetæ–‡ä»¶ä¸­çš„ä¸€è‡´ï¼Œå¦åˆ™æ— æ³•ç”Ÿæ•ˆ
ipset&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;name4 inet@global@chnroute
ipset&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;name6 inet@global@chnroute6

# dns ç¼“å­˜
cache &lt;span class=&quot;m&quot;&gt;4096&lt;/span&gt;
cache&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;stale &lt;span class=&quot;m&quot;&gt;86400&lt;/span&gt;
cache&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;refresh &lt;span class=&quot;m&quot;&gt;20&lt;/span&gt;

# verdict ç¼“å­˜ &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;ç”¨äº &lt;span class=&quot;k&quot;&gt;tag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;none åŸŸå&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
verdict&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;cache &lt;span class=&quot;m&quot;&gt;4096&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2.é…ç½®v2ray&lt;/p&gt;

&lt;p&gt;1ï¼‰ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆ/etc/config/v2ray.jsonï¼‰&lt;/p&gt;
&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;&quot;inbounds&quot;: [&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;    
      &lt;span class=&quot;c&quot;&gt;&quot;protocol&quot;: &quot;dokodemo-door&quot;,&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;port&quot;: 1060,&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;listen&quot;:&quot;0.0.0.0&quot;,&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;sniffing&quot;: {&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;enabled&quot;: false,&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;destOverride&quot;: [&quot;http&quot;, &quot;tls&quot;]&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
       &lt;span class=&quot;c&quot;&gt;&quot;settings&quot;: {&lt;/span&gt;
         &lt;span class=&quot;c&quot;&gt;&quot;network&quot;: &quot;tcp,udp&quot;,&lt;/span&gt;
         &lt;span class=&quot;c&quot;&gt;&quot;followRedirect&quot;: true &lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;protocol&quot;: &quot;dokodemo-door&quot;,&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;listen&quot;:&quot;0.0.0.0&quot;,&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;port&quot;: 5354,&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;settings&quot;: {&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;address&quot;: &quot;8.8.8.8&quot;,&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;port&quot;: 53,&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;network&quot;: &quot;udp&quot;,&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;timeout&quot;: 0,&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;followRedirect&quot;: false&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;protocol&quot;: &quot;dokodemo-door&quot;,&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;listen&quot;:&quot;0.0.0.0&quot;,&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;port&quot;: 5356,&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;settings&quot;: {&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;address&quot;: &quot;8.8.8.8&quot;,&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;port&quot;: 53,&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;network&quot;: &quot;tcp&quot;,&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;timeout&quot;: 0,&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;followRedirect&quot;: false&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;protocol&quot;: &quot;dokodemo-door&quot;,&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;listen&quot;:&quot;0.0.0.0&quot;,&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;port&quot;: 5358,&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;settings&quot;: {&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;address&quot;: &quot;1.1.1.1&quot;,&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;port&quot;: 53,&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;network&quot;: &quot;udp&quot;,&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;timeout&quot;: 0,&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;followRedirect&quot;: false&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;protocol&quot;: &quot;dokodemo-door&quot;,&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;listen&quot;:&quot;0.0.0.0&quot;,&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;port&quot;: 5360,&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;settings&quot;: {&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;address&quot;: &quot;8.8.4.4&quot;,&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;port&quot;: 53,&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;network&quot;: &quot;udp&quot;,&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;timeout&quot;: 0,&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;followRedirect&quot;: false&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;&quot;outbounds&quot;: [&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;protocol&quot;: &quot;vless&quot;,&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;tag&quot;: &quot;proxy&quot;,&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;settings&quot;: {&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;vnext&quot;: [&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c&quot;&gt;&quot;address&quot;: &quot;xxx.com&quot;,&lt;/span&gt;
            &lt;span class=&quot;c&quot;&gt;&quot;port&quot;: 443,&lt;/span&gt;
            &lt;span class=&quot;c&quot;&gt;&quot;users&quot;: [&lt;/span&gt;
              &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;c&quot;&gt;&quot;id&quot;: &quot;***************uuid************************&quot;,&lt;/span&gt;
                &lt;span class=&quot;c&quot;&gt;&quot;encryption&quot;: &quot;none&quot;&lt;/span&gt;
              &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;streamSettings&quot;: {&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;network&quot;: &quot;ws&quot;,&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;security&quot;: &quot;tls&quot;,&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;wsSettings&quot;: {&lt;/span&gt;
          &lt;span class=&quot;c&quot;&gt;&quot;path&quot;: &quot;/mypath&quot;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;tcpSettings&quot;: {&lt;/span&gt;
          &lt;span class=&quot;c&quot;&gt;&quot;allowInsecureCiphers&quot;: false&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2ï¼‰è°ƒæ•´å¯åŠ¨è„šæœ¬ï¼ˆ/etc/init.d/v2ray_chinadns_ngï¼‰&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/sh /etc/rc.common&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# This is free software, licensed under the GNU General Public License v3.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# See /LICENSE for more information.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# To use this file, install chinadns-ng,v2ray,knot-dig first&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;START&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;90
&lt;span class=&quot;nv&quot;&gt;USE_PROCD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1

&lt;span class=&quot;nv&quot;&gt;V2RAY_BIN&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/usr/bin/v2ray&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;V2RAY_CONF&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/etc/config/v2ray.json&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_BIN&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/usr/bin/chinadns-ng&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_CONF&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/etc/config/chinadns-ng&quot;&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;DEFAULT_DNS_SERVER&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;223.6.6.6&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;LOCAL_IP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;127.0.0.1&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_PORT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;5353&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_FILES_PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/etc/chinadns-ng/&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;1060&quot;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# æœ¬é…ç½®æ–‡ä»¶ä¸­NFTé»˜è®¤å‚æ•°ä¸ºï¼š&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# family:inet&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# table:global&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# set:chnroute,chnroute6,gfwip,gfwip6&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ä¸Šè¿°å€¼éœ€ä¸chinadnsngé…ç½®æ–‡ä»¶ä¸­çš„ä¸€è‡´ï¼Œå¦åˆ™æ— æ³•ç”Ÿæ•ˆï¼š&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# add-taggfw-ip inet@global@gfwip,inet@global@gfwip6&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ipset-name4 inet@global@chnroute&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ipset-name6 inet@global@chnroute6&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ä¸”ä¸‹åˆ—NFTSETæ–‡ä»¶ä¸­ç›¸å…³ familyï¼Œtableï¼Œsetåç§°è¦ä¹Ÿä¸chinadnsngé…ç½®æ–‡ä»¶ä¸­çš„ä¸€è‡´ï¼Œå¦åˆ™æ— æ³•ç”Ÿæ•ˆ&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;CHNROUTE_NFT_NAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;chnroute.nftset&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;CHNROUTE6_NFT_NAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;chnroute6.nftset&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;CHAINS_NFT_NAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;chains.nftset&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;RESERVEDIP_NFT_NAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;reservedip.nftset&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;RESERVEDIP6_NFT_NAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;reservedip6.nftset&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;GFWIP_NFT_NAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;gfwip.nftset&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;GFWIP6_NFT_NAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;gfwip6.nftset&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;DISABLE_CHNROUTE_NFT_NAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;disable_chnroute.nftset&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;DISABLE_CHNROUTE6_NFT_NAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;disable_chnroute6.nftset&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;DISABLE_GFWIP_NFT_NAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;disable_gfwip.nftset&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;DISABLE_GFWIP6_NFT_NAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;disable_gfwip6.nftset&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;DIRECT_GROUP_FILE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;direct.txt&quot;&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#ä»v2rayçš„é…ç½®æ–‡ä»¶ä¸­è¯»å–ç½‘å€ï¼Œæ”¾åˆ°chinadns-ngçš„ç›´æ¥è§£ææ–‡ä»¶ä¸­ï¼Œé¿å…å› æ— æ³•è§£æå¯¼è‡´æ— æ³•è¿æ¥åˆ°æœåŠ¡ç«¯&lt;/span&gt;
add_v2ray_domain_to_direct_group&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;direct_file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_FILES_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DIRECT_GROUP_FILE&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; /usr/share/libubox/jshn.sh
    json_load_file &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_CONF&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
    json_select outbounds
    json_select 1
    json_select settings
    json_select vnext
    json_select 1
    json_get_var addr address
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;direct_file&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then 
        if &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-q&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;addr&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;direct_file&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
            &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] v2rayåŸŸåå·²ç»å­˜åœ¨äº&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;direct_file&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else
            &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] å°†v2rayåŸŸåæ·»åŠ åˆ°&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;direct_file&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;tail&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; 1 &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;direct_file&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
                &lt;span class=&quot;c&quot;&gt;# æœ€åä¸€è¡Œæ²¡æœ‰æ¢è¡Œç¬¦ï¼Œå…ˆè¡¥ä¸€ä¸ª&lt;/span&gt;
                &lt;span class=&quot;nb&quot;&gt;printf&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;\n&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;direct_file&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;fi
            &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;addr&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;direct_file&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;fi
    else
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] åˆ›å»º&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;direct_file&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;ï¼Œå°†v2rayåŸŸåæ·»åŠ åˆ°&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;direct_file&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;addr&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;direct_file&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

set_multi_domestic_dns&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;current_dns_servers_list&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;uci get dhcp.@dnsmasq[0].server 2&amp;gt;/dev/null&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;min_len&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$((&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${#&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DEFAULT_DNS_SERVER&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &amp;lt; &lt;span class=&quot;k&quot;&gt;${#&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;current_dns_servers_list&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; ? &lt;span class=&quot;k&quot;&gt;${#&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DEFAULT_DNS_SERVER&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; : &lt;span class=&quot;k&quot;&gt;${#&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;current_dns_servers_list&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; x&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DEFAULT_DNS_SERVER&lt;/span&gt;:0:&lt;span class=&quot;nv&quot;&gt;$min_len&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; x&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;current_dns_servers_list&lt;/span&gt;:0:&lt;span class=&quot;nv&quot;&gt;$min_len&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] è®¾ç½®ä½¿ç”¨å›½å†…DNSæœåŠ¡å™¨&quot;&lt;/span&gt;
        uci &lt;span class=&quot;nt&quot;&gt;-q&lt;/span&gt; delete dhcp.@dnsmasq[0].server
        uci add_list dhcp.@dnsmasq[0].server&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DEFAULT_DNS_SERVER&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
        uci &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;dhcp.@dnsmasq[0].noresolv&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0
        uci &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;dhcp.@dnsmasq[0].nohosts&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0
        uci commit dhcp
        &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] é‡å¯dnsmasqæœåŠ¡&quot;&lt;/span&gt;
        /etc/init.d/dnsmasq restart 1&amp;gt;/dev/null 2&amp;gt;&amp;amp;1
    &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

set_multi_foreign_dns&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;current_dns_servers_list&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;uci get dhcp.@dnsmasq[0].server 2&amp;gt;/dev/null&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;min_len&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$((&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${#&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_IP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &amp;lt; &lt;span class=&quot;k&quot;&gt;${#&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;current_dns_servers_list&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; ? &lt;span class=&quot;k&quot;&gt;${#&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_IP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; : &lt;span class=&quot;k&quot;&gt;${#&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;current_dns_servers_list&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; x&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_IP&lt;/span&gt;:0:&lt;span class=&quot;nv&quot;&gt;$min_len&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; x&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;current_dns_servers_list&lt;/span&gt;:0:&lt;span class=&quot;nv&quot;&gt;$min_len&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] è®¾ç½®ä½¿ç”¨ChinaDNSNG DNSæœåŠ¡å™¨&quot;&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;chinadnsng_addr_port&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_IP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;#&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
        uci &lt;span class=&quot;nt&quot;&gt;-q&lt;/span&gt; delete dhcp.@dnsmasq[0].server
        uci add_list dhcp.@dnsmasq[0].server&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;chinadnsng_addr_port&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
        uci &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;dhcp.@dnsmasq[0].noresolv&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1
        uci &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;dhcp.@dnsmasq[0].nohosts&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1
        uci commit dhcp
        &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] é‡å¯dnsmasqæœåŠ¡&quot;&lt;/span&gt;
        /etc/init.d/dnsmasq restart 1&amp;gt;/dev/null 2&amp;gt;&amp;amp;1
    &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

append_chnroute_list&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# åˆ›å»º setï¼šchnroute&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[*] åˆ›å»º inet global è¡¨å’Œ chnroute é›†åˆ&quot;&lt;/span&gt;
    nft &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_FILES_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHNROUTE_NFT_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null

    &lt;span class=&quot;c&quot;&gt;# åˆ›å»º setï¼šchnroute6&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[*] åˆ›å»º inet global è¡¨å’Œ chnroute6 é›†åˆ&quot;&lt;/span&gt;
    nft &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_FILES_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHNROUTE6_NFT_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

append_gfwip_list&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# åˆ›å»º setï¼šgfwip&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[*] åˆ›å»º inet global è¡¨å’Œ gfwip é›†åˆ&quot;&lt;/span&gt;
    nft &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_FILES_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;GFWIP_NFT_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null

    &lt;span class=&quot;c&quot;&gt;# åˆ›å»º setï¼šgfwip6&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[*] åˆ›å»º inet global è¡¨å’Œ gfwip6 é›†åˆ&quot;&lt;/span&gt;
    nft &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_FILES_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;GFWIP6_NFT_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

create_empty_chain&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# åˆ›å»º prerouting output é“¾&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[*] åˆ›å»º inet global è¡¨å’Œ prerouting output é“¾&quot;&lt;/span&gt;
    nft &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_FILES_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHAINS_NFT_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

create_chain_rules&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    create_empty_chain
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[*] åˆ›å»º inet global è¡¨å’Œ ä¿ç•™åœ°å€ @localnet @localnet6 é›†&quot;&lt;/span&gt;
    nft &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_FILES_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;RESERVEDIP_NFT_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 
    nft &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_FILES_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;RESERVEDIP6_NFT_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 
    nft add rule inet global prerouting ip daddr @localnet &lt;span class=&quot;k&quot;&gt;return
    &lt;/span&gt;nft add rule inet global prerouting ip6 daddr @localnet6 &lt;span class=&quot;k&quot;&gt;return
    &lt;/span&gt;nft add rule inet global output ip daddr @localnet &lt;span class=&quot;k&quot;&gt;return
    &lt;/span&gt;nft add rule inet global output ip6 daddr @localnet6 &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

enable_chnroute_nft_rules&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    create_chain_rules
    &lt;span class=&quot;c&quot;&gt;#æŠ½æ£€ï¼Œå¦‚æœè¡¨ä¸­æ²¡æœ‰æ·»åŠ ä¿ç•™åœ°å€ï¼Œåˆ™é€€å‡ºï¼Œé¿å…æ— æ³•è¿æ¥è·¯ç”±å™¨æœ¬æœº&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt; nft list table inet global | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-q&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;0.0.0.0&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[!] è‡´å‘½é”™è¯¯ï¼Œä¿ç•™åœ°å€é›†æ·»åŠ å¤±è´¥ï¼Œè®¾ç½®å¤±è´¥ï¼Œè¯·æ£€æŸ¥&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_FILES_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;RESERVEDIP_NFT_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return &lt;/span&gt;0
    &lt;span class=&quot;k&quot;&gt;fi
    &lt;/span&gt;nft add rule inet global prerouting ip daddr &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; @chnroute tcp dport 0-65535 counter redirect to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
    nft add rule inet global output ip daddr &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; @chnroute tcp dport 0-65535 counter redirect to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
    nft add rule inet global prerouting ip6 daddr &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; @chnroute6 tcp dport 0-65535 counter redirect to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
    nft add rule inet global output ip6 daddr &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; @chnroute6 tcp dport 0-65535 counter redirect to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

enable_gfwip_nft_rules&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    create_chain_rules
    nft add rule inet global prerouting ip daddr @gfwip tcp dport 0-65535 counter redirect to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
    nft add rule inet global output ip daddr @gfwip tcp dport 0-65535 counter redirect to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
    nft add rule inet global prerouting ip6 daddr @gfwip6 tcp dport 0-65535 counter redirect to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
    nft add rule inet global output ip6 daddr @gfwip6 tcp dport 0-65535 counter redirect to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

disable_nft_rules&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    create_empty_chain
    nft &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_FILES_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DISABLE_CHNROUTE_NFT_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
    nft &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_FILES_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DISABLE_CHNROUTE6_NFT_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
    nft &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_FILES_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DISABLE_GFWIP_NFT_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
    nft &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNSNG_FILES_PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DISABLE_GFWIP6_NFT_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
    set_multi_domestic_dns
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ingfw&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /tmp/v2raymode.txt   
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

stop_service&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] åœæ­¢ v2ray æœåŠ¡&quot;&lt;/span&gt;
    disable_nft_rules
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

enable_nft_rules&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;running_v2ray_mode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /tmp/v2raymode.txt 2&amp;gt;/dev/null | &lt;span class=&quot;nb&quot;&gt;tr&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;\r&apos;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;uci get advancedconfig.@rules[0].v2raymode 2&amp;gt;/dev/null&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; x&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; x&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;running_v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] v2rayæ¨¡å¼æœªå˜åŒ–&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else
        &lt;/span&gt;disable_nft_rules
        add_v2ray_domain_to_direct_group
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;outlands&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
            &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] è®¾ç½®&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;ï¼ˆå¢ƒå¤–å…¨å±€ä»£ç†æ¨¡å¼ï¼‰æ¨¡å¼ä¸­&quot;&lt;/span&gt;
            append_chnroute_list
            enable_chnroute_nft_rules
            set_multi_foreign_dns
        
        &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;gfwlist&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
            &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] è®¾ç½®&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;ï¼ˆç™½åå•ä»£ç†æ¨¡å¼ï¼‰æ¨¡å¼ä¸­&quot;&lt;/span&gt;
            append_gfwip_list
            enable_gfwip_nft_rules
            set_multi_foreign_dns
        
        &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ingfw&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
            &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] è®¾ç½®å¢™å†…è®¿é—®æ¨¡å¼&quot;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;fi
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /tmp/v2raymode.txt
    &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

start_service&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    enable_nft_rules
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] å¯åŠ¨ chinadns-ng æœåŠ¡&quot;&lt;/span&gt;
    procd_open_instance
    procd_set_param &lt;span class=&quot;nb&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CHINADNSNG_BIN&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-C&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CHINADNSNG_CONF&lt;/span&gt;
    procd_set_param respawn
    procd_set_param stdout 1
    procd_set_param stderr 1
    procd_close_instance
    &lt;span class=&quot;nb&quot;&gt;sleep &lt;/span&gt;2

    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] å¯åŠ¨ v2ray æœåŠ¡&quot;&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; /var/log/v2ray
    &lt;span class=&quot;nb&quot;&gt;ulimit&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; 65535
    procd_open_instance
    procd_set_param &lt;span class=&quot;nb&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$V2RAY_BIN&lt;/span&gt; run &lt;span class=&quot;nt&quot;&gt;-config&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$V2RAY_CONF&lt;/span&gt;
    procd_set_param file &lt;span class=&quot;nv&quot;&gt;$V2RAY_CONF&lt;/span&gt;
    procd_set_param respawn
    procd_set_param stdout 1
    procd_set_param stderr 1
    procd_set_param pidfile /var/run/v2ray.pid
    procd_close_instance
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

service_triggers&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    procd_add_reload_trigger &lt;span class=&quot;s2&quot;&gt;&quot;advancedconfig&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç„¶åæ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;chmod&lt;/span&gt; +x /etc/init.d/v2ray_chinadns_ng
/etc/init.d/v2ray_chinadns_ng &lt;span class=&quot;nb&quot;&gt;enable&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3.è°ƒæ•´dnsmasqï¼Œchinadnsç­‰é…ç½®ï¼Œé¿å…å†²çªã€‚&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /etc/dnsmasq.conf
/etc/init.d/chinadns disable
/etc/init.d/v2ray disable
&lt;span class=&quot;nb&quot;&gt;rm&lt;/span&gt; /root/start_multi_chinadns.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç„¶ååœ¨luciç•Œé¢ä¸­ï¼ŒæŠŠâ€œç½‘ç»œ-&amp;gt;dhcp/dns-&amp;gt;è½¬å‘â€èœå•ä¸‹çš„dnsè½¬å‘æ”¹æˆâ€œ127.0.0.1#5353â€ï¼Œä¿å­˜åé‡å¯openwrtã€‚&lt;/p&gt;

&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;

&lt;p&gt;1.https://github.com/zfl9/chinadns-ng&lt;/p&gt;

&lt;p&gt;2.chatgpt&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>ä½¿ç”¨warpéšè—vpsçš„çœŸå®ip</title>
   <link href="https://jibenfa.github.io/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/2025/08/14/E4BDBFE794A8warpE99A90E8978FvpsE79A84E79C9FE5AE9Eip/"/>
   <updated>2025-08-14T00:12:13+00:00</updated>
   <id>https://jibenfa.github.io/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/2025/08/14/E4BDBFE794A8warpE99A90E8978FvpsE79A84E79C9FE5AE9Eip</id>
   <content type="html">&lt;p&gt;æœ€è¿‘å‘ç°ä¸€äº›å¢ƒå¤–çš„å›¾å±‚ç½‘ç«™è¿˜æœ‰ä¾‹å¦‚redditç­‰ç½‘ç«™å±è”½äº†å¾ˆå¤švpsçš„ipåœ°å€ï¼Œå¯¼è‡´å³ä½¿é€šè¿‡vpsä»£ç†ä¹Ÿæ— æ³•è®¿é—®è¿™äº›ç½‘ç«™ã€‚ç ”ç©¶äº†ä¸€ä¸‹ï¼Œå‘ç°è¿è¡Œv2rayçš„vpsä½¿ç”¨warpå¯ä»¥éšè—vpsçš„çœŸå®ipã€‚&lt;/p&gt;

&lt;p&gt;ç®€å•æ¥è¯´è®¿é—®ç½‘ç»œçš„æ•°æ®è·¯å¾„å˜æ›´ä¸ºï¼š&lt;/p&gt;

&lt;p&gt;å¢ƒå†…v2rayå®¢æˆ·ç«¯ â†’ Cloudflare CDN é›†ç¾¤ â†’ å¢ƒå¤–VPS â†’ Cloudflare WARP é›†ç¾¤â†’ redditç­‰ç½‘ç«™&lt;/p&gt;

&lt;p&gt;è¿™æ ·vpså‡ºå£ipå°±å˜æˆäº†Cloudflareæ± å­é‡Œé¢çš„ipäº†ï¼Œå®é™…æµ‹è¯•å¯ä»¥è®¿é—®redditç­‰ç½‘ç«™ã€‚ä¸å¾—ä¸è¯´CloudflareçœŸæ˜¯èµ›åšå¤§å–„äººï¼&lt;/p&gt;

&lt;p&gt;å…·ä½“é…ç½®å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;1.å®‰è£…warp&lt;/p&gt;

&lt;p&gt;æ ¹æ® https://pkg.cloudflareclient.com/ ç½‘ç«™ä¸Šçš„å®‰è£…æŒ‡å—å®‰è£…warpï¼Œæˆ‘çš„vpsæ˜¯ubuntuï¼Œå®‰è£…æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Add cloudflare gpg key&lt;/span&gt;
curl &lt;span class=&quot;nt&quot;&gt;-fsSL&lt;/span&gt; https://pkg.cloudflareclient.com/pubkey.gpg | &lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;gpg &lt;span class=&quot;nt&quot;&gt;--yes&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--dearmor&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--output&lt;/span&gt; /usr/share/keyrings/cloudflare-warp-archive-keyring.gpg


&lt;span class=&quot;c&quot;&gt;# Add this repo to your apt repositories&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;deb [signed-by=/usr/share/keyrings/cloudflare-warp-archive-keyring.gpg] https://pkg.cloudflareclient.com/ &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;lsb_release &lt;span class=&quot;nt&quot;&gt;-cs&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; main&quot;&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;sudo tee&lt;/span&gt; /etc/apt/sources.list.d/cloudflare-client.list


&lt;span class=&quot;c&quot;&gt;# Install&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get update &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;cloudflare-warp

&lt;span class=&quot;c&quot;&gt;# å¯åŠ¨ WARP æœåŠ¡&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;systemctl start warp-svc
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;systemctl &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;warp-svc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2.è®¾ç½®warp&lt;/p&gt;

&lt;p&gt;1)æ³¨å†Œwarp&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;warp-cli registration new
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;2)è®¾ç½®warpä¸ºä»£ç†æ¨¡å¼&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;warp-cli mode proxy
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;æ³¨æ„ï¼Œå¦‚æœè·³è¿‡è¿™æ­¥ï¼Œç›´æ¥è¿è¡Œï¼šsudo warp-cli connect çš„è¯ä¼šç›´æ¥å¯¼è‡´vpsçš„sshæ–­è¿ï¼Œå› ä¸ºæ‰€æœ‰å‡ºå£éƒ½ç»è¿‡warpï¼Œä¸”æ²¡æœ‰ä»»ä½•é…ç½®ï¼Œè¿™æ—¶å€™éœ€è¦é€šè¿‡vpsä¾›åº”å•†çš„ç®¡ç†ç•Œé¢æŠŠwarpæ–­æ‰æ‰è¡Œã€‚&lt;/p&gt;

&lt;p&gt;3ï¼‰å¯åŠ¨warp&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;warp-cli connect
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;4ï¼‰æ£€æµ‹warpè¿è¡Œæƒ…å†µ&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#æ£€æŸ¥ç›‘å¬ç«¯å£&lt;/span&gt;
ss &lt;span class=&quot;nt&quot;&gt;-ltnp&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;grep &lt;/span&gt;40000

&lt;span class=&quot;c&quot;&gt;# æµ‹è¯• SOCKS5 ä»£ç†æ˜¯å¦èƒ½è®¿é—® Google&lt;/span&gt;
curl &lt;span class=&quot;nt&quot;&gt;--socks5&lt;/span&gt; 127.0.0.1:40000 https://www.google.com &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# æˆ–è€…æµ‹è¯• Cloudflare æ˜¯å¦é€š&lt;/span&gt;
curl &lt;span class=&quot;nt&quot;&gt;--socks5&lt;/span&gt; 127.0.0.1:40000 https://www.cloudflare.com/cdn-cgi/trace
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;å¦‚æœæœ‰è¿”å›ç»“æœå°±okäº†ã€‚&lt;/p&gt;

&lt;p&gt;5ï¼‰æŠŠwarp-proxyæ³¨å†Œä¸ºç³»ç»ŸæœåŠ¡&lt;/p&gt;

&lt;p&gt;a.åˆ›å»º systemd æœåŠ¡æ–‡ä»¶&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;vi /etc/systemd/system/warp-proxy.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;b.ç¼–è¾‘warp-proxy.service&lt;/p&gt;
&lt;div class=&quot;language-ini highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nn&quot;&gt;[Unit]&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;Description&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Cloudflare WARP Proxy Mode&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;After&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;network.target&lt;/span&gt;

&lt;span class=&quot;nn&quot;&gt;[Service]&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;Type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;oneshot&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;ExecStart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/usr/bin/warp-cli mode proxy&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;ExecStartPost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/usr/bin/warp-cli connect&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;RemainAfterExit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;yes&lt;/span&gt;

&lt;span class=&quot;nn&quot;&gt;[Install]&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;WantedBy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;multi-user.target&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;c.é‡æ–°åŠ è½½ systemd å¹¶å¯ç”¨æœåŠ¡&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;systemctl daemon-reload
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;systemctl &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;warp-proxy.service
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;systemctl start warp-proxy.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;d.é‡å¯vpsåï¼Œæ£€æŸ¥çŠ¶æ€&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;warp-cli status
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;æ˜¾ç¤º connected å°±okäº†&lt;/p&gt;

&lt;p&gt;3.é…ç½®v2rayæœåŠ¡ç«¯ï¼Œä¿®æ”¹v2rayçš„é…ç½®æ–‡ä»¶ä¸ºï¼š&lt;/p&gt;
&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;inbounds&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;port&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;23456&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;listen&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;127.0.0.1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;protocol&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;vless&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;settings&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;clients&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
          &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;********hidden-uuid************&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
          &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;decryption&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;none&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;streamSettings&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;network&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ws&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;wsSettings&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
          &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;path&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/mypath&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;outbounds&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;protocol&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;socks&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;settings&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;servers&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
          &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;address&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;127.0.0.1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;port&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;40000&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
          &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;tag&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;warp&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;protocol&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;freedom&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;tag&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;direct&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;routing&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;domainStrategy&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;AsIs&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;rules&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;field&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;outboundTag&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;direct&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;domain&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
          &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;geosite:netflix&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
          &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;geosite:youtube&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;field&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;outboundTag&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;direct&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;ip&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;127.0.0.1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;::1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;8.8.8.8&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;8.8.4.4&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;1.1.1.1&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;field&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;outboundTag&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;warp&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;network&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;tcp,udp&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;æœ€åé‡å¯v2rayæœåŠ¡å³å¯ï¼Œå®¢æˆ·ç«¯ä¸ç”¨åšä»»ä½•æ”¹åŠ¨ã€‚&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªé…ç½®æ–‡ä»¶çš„å«ä¹‰æ˜¯ï¼Œé™¤äº†Netflixå’ŒYouTubeç½‘ç«™ã€æœ¬æœºã€è¿˜æœ‰å‡ ä¸ªdnsçš„ipèµ°ç›´è¿å¤–ï¼Œå…¶ä»–æµé‡éƒ½ç»è¿‡warpã€‚å½“ç„¶ä¹Ÿå¯ä»¥æ ¹æ®éœ€æ±‚ä½¿ç”¨å…¶ä»–é…ç½®ã€‚&lt;/p&gt;

&lt;p&gt;å…è´¹ç‰ˆ Warp åœ¨é«˜å¹¶å‘/å¤§æµé‡ä¸‹ä¼šå‡ºç°é™é€Ÿï¼Œä¸€èˆ¬ç¨³å®šåœ¨ 10~50Mbps å·¦å³ï¼Œè€Œä¸”ç½‘ç»œå»¶è¿Ÿä¹Ÿä¼šå¢åŠ ä¸€äº›ï¼Œæ‰€ä»¥åªè¦ç½‘ç«™ä¸é™åˆ¶vps ipè®¿é—®ï¼ˆæˆ–è€…æ²¡æœ‰å¼ºéšç§éœ€æ±‚ï¼Œæœ‰çš„ç½‘ç«™ä¼šæŠ“å–è®¿é—®çš„ipä½œåˆ«çš„ç”¨é€”ï¼‰ï¼Œæ²¡æœ‰å¿…è¦é€šè¿‡Warpã€‚&lt;/p&gt;

&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;

&lt;p&gt;1.https://pkg.cloudflareclient.com/&lt;/p&gt;

&lt;p&gt;2.chatgpt&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>æ›´æ¢äº†æœ¬ç«™çš„ä¸»é¢˜</title>
   <link href="https://jibenfa.github.io/%E5%85%B6%E4%BB%96/2025/08/08/E69BB4E68DA2E4BA86E69CACE7AB99E79A84E4B8BBE9A298/"/>
   <updated>2025-08-08T00:12:13+00:00</updated>
   <id>https://jibenfa.github.io/%E5%85%B6%E4%BB%96/2025/08/08/E69BB4E68DA2E4BA86E69CACE7AB99E79A84E4B8BBE9A298</id>
   <content type="html">&lt;p&gt;æœ€è¿‘æ›´æ¢äº†æœ¬ç«™çš„ä¸»é¢˜ï¼Œä¸»è¦æ˜¯åŸºäº
&lt;a href=&quot;https://github.com/Simpleyyt/jekyll-jacman&quot;&gt;jekyll-jacmanä¸»é¢˜&lt;/a&gt;åšçš„äºŒæ¬¡å¼€å‘ï¼Œä¸»è¦ä¿®æ”¹å†…å®¹ï¼š&lt;/p&gt;

&lt;p&gt;1.ä¿®å¤äº†å½“åˆ†ç±»å’Œæ ‡ç­¾ä¸ºä¸­æ–‡æ—¶ï¼Œè¶…çº§é“¾æ¥å¤±æ•ˆçš„é—®é¢˜ã€‚&lt;/p&gt;

&lt;p&gt;2.ä»åŸæ¥å†…ç½®çš„rougeä»£ç é«˜äº®ä¸»é¢˜å‡çº§æˆäº†&lt;a href=&quot;https://github.com/highlightjs/highlight.js&quot;&gt;highlight.js&lt;/a&gt;ä»£ç é«˜äº®æ–¹æ¡ˆï¼Œæ”¯æŒåˆ‡æ¢ä¸»é¢˜å’Œå¤šè¯­è¨€ã€‚&lt;/p&gt;

&lt;p&gt;3.ä¿®å¤äº†é¡µé¢å¸ƒå±€ä¸­åˆ†ç±»å’Œæ ‡ç­¾çš„å·¦å³é—´è·å’Œä¸Šä¸‹å¯¹é½é—®é¢˜ã€‚&lt;/p&gt;

&lt;p&gt;4.å¢åŠ äº†ä»£ç å¤åˆ¶æŒ‰é’®ã€‚&lt;/p&gt;

&lt;p&gt;å¦å¤–å‘ç°é€šè¿‡ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-html&quot;&gt; 
```lua 
{ä»£ç } 
```
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ¯”ä½¿ç”¨ï¼š&lt;/p&gt;
&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;pre&amp;gt;&amp;lt;code&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;language-lua&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt; 
{ä»£ç } 
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/code&amp;gt;&amp;lt;/pre&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;å¯¹luaç±»çš„ä»£ç å…¼å®¹æ€§æ›´å¥½ï¼Œä¸ä¼šå‡ºç°jekyllè§£ææ—¶çš„é”™è¯¯è½¬ä¹‰ï¼Œå¯¼è‡´æ˜¾ç¤ºé”™è¯¯ã€‚&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>openwrtä¸‹apkå‘½ä»¤æŠ¥FDBæ ¼å¼é”™è¯¯çš„è§£å†³æ–¹æ³•</title>
   <link href="https://jibenfa.github.io/openwrt/2025/08/05/openwrtE4B88BapkE591BDE4BBA4E68AA5FDBE6A0BCE5BC8FE99499E8AFAFE79A84E8A7A3E586B3E696B9E6B395/"/>
   <updated>2025-08-05T04:23:13+00:00</updated>
   <id>https://jibenfa.github.io/openwrt/2025/08/05/openwrtE4B88BapkE591BDE4BBA4E68AA5FDBE6A0BCE5BC8FE99499E8AFAFE79A84E8A7A3E586B3E696B9E6B395</id>
   <content type="html">&lt;p&gt;è¯è¯´openwrtæ­£å¼ç‰ˆå®‰è£…å‘½ä»¤æ˜¯opkgï¼Œç°åœ¨snapshoté‡Œé¢å˜æˆäº†apkã€‚å‰å‡ å¤©å°è¯•äº†ä¸€ä¸‹ï¼Œå±…ç„¶å¾—åˆ°ä¸€ä¸ªæŠ¥é”™ï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
  
root@OpenWrt:~# apk update
ERROR: FDB format error &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;line 7002, entry &lt;span class=&quot;s1&quot;&gt;&apos;Z&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
ERROR: Unable to &lt;span class=&quot;nb&quot;&gt;read &lt;/span&gt;database: v2 database format error
ERROR: Failed to open apk database: v2 database format error


&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç ”ç©¶äº†ä¸€ä¸‹ï¼Œå…¶å®è¿™ä¸ªæŠ¥é”™ï¼Œè·Ÿä»¥å‰opkgè¢«lockçš„æƒ…å†µæœ‰ç‚¹ç›¸ä¼¼ï¼Œåªä¸è¿‡æ˜¯apké‡‡ç”¨äº†æ•°æ®åº“ï¼Œæ›´æ–°çš„æ—¶å€™å¼‚å¸¸å…³é—­å¯¼è‡´çš„ã€‚&lt;/p&gt;

&lt;p&gt;è§£å†³æ–¹æ¡ˆæ˜¯ï¼š&lt;/p&gt;

&lt;p&gt;æ‰“å¼€/lib/apk/db é‡Œé¢æœ‰ä¸ªinstalled çš„æ•°æ®åº“ï¼Œç„¶åæ‰¾åˆ°æŠ¥é”™çš„è¡Œï¼Œè¿›è¡Œä¿®æ”¹ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ç®€å•åˆ é™¤è¿™ä¸ªåº“ï¼Œåªä¸è¿‡ä¼šå¯¼è‡´é‡æ–°å®‰è£…ä¸€éæ‰€æœ‰è½¯ä»¶ï¼Œä¸å»ºè®®ç›´æ¥åˆ ã€‚&lt;/p&gt;

&lt;p&gt;è¯è¯´ä½¿ç”¨snapshotè¦æ…é‡ï¼Œç”¨apkçš„è¯ä»¥å‰ç°æˆçš„.ipkçš„å®‰è£…åŒ…ç»Ÿç»Ÿä¸èƒ½ç”¨äº†ï¼Œè¦é‡æ–°ç¼–è¯‘æ‰“åŒ…æˆ.apkåŒ…ã€‚å¦å¤–snapshotä¸‹ç¼ºå¤±ä¸å°‘è½¯ä»¶ï¼Œä¾‹å¦‚mtkçš„bind-digå°±æ²¡æœ‰ï¼Œè¿˜æœ‰å°±æ˜¯ç¨³å®šæ€§çš„é—®é¢˜ã€‚&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>openwrtä¸‹v2rayé€æ˜ä»£ç†é…ç½®ä»iptableså‘nftablesè¿ç§»</title>
   <link href="https://jibenfa.github.io/openwrt/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/2025/07/30/openwrtE4B88Bv2rayE9808FE6988EE4BBA3E79086vE9858DE7BDAEE4BB8EiptablesE59091nftablesE8BF81E7A7BB/"/>
   <updated>2025-07-30T03:22:13+00:00</updated>
   <id>https://jibenfa.github.io/openwrt/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/2025/07/30/openwrtE4B88Bv2rayE9808FE6988EE4BBA3E79086vE9858DE7BDAEE4BB8EiptablesE59091nftablesE8BF81E7A7BB</id>
   <content type="html">&lt;p&gt;ç”±äºopenwrtçš„é˜²ç«å¢™é€æ­¥ä»iptableså‘nftableså‡çº§ï¼Œå®˜æ–¹24.10.2çš„dnsmasqåŒ…é»˜è®¤ä¸å°†ipsetçº³å…¥ç¼–è¯‘é€‰é¡¹ï¼Œåªæ”¯æŒnftsetï¼Œ
ç”±æ­¤å¸¦æ¥v2rayé€æ˜ä»£ç†çš„é…ç½®å¿…é¡»è¿›è¡Œå‡çº§ï¼Œæ­¤æ¬¡ä¸»è¦æ˜¯è°ƒæ•´äº†v2rayçš„é…ç½®å’Œdnsmasq-fullçš„é…ç½®ã€‚&lt;/p&gt;

&lt;p&gt;1ï¼‰ä¿®æ”¹/etc/init.d/v2ray&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
  
&lt;span class=&quot;c&quot;&gt;#!/bin/sh /etc/rc.common&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# This is free software, licensed under the GNU General Public License v3.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# See /LICENSE for more information.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# To use this file, install chinadns,v2ray,dnsmasq-full,bind-dig,coreutils-nohup,coreutils-paste first&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#!/bin/sh /etc/rc.common&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;START&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;90
&lt;span class=&quot;nv&quot;&gt;USE_PROCD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1

&lt;span class=&quot;nv&quot;&gt;DOMAIN&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;xxx.com&quot;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#éœ€æ”¹ä¸ºå®é™…ç½‘å€ã€‚åŒæ—¶åœ¨dnsmasqé…ç½®æ–‡ä»¶ä¸­è®¾ç½®nftset=/xxx.com/114.114.114.114&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;DNS_SERVER&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;114.114.114.114&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;BACKUP_DNS_SERVER&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;119.29.29.29 223.5.5.5 180.76.76.76&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;LOCAL_IP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;127.0.0.1&quot;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#CHINADNSå’ŒV2RAYç«¯å£èŒƒå›´:5354-5355 5356-5357 5358-5359 5360-5361ï¼Œé¡»æ­é…å¯¹åº”çš„chinadnså’Œv2rayé…ç½®æ–‡ä»¶ä½¿ç”¨&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;CHINADNS_MIN_PORT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;5354&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;CHNROUTE_FILE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/etc/chinadns_chnroute.txt&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;1060&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;V2RAY_MAX_DNS_PORT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;5361&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;V2RAY_DNS_PORTS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;5357 5359 5361&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;V2RAY_BIN&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/usr/bin/v2ray&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;V2RAY_CONF&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/etc/config/v2ray.json&quot;&lt;/span&gt;

set_multi_domestic_dns&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;current_dns_list&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;uci get dhcp.@dnsmasq[0].server 2&amp;gt;/dev/null&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; x&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DNS_SERVER&lt;/span&gt;:0:15&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; x&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;current_dns_list&lt;/span&gt;:0:15&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] è®¾ç½®ä½¿ç”¨å›½å†…DNSæœåŠ¡å™¨&quot;&lt;/span&gt;
        uci &lt;span class=&quot;nt&quot;&gt;-q&lt;/span&gt; delete dhcp.@dnsmasq[0].server
        uci add_list dhcp.@dnsmasq[0].server&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DNS_SERVER&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;dns &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$BACKUP_DNS_SERVER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do
            &lt;/span&gt;uci add_list dhcp.@dnsmasq[0].server&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dns&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;done
        &lt;/span&gt;uci &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;dhcp.@dnsmasq[0].noresolv&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0
        uci &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;dhcp.@dnsmasq[0].nohosts&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0
        uci commit dhcp
        &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] é‡å¯dnsmasqæœåŠ¡&quot;&lt;/span&gt;
        /etc/init.d/dnsmasq restart 1&amp;gt;/dev/null 2&amp;gt;&amp;amp;1
        &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[âœ“] å®Œæˆ&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

set_multi_foreign_dns&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;current_dns_list&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;uci get dhcp.@dnsmasq[0].server 2&amp;gt;/dev/null&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; x&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_IP&lt;/span&gt;:0:9&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; x&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;current_dns_list&lt;/span&gt;:0:9&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] è®¾ç½®ä½¿ç”¨ChinaDNS DNSæœåŠ¡å™¨&quot;&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;chinadns_port&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;uci get chinadns.@chinadns[0].port 2&amp;gt;/dev/null&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;chinadns_listen_ipport&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_IP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;#&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;chinadns_port&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
        uci &lt;span class=&quot;nt&quot;&gt;-q&lt;/span&gt; delete dhcp.@dnsmasq[0].server
        uci add_list dhcp.@dnsmasq[0].server&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;chinadns_listen_ipport&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;port &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$V2RAY_DNS_PORTS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do
            &lt;/span&gt;uci add_list dhcp.@dnsmasq[0].server&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_IP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;done
        &lt;/span&gt;uci &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;dhcp.@dnsmasq[0].noresolv&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1
        uci &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;dhcp.@dnsmasq[0].nohosts&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1
        uci commit dhcp
        &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] é‡å¯dnsmasqæœåŠ¡&quot;&lt;/span&gt;
        /etc/init.d/dnsmasq restart 1&amp;gt;/dev/null 2&amp;gt;&amp;amp;1
        &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[âœ“] å®Œæˆ&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

create_bypasslist&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[*] åˆ›å»º inet v2ray è¡¨å’Œ bypasslist é›†åˆ&quot;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# åˆ›å»º tableï¼ˆå¦‚ä¸å­˜åœ¨ï¼‰&lt;/span&gt;
    nft list table inet v2ray 2&amp;gt;/dev/null &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;/dev/null
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$?&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-ne&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;nft add table inet v2ray
    &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# åˆ›å»ºæˆ–æ¸…ç©º setï¼šbypasslist&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if &lt;/span&gt;nft list &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;inet v2ray bypasslist 2&amp;gt;/dev/null &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;/dev/null&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;nft delete &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;inet v2ray bypasslist
    &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# åˆ›å»º bypasslist é›†åˆ&lt;/span&gt;
    nft add &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;inet v2ray bypasslist &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;ipv4_addr&lt;span class=&quot;se&quot;&gt;\;&lt;/span&gt; flags interval&lt;span class=&quot;se&quot;&gt;\;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# æ·»åŠ ç§æœ‰åœ°å€æ®µ&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] æ·»åŠ å†…ç½‘åœ°å€æ®µåˆ° bypasslist&quot;&lt;/span&gt;
    nft add element inet v2ray bypasslist &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
        0.0.0.0/8, 10.0.0.0/8, 127.0.0.0/8, &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
        169.254.0.0/16, 172.16.0.0/12, &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
        192.168.0.0/16, 224.0.0.0/4, 240.0.0.0/4 &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# åŠ è½½å›½å†… IPï¼ˆæ¥è‡ªæ–‡ä»¶ï¼‰&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$CHNROUTE_FILE&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] åŠ è½½å›½å†… IP åˆ° bypasslistï¼ˆæ¥æº: &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$CHNROUTE_FILE&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;ï¼‰&quot;&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;BATCH_SIZE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1000
        &lt;span class=&quot;nv&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0
        &lt;span class=&quot;nv&quot;&gt;batch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;

        &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[*] æ­£åœ¨æ‰¹é‡å¯¼å…¥åˆ° nftables...&quot;&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;while &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; line&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-z&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$line&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;continue&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;#\#&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$line&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;continue

            &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;batch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$batch&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$line&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;,&quot;&lt;/span&gt;
            &lt;span class=&quot;nv&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$((&lt;/span&gt;count &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;))&lt;/span&gt;

            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$count&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-ge&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$BATCH_SIZE&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
                &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;batch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;batch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;%,&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
                nft add element inet v2ray bypasslist &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$batch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;nv&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0
                &lt;span class=&quot;nv&quot;&gt;batch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;fi
        done&lt;/span&gt; &amp;lt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$CHNROUTE_FILE&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$batch&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
            &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;batch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;batch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;%,&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
            nft add element inet v2ray bypasslist &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$batch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;fi

        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[âœ“] å¯¼å…¥å®Œæˆ&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[!] æœªæ‰¾åˆ°å›½å†… IP æ–‡ä»¶: &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$CHNROUTE_FILE&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# åŠ è½½ VPS åŸŸåè§£æç»“æœ&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] è§£æ &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DOMAIN&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; å¹¶åŠ å…¥ bypasslist&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;ip &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;dig +short &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DOMAIN&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; @&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DNS_SERVER&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Eo&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;([0-9]{1,3}\.){3}[0-9]{1,3}&apos;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do
        &lt;/span&gt;nft add element inet v2ray bypasslist &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$ip&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;    åŠ å…¥ &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ip&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;done
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;    bypasslist å·²è½½å…¥ &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;nft list &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;inet v2ray bypasslist | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-oE&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+(/[0-9]+)?&apos;&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;wc&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; æ¡ç›®&quot;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# åˆ›å»º nat ç±»å‹é“¾&lt;/span&gt;
    nft list chain inet v2ray prerouting 1&amp;gt;/dev/null 2&amp;gt;&amp;amp;1 &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; nft add chain inet v2ray prerouting &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;nat hook prerouting priority dstnat&lt;span class=&quot;se&quot;&gt;\;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    nft list chain inet v2ray output 1&amp;gt;/dev/null 2&amp;gt;&amp;amp;1 &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; nft add chain inet v2ray output &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;nat hook output priority &lt;span class=&quot;nt&quot;&gt;-100&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

create_gfwlist&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[*] åˆ›å»º inet v2ray è¡¨å’Œ gfwlist é›†åˆ&quot;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# åˆ›å»º tableï¼ˆå¦‚ä¸å­˜åœ¨ï¼‰&lt;/span&gt;
    nft list table inet v2ray 2&amp;gt;/dev/null &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;/dev/null
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$?&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-ne&lt;/span&gt; 0 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;nft add table inet v2ray
    &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# åˆ›å»ºæˆ–æ¸…ç©º setï¼šgfwlist&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if &lt;/span&gt;nft list &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;inet v2ray gfwlist 2&amp;gt;/dev/null &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;/dev/null&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;nft delete &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;inet v2ray gfwlist
    &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# åˆ›å»º gfwlist é›†åˆ&lt;/span&gt;
    nft add &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;inet v2ray gfwlist &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;ipv4_addr&lt;span class=&quot;se&quot;&gt;\;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# æ³¨æ„dnsmasqé…ç½®æ–‡ä»¶ä¸­ä¹Ÿæœ‰gfwlistçš„å†…å®¹ï¼Œæ‰€ä»¥éœ€è¦é‡æ–°åŠ è½½,æ­¤æ“ä½œä¸ä¼šç›´æ¥å¢åŠ gfwlistæ¡ç›®æ•°ï¼Œåªä¼šåœ¨è§£æç½‘å€æ—¶åŠ¨æ€å¢åŠ &lt;/span&gt;
    /etc/init.d/dnsmasq reload 1&amp;gt;/dev/null 2&amp;gt;&amp;amp;1
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;    gfwlist å·²è½½å…¥ &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;nft list &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;inet v2ray gfwlist | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-oE&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+(/[0-9]+)?&apos;&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;wc&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; æ¡ç›®&quot;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# åˆ›å»º nat ç±»å‹é“¾&lt;/span&gt;
    nft list chain inet v2ray prerouting 1&amp;gt;/dev/null 2&amp;gt;&amp;amp;1 &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; nft add chain inet v2ray prerouting &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;nat hook prerouting priority dstnat&lt;span class=&quot;se&quot;&gt;\;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    nft list chain inet v2ray output 1&amp;gt;/dev/null 2&amp;gt;&amp;amp;1 &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; nft add chain inet v2ray output &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;nat hook output priority &lt;span class=&quot;nt&quot;&gt;-100&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

enable_bypasslist_firewall_rules&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    nft add rule inet v2ray prerouting ip daddr &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; @bypasslist tcp dport 0-65535 counter redirect to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
    nft add rule inet v2ray output ip daddr &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; @bypasslist tcp dport 0-65535 counter redirect to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
    nft add rule inet v2ray prerouting ip daddr &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_IP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; udp dport &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNS_MIN_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;-&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_MAX_DNS_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return &lt;/span&gt;2&amp;gt;/dev/null
    nft add rule inet v2ray output ip daddr &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_IP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; udp dport &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNS_MIN_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;-&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_MAX_DNS_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return &lt;/span&gt;2&amp;gt;/dev/null
    nft add rule inet v2ray prerouting ip daddr &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; @bypasslist udp dport 0-65535 counter redirect to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
    nft add rule inet v2ray output ip daddr &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; @bypasslist udp dport 0-65535 counter redirect to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

disable_bypasslist_firewall_rules&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    nft delete rule inet v2ray prerouting ip daddr &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; @bypasslist tcp dport 0-65535 counter redirect to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
    nft delete rule inet v2ray output ip daddr &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; @bypasslist tcp dport 0-65535 counter redirect to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
    nft delete rule inet v2ray prerouting ip daddr &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_IP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; udp dport &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNS_MIN_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;-&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_MAX_DNS_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return &lt;/span&gt;2&amp;gt;/dev/null
    nft delete rule inet v2ray output ip daddr &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_IP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; udp dport &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNS_MIN_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;-&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_MAX_DNS_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return &lt;/span&gt;2&amp;gt;/dev/null
    nft delete rule inet v2ray prerouting ip daddr &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; @bypasslist udp dport 0-65535 counter redirect to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
    nft delete rule inet v2ray output ip daddr &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; @bypasslist udp dport 0-65535 counter redirect to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

enable_gfwlist_firewall_rules&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    nft add rule inet v2ray prerouting ip daddr @gfwlist tcp dport 0-65535 counter redirect to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
    nft add rule inet v2ray output ip daddr @gfwlist tcp dport 0-65535 counter redirect to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
    nft add rule inet v2ray prerouting ip daddr &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_IP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; udp dport &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNS_MIN_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;-&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_MAX_DNS_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return &lt;/span&gt;2&amp;gt;/dev/null
    nft add rule inet v2ray output ip daddr &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_IP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; udp dport &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNS_MIN_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;-&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_MAX_DNS_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return &lt;/span&gt;2&amp;gt;/dev/null
    nft add rule inet v2ray prerouting ip daddr @gfwlist udp dport 0-65535 counter redirect to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
    nft add rule inet v2ray output ip daddr @gfwlist udp dport 0-65535 counter redirect to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

disable_gfwlist_firewall_rules&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    nft delete rule inet v2ray prerouting ip daddr @gfwlist tcp dport 0-65535 counter redirect to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
    nft delete rule inet v2ray output ip daddr @gfwlist tcp dport 0-65535 counter redirect to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
    nft delete rule inet v2ray prerouting ip daddr &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_IP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; udp dport &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNS_MIN_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;-&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_MAX_DNS_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return &lt;/span&gt;2&amp;gt;/dev/null
    nft delete rule inet v2ray output ip daddr &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_IP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; udp dport &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CHINADNS_MIN_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;-&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_MAX_DNS_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return &lt;/span&gt;2&amp;gt;/dev/null
    nft delete rule inet v2ray prerouting ip daddr @gfwlist udp dport 0-65535 counter redirect to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
    nft delete rule inet v2ray output ip daddr @gfwlist udp dport 0-65535 counter redirect to :&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;V2RAY_PORT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; 2&amp;gt;/dev/null
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

disable_v2ray_rules&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if &lt;/span&gt;nft list table inet v2ray 2&amp;gt;/dev/null &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;/dev/null&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;nft flush table inet v2ray
    &lt;span class=&quot;k&quot;&gt;else
        &lt;/span&gt;nft add table inet v2ray
    &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;
    
    &lt;span class=&quot;c&quot;&gt;# åˆ›å»ºæˆ–æ¸…ç©º setï¼šgfwlist&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if &lt;/span&gt;nft list &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;inet v2ray gfwlist 2&amp;gt;/dev/null &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;/dev/null&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;nft delete &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;inet v2ray gfwlist
    &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# åˆ›å»º gfwlist é›†åˆ&lt;/span&gt;
    nft add &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;inet v2ray gfwlist &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;ipv4_addr&lt;span class=&quot;se&quot;&gt;\;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    set_multi_domestic_dns
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ingfw&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /tmp/v2raymode.txt
    
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

stop_service&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] åœæ­¢ v2ray æœåŠ¡&quot;&lt;/span&gt;
    disable_v2ray_rules
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

enable_v2ray_rules&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;running_v2ray_mode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /tmp/v2raymode.txt 2&amp;gt;/dev/null | &lt;span class=&quot;nb&quot;&gt;tr&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;\r&apos;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;uci get advancedconfig.@rules[0].v2raymode 2&amp;gt;/dev/null&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; x&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; x&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;running_v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] v2rayæ¨¡å¼æœªå˜åŒ–&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] v2rayæ¨¡å¼å·²å˜åŒ–&quot;&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] è®¾ç½®&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;æ¨¡å¼ä¸­&quot;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;outlands&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
            &lt;/span&gt;disable_gfwlist_firewall_rules
            create_bypasslist
            enable_bypasslist_firewall_rules
            set_multi_foreign_dns
        
        &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;gfwlist&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
            &lt;/span&gt;disable_bypasslist_firewall_rules
            create_gfwlist
            enable_gfwlist_firewall_rules
            set_multi_foreign_dns
        
        &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ingfw&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
            &lt;/span&gt;disable_v2ray_rules
        &lt;span class=&quot;k&quot;&gt;fi
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /tmp/v2raymode.txt
    &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

start_service&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] å¯åŠ¨ v2ray æœåŠ¡&quot;&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; /var/log/v2ray
    &lt;span class=&quot;nb&quot;&gt;ulimit&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; 65535
    procd_open_instance
    procd_set_param &lt;span class=&quot;nb&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$V2RAY_BIN&lt;/span&gt; run &lt;span class=&quot;nt&quot;&gt;-config&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$V2RAY_CONF&lt;/span&gt;
    procd_set_param file &lt;span class=&quot;nv&quot;&gt;$V2RAY_CONF&lt;/span&gt;
    procd_set_param respawn
    procd_set_param stdout 1
    procd_set_param stderr 1
    procd_set_param pidfile /var/run/v2ray.pid
    enable_v2ray_rules
    procd_close_instance
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

service_triggers&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    procd_add_reload_trigger &lt;span class=&quot;s2&quot;&gt;&quot;advancedconfig&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
      

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2)ä¿®æ”¹/etc/dnsmasq.d/ä¸‹çš„confæ–‡ä»¶ï¼š&lt;/p&gt;

&lt;p&gt;å°†åŸæ¥çš„æ‰€æœ‰&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;nv&quot;&gt;ipset&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/xxxx.com/gfwlist

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å…¨éƒ¨ä¿®æ”¹ä¸ºï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;nv&quot;&gt;nftset&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/xxxx.com/4#inet#v2ray#gfwlist

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œconfæ–‡ä»¶ä¸èƒ½æœ‰windowsæ¢è¡Œç¬¦ï¼Œå› ä¸ºnftsetå¯¹äºæ ¼å¼éå¸¸æ•æ„Ÿï¼Œä¹‹å‰windowsæ¢è¡Œç¬¦å¯¹äºipsetæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¯¹äºnftsetå°±æ— æ³•æ­£å¸¸æ‰§è¡Œã€‚&lt;/p&gt;

&lt;p&gt;3ï¼‰å¯¹åº”çš„/etc/config/chinadnsæ–‡ä»¶ï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
config chinadns
	option chnroute &lt;span class=&quot;s1&quot;&gt;&apos;/etc/chinadns_chnroute.txt&apos;&lt;/span&gt;
	option addr &lt;span class=&quot;s1&quot;&gt;&apos;0.0.0.0&apos;&lt;/span&gt;
	option &lt;span class=&quot;nb&quot;&gt;enable&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;1&apos;&lt;/span&gt;
	option port &lt;span class=&quot;s1&quot;&gt;&apos;5355&apos;&lt;/span&gt;
	option bidirectional &lt;span class=&quot;s1&quot;&gt;&apos;0&apos;&lt;/span&gt;
	option server &lt;span class=&quot;s1&quot;&gt;&apos;114.114.114.114,127.0.0.1:5354&apos;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;4ï¼‰å¯¹åº”çš„/root/start_multi_chinadns.shæ–‡ä»¶ï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;c&quot;&gt;#!/bin/sh&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# å¯åŠ¨å¤šä¸ª chinadns å®ä¾‹å¹¶ä½¿ç”¨ä¸åŒçš„å›½å†… DNS å’Œç«¯å£&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ä¾èµ–ï¼šchinadnsã€v2rayã€dnsmasq-fullã€coreutils-nohup&lt;/span&gt;

killall chinadns 2&amp;gt;/dev/null
/etc/init.d/chinadns restart
&lt;span class=&quot;nb&quot;&gt;sleep &lt;/span&gt;1

start_chinadns&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;local &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;local &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dns&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$2&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;local &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2port&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$3&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;nohup&lt;/span&gt; /usr/bin/chinadns &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-b&lt;/span&gt; 0.0.0.0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$port&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$dns&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;,127.0.0.1:&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$v2port&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; /etc/chinadns_chnroute.txt &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;/dev/null 2&amp;gt;&amp;amp;1 &amp;amp;
  &lt;span class=&quot;nb&quot;&gt;sleep &lt;/span&gt;1
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

start_chinadns 5357 119.29.29.29 5356
start_chinadns 5359 223.5.5.5    5358
start_chinadns 5361 180.76.76.76 5360

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;5ï¼‰å¯¹åº”çš„/etc/config/v2rayé…ç½®ï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;s2&quot;&gt;&quot;inbounds&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;    
      &lt;span class=&quot;s2&quot;&gt;&quot;protocol&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;dokodemo-door&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 1060,
      &lt;span class=&quot;s2&quot;&gt;&quot;listen&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;0.0.0.0&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;sniffing&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;enabled&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;destOverride&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;http&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;tls&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
       &lt;span class=&quot;s2&quot;&gt;&quot;settings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
         &lt;span class=&quot;s2&quot;&gt;&quot;network&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;tcp,udp&quot;&lt;/span&gt;,
         &lt;span class=&quot;s2&quot;&gt;&quot;followRedirect&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt; 
       &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;protocol&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;dokodemo-door&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;listen&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;0.0.0.0&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 5354,
      &lt;span class=&quot;s2&quot;&gt;&quot;settings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;address&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;8.8.8.8&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 53,
        &lt;span class=&quot;s2&quot;&gt;&quot;network&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;udp&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;timeout&quot;&lt;/span&gt;: 0,
        &lt;span class=&quot;s2&quot;&gt;&quot;followRedirect&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;protocol&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;dokodemo-door&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;listen&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;0.0.0.0&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 5356,
      &lt;span class=&quot;s2&quot;&gt;&quot;settings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;address&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;8.8.8.8&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 53,
        &lt;span class=&quot;s2&quot;&gt;&quot;network&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;udp&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;timeout&quot;&lt;/span&gt;: 0,
        &lt;span class=&quot;s2&quot;&gt;&quot;followRedirect&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;protocol&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;dokodemo-door&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;listen&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;0.0.0.0&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 5358,
      &lt;span class=&quot;s2&quot;&gt;&quot;settings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;address&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;1.1.1.1&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 53,
        &lt;span class=&quot;s2&quot;&gt;&quot;network&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;udp&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;timeout&quot;&lt;/span&gt;: 0,
        &lt;span class=&quot;s2&quot;&gt;&quot;followRedirect&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;protocol&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;dokodemo-door&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;listen&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;0.0.0.0&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 5360,
      &lt;span class=&quot;s2&quot;&gt;&quot;settings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;address&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;8.8.4.4&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 53,
        &lt;span class=&quot;s2&quot;&gt;&quot;network&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;udp&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;timeout&quot;&lt;/span&gt;: 0,
        &lt;span class=&quot;s2&quot;&gt;&quot;followRedirect&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;outbounds&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;protocol&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;vless&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;tag&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;proxy&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;settings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;vnext&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;s2&quot;&gt;&quot;address&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;xxx.com&quot;&lt;/span&gt;, &lt;span class=&quot;c&quot;&gt;#éœ€æ”¹ä¸ºå®é™…ç½‘å€&lt;/span&gt;
            &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 443,
            &lt;span class=&quot;s2&quot;&gt;&quot;users&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
              &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;s2&quot;&gt;&quot;id&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;UUID&quot;&lt;/span&gt;, &lt;span class=&quot;c&quot;&gt;#éœ€æ”¹ä¸ºå®é™…UUID&lt;/span&gt;
                &lt;span class=&quot;s2&quot;&gt;&quot;encryption&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;none&quot;&lt;/span&gt;
              &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;streamSettings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;network&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;ws&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;security&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;tls&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;wsSettings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;s2&quot;&gt;&quot;path&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;/path&quot;&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;#éœ€æ”¹ä¸ºå®é™…è·¯å¾„&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;tcpSettings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;s2&quot;&gt;&quot;allowInsecureCiphers&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;


&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å‚è€ƒï¼š
1.chatgpt
2.https://www.abcde.im/archives/112.html&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>openwrtè·¯ç”±éƒ¨ç½²wireguardå®ç°ä¸¤åœ°ç»„ç½‘</title>
   <link href="https://jibenfa.github.io/openwrt/2024/12/19/openwrtE8B7AFE794B1E9A3A8E7BDB2wireguardE5AE9EE78EE7B8AEE4B8A4E59C84E7BB84E7BD91/"/>
   <updated>2024-12-19T06:12:12+00:00</updated>
   <id>https://jibenfa.github.io/openwrt/2024/12/19/openwrtE8B7AFE794B1E9A3A8E7BDB2wireguardE5AE9EE78EE7B8AEE4B8A4E59C84E7BB84E7BD91</id>
   <content type="html">&lt;p&gt;å¾ˆä¹…æ²¡å‡çº§è·¯ç”±äº†ï¼Œæœ€è¿‘openwrtå’Œopenvpnåˆæ›´æ–°ç‰ˆæœ¬äº†ï¼Œå¯¼è‡´ä¹‹å‰çš„openwrtè·¯ç”±ä¸‹opevpnäº’è”é…ç½®å‡ºäº†äº›é—®é¢˜ï¼Œè¿åŒWindowsä¸‹tapæ¨¡å¼è®¿é—®å±€åŸŸç½‘ä¹Ÿå¤±æ•ˆäº†ï¼Œé…äº†åŠå¤©éƒ½æœªæˆåŠŸï¼Œåªèƒ½ä½¿ç”¨tunæ¨¡å¼ã€‚&lt;/p&gt;

&lt;p&gt;ç„¶åç ”ç©¶äº†ä¸€ä¸‹wireguardï¼Œå‘ç°é…ç½®æ¯”openvpnç®€å•å¤ªå¤šäº†ã€‚äºæ˜¯å†³å®šç”¨wireguardã€‚&lt;/p&gt;

&lt;p&gt;é…ç½®æ–¹æ³•è®°å½•ä¸€ä¸‹å¤‡å¿˜ï¼š&lt;/p&gt;

&lt;p&gt;ä¸¤ä¸ªè·¯ç”±ï¼š&lt;/p&gt;

&lt;p&gt;è·¯ç”±Aï¼šå…·æœ‰å¤–ç½‘ipå’ŒåŠ¨æ€åŸŸåï¼Œå†…ç½‘ç½‘æ®µ172.24.1.0/24&lt;/p&gt;

&lt;p&gt;è·¯ç”±Bï¼šæ— å¤–ç½‘ipï¼Œå†…ç½‘ç½‘æ®µ172.24.8.0/24&lt;/p&gt;

&lt;p&gt;1.ä¸¤å°è·¯ç”±å‡æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š&lt;/p&gt;

&lt;p&gt;1ï¼‰å®‰è£…wireguardï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯openwrt 23.05.5ç‰ˆæœ¬&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
opkg update
opkg &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;luci-app-wireguard kmod-wireguard wireguard-tools

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2ï¼‰ç”Ÿæˆå…¬ç§é’¥å¯¹&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
wg genkey | &lt;span class=&quot;nb&quot;&gt;tee &lt;/span&gt;privatekey | wg pubkey &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; publickey

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3ï¼‰è°ƒæ•´é˜²ç«å¢™ï¼ˆ/etc/config/firewallï¼‰ï¼Œåœ¨æœ«å°¾å¢åŠ ï¼š&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
config zone
        option name &lt;span class=&quot;s1&quot;&gt;&apos;wg&apos;&lt;/span&gt;
        option input &lt;span class=&quot;s1&quot;&gt;&apos;ACCEPT&apos;&lt;/span&gt;
        option forward &lt;span class=&quot;s1&quot;&gt;&apos;ACCEPT&apos;&lt;/span&gt;
        option output &lt;span class=&quot;s1&quot;&gt;&apos;ACCEPT&apos;&lt;/span&gt;
        option masq &lt;span class=&quot;s1&quot;&gt;&apos;1&apos;&lt;/span&gt;
        option mtu_fix &lt;span class=&quot;s1&quot;&gt;&apos;1&apos;&lt;/span&gt;
        list network &lt;span class=&quot;s1&quot;&gt;&apos;wg0&apos;&lt;/span&gt;

config forwarding
        option src &lt;span class=&quot;s1&quot;&gt;&apos;wg&apos;&lt;/span&gt;
        option dest &lt;span class=&quot;s1&quot;&gt;&apos;lan&apos;&lt;/span&gt;

config forwarding
        option src &lt;span class=&quot;s1&quot;&gt;&apos;lan&apos;&lt;/span&gt;
        option dest &lt;span class=&quot;s1&quot;&gt;&apos;wg&apos;&lt;/span&gt;

config forwarding
        option src &lt;span class=&quot;s1&quot;&gt;&apos;wg&apos;&lt;/span&gt;
        option dest &lt;span class=&quot;s1&quot;&gt;&apos;lan&apos;&lt;/span&gt;

config rule
        option name &lt;span class=&quot;s1&quot;&gt;&apos;wireguard&apos;&lt;/span&gt;
        option src &lt;span class=&quot;s1&quot;&gt;&apos;wan&apos;&lt;/span&gt;
        option dest &lt;span class=&quot;s1&quot;&gt;&apos;*&apos;&lt;/span&gt;
        option dest_port &lt;span class=&quot;s1&quot;&gt;&apos;51820&apos;&lt;/span&gt;
        option target &lt;span class=&quot;s1&quot;&gt;&apos;ACCEPT&apos;&lt;/span&gt;


&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2.åœ¨è·¯ç”±Aä¸Šè®¾ç½®ç½‘ç»œæ¥å£ï¼ˆ/etc/config/networkï¼‰ï¼Œåœ¨æœ€åå¢åŠ ï¼š&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
config interface &lt;span class=&quot;s1&quot;&gt;&apos;wg0&apos;&lt;/span&gt;
        option proto &lt;span class=&quot;s1&quot;&gt;&apos;wireguard&apos;&lt;/span&gt;
        option private_key &lt;span class=&quot;s1&quot;&gt;&apos;è·¯ç”±Aç§é’¥&apos;&lt;/span&gt;
        list addresses &lt;span class=&quot;s1&quot;&gt;&apos;10.168.10.1/24&apos;&lt;/span&gt;
        option listen_port &lt;span class=&quot;s1&quot;&gt;&apos;51820&apos;&lt;/span&gt;

config wireguard_wg0
        option description &lt;span class=&quot;s1&quot;&gt;&apos;router&apos;&lt;/span&gt;
        option public_key &lt;span class=&quot;s1&quot;&gt;&apos;è·¯ç”±Bå…¬é’¥&apos;&lt;/span&gt;
        option persistent_keepalive &lt;span class=&quot;s1&quot;&gt;&apos;25&apos;&lt;/span&gt;
        list allowed_ips &lt;span class=&quot;s1&quot;&gt;&apos;10.168.10.3/32&apos;&lt;/span&gt;
        list allowed_ips &lt;span class=&quot;s1&quot;&gt;&apos;172.24.8.0/24&apos;&lt;/span&gt;

config route
        option interface &lt;span class=&quot;s1&quot;&gt;&apos;wg0&apos;&lt;/span&gt;
        option target &lt;span class=&quot;s1&quot;&gt;&apos;172.24.8.0/24&apos;&lt;/span&gt;
        option gateway &lt;span class=&quot;s1&quot;&gt;&apos;10.168.10.1&apos;&lt;/span&gt;
        option metric &lt;span class=&quot;s1&quot;&gt;&apos;1&apos;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3.åœ¨è·¯ç”±Bä¸Šè®¾ç½®ç½‘ç»œæ¥å£ï¼ˆ/etc/config/networkï¼‰ï¼Œåœ¨æœ€åå¢åŠ ï¼š&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
config interface &lt;span class=&quot;s1&quot;&gt;&apos;wg0&apos;&lt;/span&gt;
        option proto &lt;span class=&quot;s1&quot;&gt;&apos;wireguard&apos;&lt;/span&gt;
        option private_key &lt;span class=&quot;s1&quot;&gt;&apos;è·¯ç”±Bç§é’¥&apos;&lt;/span&gt;
        list addresses &lt;span class=&quot;s1&quot;&gt;&apos;10.168.10.3/24&apos;&lt;/span&gt;
        option listen_port &lt;span class=&quot;s1&quot;&gt;&apos;51820&apos;&lt;/span&gt;

config wireguard_wg0
        option description &lt;span class=&quot;s1&quot;&gt;&apos;router_client1&apos;&lt;/span&gt;
        option public_key &lt;span class=&quot;s1&quot;&gt;&apos;è·¯ç”±Aå…¬é’¥&apos;&lt;/span&gt;
        option endpoint_host &lt;span class=&quot;s1&quot;&gt;&apos;è·¯ç”±Açš„ddnsåŸŸå&apos;&lt;/span&gt;
        option endpoint_port &lt;span class=&quot;s1&quot;&gt;&apos;51820&apos;&lt;/span&gt;
        option persistent_keepalive &lt;span class=&quot;s1&quot;&gt;&apos;25&apos;&lt;/span&gt;
        list allowed_ips &lt;span class=&quot;s1&quot;&gt;&apos;10.168.10.1/32&apos;&lt;/span&gt;
        list allowed_ips &lt;span class=&quot;s1&quot;&gt;&apos;172.24.1.0/24&apos;&lt;/span&gt;

config route
        option interface &lt;span class=&quot;s1&quot;&gt;&apos;wg0&apos;&lt;/span&gt;
        option target &lt;span class=&quot;s1&quot;&gt;&apos;172.24.1.0/24&apos;&lt;/span&gt;
        option gateway &lt;span class=&quot;s1&quot;&gt;&apos;10.168.10.3&apos;&lt;/span&gt;
        option metric &lt;span class=&quot;s1&quot;&gt;&apos;1&apos;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;4.æœ€åé‡å¯è·¯ç”±Aå’Œè·¯ç”±Bï¼Œä¸¤ä¸ªè·¯ç”±é—´çš„å±€åŸŸç½‘å°±å¯ä»¥äº’ç›¸è®¿é—®äº†&lt;/p&gt;

&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;

&lt;p&gt;1.https://www.knightli.com/2022/04/14/openwrt-wireguard-connect-two-network/&lt;/p&gt;

&lt;p&gt;2.chatgpt&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>openwrtä¸‹è§£å†³dnsmasq cannot access directory çš„é—®é¢˜</title>
   <link href="https://jibenfa.github.io/openwrt/2024/12/18/openwrtE4B88BE8A7A3E586B3dnsmasq20cannot20access20directory20E79A84E997AEE9A298/"/>
   <updated>2024-12-18T09:39:31+00:00</updated>
   <id>https://jibenfa.github.io/openwrt/2024/12/18/openwrtE4B88BE8A7A3E586B3dnsmasq20cannot20access20directory20E79A84E997AEE9A298</id>
   <content type="html">&lt;p&gt;æœ€è¿‘æ›´æ–°äº†openwrtç‰ˆæœ¬ï¼Œç»“æœè®¾ç½®dnsmasq-fullçš„æ—¶å€™å‘ç°æ— æ³•å¯åŠ¨dnsmasqï¼ŒæŸ¥æ—¥å¿—å‘ç°æœ‰ä¸ªæŠ¥é”™ï¼š&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
daemon.crit dnsmasq[1]: cannot access directory /etc/dnsmasq.d: No such file or directory

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;æ˜æ˜å·²ç»è®¾ç½®è¯¥æ–‡ä»¶å¤¹ä¸º777æƒé™äº†ï¼Œè¿˜æ˜¯æœ‰è¿™ä¸ªé—®é¢˜ï¼Œåæ¥æŸ¥é˜…èµ„æ–™å‘ç°openwrt 22.03.0ç‰ˆæœ¬åï¼Œé™åˆ¶äº†dnsmasqçš„æ–‡ä»¶å¤¹è®¿é—®æƒé™ã€‚&lt;/p&gt;

&lt;p&gt;å¤„ç†æ–¹å¼æ˜¯ï¼š&lt;/p&gt;

&lt;p&gt;1.å°†/etc/dnsmasq.confä¸‹çš„é…ç½®æ³¨é‡Šæ‰æˆ–è€…åˆ æ‰ï¼š&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;c&quot;&gt;#conf-dir=/etc/dnsmasq.d&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;2.åœ¨/etc/config/dhcpçš„é…ç½®æ–‡ä»¶ä¸­çš„dnsmasqé…ç½®ä¸­å¢åŠ ä¸€æ¡ï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
config dnsmasq
	...
 	option confdir &lt;span class=&quot;s1&quot;&gt;&apos;/etc/dnsmasq.d&apos;&lt;/span&gt;
	...

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;3.é‡å¯dnsmasqæœåŠ¡å³å¯ã€‚&lt;/p&gt;

&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;

&lt;p&gt;1.https://github.com/openwrt/openwrt/issues/10625&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>openwrtä¸‹æ–°ç‰ˆopenvpnè®¾ç½®</title>
   <link href="https://jibenfa.github.io/openwrt/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/2021/05/07/openwrtE4B88BE696B0E78988openvpnE8AEBEE7BDAE/"/>
   <updated>2021-05-07T22:39:31+00:00</updated>
   <id>https://jibenfa.github.io/openwrt/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/2021/05/07/openwrtE4B88BE696B0E78988openvpnE8AEBEE7BDAE</id>
   <content type="html">&lt;p&gt;æœ€è¿‘æ›´æ–°äº†openvpnç‰ˆæœ¬ï¼Œä¸€äº›å‘½ä»¤å’Œè®¾ç½®è·Ÿä»¥å‰ä¸ä¸€æ ·äº†ã€‚ç°è®°å½•ä¸€ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;1.ç”Ÿæˆè¯ä¹¦&lt;/p&gt;

&lt;p&gt;1ï¼‰ç¼–è¾‘/etc/easy-rsa/varsï¼Œä¿®æ”¹éƒ¨åˆ†å†…å®¹&lt;/p&gt;

&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# Choose &lt;span class=&quot;k&quot;&gt;a&lt;/span&gt; size &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; bits &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; your keypairs&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; The recommended value &lt;span class=&quot;k&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2048&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;  Using
# &lt;span class=&quot;m&quot;&gt;2048&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;bit &lt;span class=&quot;nb&quot;&gt;keys&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;is&lt;/span&gt; considered &lt;span class=&quot;nb&quot;&gt;more&lt;/span&gt; than sufficient &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; many years into the
# future&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; Larger keysizes will slow down TLS negotiation &lt;span class=&quot;nb&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;make&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;key&lt;/span&gt;/DH param
# generation take much longer&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; Values &lt;span class=&quot;k&quot;&gt;up&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;4096&lt;/span&gt; should be accepted by most
# software&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; Only used when the crypto alg &lt;span class=&quot;k&quot;&gt;is&lt;/span&gt; rsa &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;see below&lt;span class=&quot;p&quot;&gt;.)&lt;/span&gt;

set_var EASYRSA_KEY_SIZE	&lt;span class=&quot;m&quot;&gt;4096&lt;/span&gt;

# In how many days should the root CA &lt;span class=&quot;nb&quot;&gt;key&lt;/span&gt; expire?

set_var EASYRSA_CA_EXPIRE	&lt;span class=&quot;m&quot;&gt;3650&lt;/span&gt;

# In how many days should certificates expire?

set_var EASYRSA_CERT_EXPIRE	&lt;span class=&quot;m&quot;&gt;3650&lt;/span&gt;

# These are the default &lt;span class=&quot;nb&quot;&gt;values&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; fields
# which will be placed &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; the certificate&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;
# Don&apos;&lt;span class=&quot;k&quot;&gt;t&lt;/span&gt; leave any of these fields blank&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;export&lt;/span&gt; KEY_COUNTRY&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;xx&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;export&lt;/span&gt; KEY_PROVINCE&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;xx&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;export&lt;/span&gt; KEY_CITY&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;xxxx&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;export&lt;/span&gt; KEY_ORG&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;XXxxxx&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;export&lt;/span&gt; KEY_EMAIL&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;xxxxxx@gmail.com&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;export&lt;/span&gt; KEY_OU&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;XXxxxxxx&quot;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2ï¼‰æ¥ç€ç”Ÿæˆè¯ä¹¦å’Œdiffie-hellman keyï¼š&lt;br /&gt;
æ‰‹å·¥æ¸…ç©º/etc/easy-rsa/ä¸‹çš„keyç›®å½•æˆ–è€…è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
easyrsa clean&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;all&lt;/span&gt;  
easyrsa init&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;pki

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ç”Ÿæˆcaè¯ä¹¦&lt;/p&gt;
&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
easyrsa build&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;ca&lt;/span&gt; nopass 

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ç”Ÿæˆdhå¯†é’¥&lt;/p&gt;
&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
easyrsa gen&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;dh  

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;æœåŠ¡å™¨è¯ä¹¦&lt;/p&gt;
&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
easyrsa build&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;server&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;full server nopass

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;å®¢æˆ·ç«¯è¯ä¹¦ç»™coffeecat&lt;/p&gt;
&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
easyrsa build&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;client&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;full coffeecat nopass

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ç”Ÿæˆta.key&lt;/p&gt;
&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
openvpn &lt;span class=&quot;p&quot;&gt;--&lt;/span&gt;genkey &lt;span class=&quot;p&quot;&gt;--&lt;/span&gt;secret &lt;span class=&quot;k&quot;&gt;ta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;key&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3ï¼‰æ‹·è´åˆ°æœåŠ¡å™¨ç›®å½•ä¸‹ï¼š&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /etc/easy-rsa/keys/
&lt;span class=&quot;nb&quot;&gt;cp &lt;/span&gt;ca.crt ca.key dh4096.pem server.key server.crt ta.key /etc/openvpn/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;4ï¼‰å°†ä»¥ä¸‹æ–‡ä»¶æ‹·è´åˆ°å®¢æˆ·ç«¯æˆ–è€…å°†æ–‡ä»¶çš„å†…å®¹è´´åœ¨å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ä¸­ï¼ˆç§»åŠ¨è®¾å¤‡ï¼‰ï¼š&lt;br /&gt;
ca.crt dh4096.pem coffeecat.key coffeecat.crt ta.key&lt;/p&gt;

&lt;p&gt;5ï¼‰ç„¶åå°±æ˜¯æœ€å…³é”®çš„é…ç½®openvpnæœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯äº†ï¼š&lt;br /&gt;
è·¯ç”±å™¨æœåŠ¡å™¨ç«¯ï¼š&lt;br /&gt;
ç¼–è¾‘/etc/config/openvpn :&lt;/p&gt;

&lt;p&gt;&lt;em&gt;æ³¨æ„ï¼š172.24.1.1ä¸ºè·¯ç”±å™¨çš„lan ipï¼Œ10.1.1.0/24æ˜¯ä¸ºvpnå®¢æˆ·ç«¯åˆ†é…çš„ipæ®µï¼Œä¸€å®šè¦å’Œè·¯ç”±å™¨ä¸ºlan dhcpçš„ipæ®µé”™å¼€ã€‚&lt;/em&gt;&lt;/p&gt;

&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;

config openvpn &lt;span class=&quot;s1&quot;&gt;&apos;tun_cert&apos;&lt;/span&gt;
	option port &lt;span class=&quot;s1&quot;&gt;&apos;3366&apos;&lt;/span&gt;
	option proto &lt;span class=&quot;s1&quot;&gt;&apos;tcp4&apos;&lt;/span&gt;
	option dev &lt;span class=&quot;s1&quot;&gt;&apos;tun0&apos;&lt;/span&gt;
	option &lt;span class=&quot;k&quot;&gt;ca&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;/etc/openvpn/ca.crt&apos;&lt;/span&gt;
	option cert &lt;span class=&quot;s1&quot;&gt;&apos;/etc/openvpn/server.crt&apos;&lt;/span&gt;
	option &lt;span class=&quot;nb&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;/etc/openvpn/server.key&apos;&lt;/span&gt;
	option dh &lt;span class=&quot;s1&quot;&gt;&apos;/etc/openvpn/dh4096.pem&apos;&lt;/span&gt;
  	option tls_auth &lt;span class=&quot;s1&quot;&gt;&apos;/etc/openvpn/ta.key 0&apos;&lt;/span&gt;
	option server &lt;span class=&quot;s1&quot;&gt;&apos;10.1.1.0 255.255.255.0&apos;&lt;/span&gt;
	option client_config_dir &lt;span class=&quot;s1&quot;&gt;&apos;/etc/openvpn/tunstatic&apos;&lt;/span&gt;
	option ccd_exclusive &lt;span class=&quot;s1&quot;&gt;&apos;1&apos;&lt;/span&gt;
	option cipher &lt;span class=&quot;s1&quot;&gt;&apos;AES-256-CBC&apos;&lt;/span&gt;
	option ifconfig_pool_persist &lt;span class=&quot;s1&quot;&gt;&apos;/tmp/ipp2.txt&apos;&lt;/span&gt;
	option duplicate_cn &lt;span class=&quot;s1&quot;&gt;&apos;1&apos;&lt;/span&gt;
	option client_to_client &lt;span class=&quot;s1&quot;&gt;&apos;1&apos;&lt;/span&gt;
	option keepalive &lt;span class=&quot;s1&quot;&gt;&apos;10 120&apos;&lt;/span&gt;
	option compress &lt;span class=&quot;s1&quot;&gt;&apos;lzo&apos;&lt;/span&gt;
	option persist_key &lt;span class=&quot;s1&quot;&gt;&apos;1&apos;&lt;/span&gt;
	option persist_tun &lt;span class=&quot;s1&quot;&gt;&apos;1&apos;&lt;/span&gt;
	option status &lt;span class=&quot;s1&quot;&gt;&apos;/tmp/openvpn-status2.log&apos;&lt;/span&gt;
	option &lt;span class=&quot;k&quot;&gt;verb&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;3&apos;&lt;/span&gt;
	option topology &lt;span class=&quot;s1&quot;&gt;&apos;subnet&apos;&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;list&lt;/span&gt; push &lt;span class=&quot;s1&quot;&gt;&apos;dhcp-option DNS 172.24.1.1&apos;&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;list&lt;/span&gt; push &lt;span class=&quot;s1&quot;&gt;&apos;redirect-gateway def1 local&apos;&lt;/span&gt;
	option enabled &lt;span class=&quot;s1&quot;&gt;&apos;1&apos;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åœ¨/etc/openvpn/tunstaticæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºåä¸ºcoffeecatçš„æ–‡ä»¶ï¼Œå†…å®¹ä¸ºï¼š&lt;/p&gt;

&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
ifconfig&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;push &lt;span class=&quot;m&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;7&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç„¶ååœ¨luciæˆ–è€…å‘½ä»¤è¡Œå¯åŠ¨openvpnï¼š&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/etc/init.d/openvpn restart
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;psä¸€ä¸‹æœ‰è¿›ç¨‹å°±å¯¹äº†&lt;/p&gt;

&lt;p&gt;openvpnå®¢æˆ·ç«¯é…ç½®client.ovpn,æ­¤å¤„è®¾ç½®ä¸ºå•æ–‡ä»¶æ¨¡å¼ï¼š&lt;/p&gt;
&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
client
dev tun
proto tcp4
connect&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;retry&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;max&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
connect&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;retry &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;


remote ä½ çš„æœåŠ¡å™¨åœ°å€ &lt;span class=&quot;m&quot;&gt;3366&lt;/span&gt;
resolv&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;retry infinite
nobind
float
persist&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;key&lt;/span&gt;
persist&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;tun
remote&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;cert&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;tls server
&lt;span class=&quot;k&quot;&gt;comp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;lzo
&lt;span class=&quot;k&quot;&gt;verb&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;
cipher		AES&lt;span class=&quot;m&quot;&gt;-256&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;CBC
tun&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;mtu		&lt;span class=&quot;m&quot;&gt;1500&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;direction &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;tls&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;auth&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;
#
# &lt;span class=&quot;m&quot;&gt;2048&lt;/span&gt; bit OpenVPN static &lt;span class=&quot;nb&quot;&gt;key&lt;/span&gt;
#
&lt;span class=&quot;p&quot;&gt;-----&lt;/span&gt;BEGIN OpenVPN Static &lt;span class=&quot;nb&quot;&gt;key&lt;/span&gt; V1&lt;span class=&quot;p&quot;&gt;-----&lt;/span&gt;
æ­¤å¤„çœç•¥ã€‚ã€‚ã€‚ã€‚ã€‚
&lt;span class=&quot;p&quot;&gt;-----&lt;/span&gt;END OpenVPN Static &lt;span class=&quot;nb&quot;&gt;key&lt;/span&gt; V1&lt;span class=&quot;p&quot;&gt;-----&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;/tls&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;auth&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;ca&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;-----&lt;/span&gt;BEGIN CERTIFICATE&lt;span class=&quot;p&quot;&gt;-----&lt;/span&gt;
æ­¤å¤„çœç•¥ã€‚ã€‚ã€‚ã€‚ã€‚
&lt;span class=&quot;p&quot;&gt;-----&lt;/span&gt;END CERTIFICATE&lt;span class=&quot;p&quot;&gt;-----&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;ca&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;cert&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;-----&lt;/span&gt;BEGIN CERTIFICATE&lt;span class=&quot;p&quot;&gt;-----&lt;/span&gt;
æ­¤å¤„çœç•¥ã€‚ã€‚ã€‚ã€‚ã€‚
&lt;span class=&quot;p&quot;&gt;-----&lt;/span&gt;END CERTIFICATE&lt;span class=&quot;p&quot;&gt;-----&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;/cert&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;-----&lt;/span&gt;BEGIN PRIVATE KEY&lt;span class=&quot;p&quot;&gt;-----&lt;/span&gt;
æ­¤å¤„çœç•¥ã€‚ã€‚ã€‚ã€‚ã€‚
&lt;span class=&quot;p&quot;&gt;-----&lt;/span&gt;END PRIVATE KEY&lt;span class=&quot;p&quot;&gt;-----&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;/&lt;span class=&quot;nb&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;


&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ç‰¹åˆ«è¦æ³¨æ„çš„æ˜¯ï¼Œserveré…ç½®æ–‡ä»¶ä¸­çš„ï¼š&lt;/p&gt;
&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
option tls_auth &lt;span class=&quot;s1&quot;&gt;&apos;/etc/openvpn/ta.key 0&apos;&lt;/span&gt;


&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;è¦å’Œclienté…ç½®æ–‡ä»¶ä¸­çš„ï¼š&lt;/p&gt;
&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;nb&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;direction &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;tls&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;auth&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;
#
# &lt;span class=&quot;m&quot;&gt;2048&lt;/span&gt; bit OpenVPN static &lt;span class=&quot;nb&quot;&gt;key&lt;/span&gt;
#
&lt;span class=&quot;p&quot;&gt;-----&lt;/span&gt;BEGIN OpenVPN Static &lt;span class=&quot;nb&quot;&gt;key&lt;/span&gt; V1&lt;span class=&quot;p&quot;&gt;-----&lt;/span&gt;
æ­¤å¤„çœç•¥ã€‚ã€‚ã€‚ã€‚ã€‚
&lt;span class=&quot;p&quot;&gt;-----&lt;/span&gt;END OpenVPN Static &lt;span class=&quot;nb&quot;&gt;key&lt;/span&gt; V1&lt;span class=&quot;p&quot;&gt;-----&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;/tls&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;auth&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;


&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;å¯¹åº”ï¼Œå¦åˆ™æ— æ³•è¿é€šã€‚&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>openwrtä¸‹åŸºäºDNSPODçš„DDNSè„šæœ¬</title>
   <link href="https://jibenfa.github.io/openwrt/%E7%BC%96%E7%A8%8B/2021/02/10/openwrte4b88be59fbae4ba8eDNSPODe79a84DDNSe8849ae69cac/"/>
   <updated>2021-02-10T07:25:57+00:00</updated>
   <id>https://jibenfa.github.io/openwrt/%E7%BC%96%E7%A8%8B/2021/02/10/openwrte4b88be59fbae4ba8eDNSPODe79a84DDNSe8849ae69cac</id>
   <content type="html">&lt;p&gt;æ¢dnsä¾›åº”å•†äº†ï¼Œæ’¸äº†ä¸€ä¸ªopenwrtä¸‹åŸºäºdnspod apiçš„ddnsè„šæœ¬ï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;c&quot;&gt;#!/bin/sh&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;TOKEN&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;xxx,xxxxxxxxxxxxxxx&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;DOMAIN_ID&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;xxxxxxxxx&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;SUB_DOMAIN&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;xxxx&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;MAIN_DOMAIN&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;xxxx&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;DOMAIN&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;SUB_DOMAIN&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;.&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;MAIN_DOMAIN&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;RECORD_ID&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;xxxxxx&quot;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#record_id is binding with sub_domain and main_domain, using following command to get record_id&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#curl -X POST https://dnsapi.cn/Record.List -d &apos;login_token=${TOKEN}&amp;amp;format=json&amp;amp;domain_id=${DOMAIN_ID}&amp;amp;offset=0&amp;amp;length=3&apos;&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#get domain ip from common dns&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;IP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;dig &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DOMAIN&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; @114.114.114.114 | &lt;span class=&quot;nb&quot;&gt;awk&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-F&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[ ]+&quot;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;/IN/{print $1}&apos;&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;awk&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;NR==2 {print $5}&apos;&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Ip of &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DOMAIN&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; is ---&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;IP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;---&quot;&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#get local ip from wan port&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;LIP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;ifconfig pppoe-wan|awk &lt;span class=&quot;nt&quot;&gt;-F&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[: ]+&quot;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;/inet addr/{print $4}&apos;&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Local Ip is ---&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LIP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;---&quot;&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#if domain ip and local ip are identical, dns is ok&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LIP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;IP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
   &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Doman IP not changed.&quot;&lt;/span&gt;
   &lt;span class=&quot;nb&quot;&gt;exit
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#if not identical, check dns record from ddns service provider&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;check dnspod dns record of &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DOMAIN&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;query_cmd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;curl -X POST https://dnsapi.cn/Record.Info -d &apos;login_token=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TOKEN&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;amp;format=json&amp;amp;domain_id=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DOMAIN_ID&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;amp;record_id=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;RECORD_ID&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&apos;&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;query_result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eval&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;query_cmd&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;query_result_sub_str&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;query_result&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LIP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#if dns record is ok, there is no need to update&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${#&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;query_result_sub_str&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-gt&lt;/span&gt; 6 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
   &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;IP record is OK, waiting for dns spread&quot;&lt;/span&gt;
   &lt;span class=&quot;nb&quot;&gt;exit
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#if dns record is not ok, start ddns refresh&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;start ddns refresh&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;refresh_cmd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;curl -X POST https://dnsapi.cn/Record.Ddns -d &apos;login_token=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TOKEN&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;amp;format=json&amp;amp;domain_id=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DOMAIN_ID&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;amp;record_id=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;RECORD_ID&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;amp;record_line_id=0&amp;amp;value=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LIP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;amp;sub_domain=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;SUB_DOMAIN&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&apos;&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;refreah_result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eval&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;refresh_cmd&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;refreah_result&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
</content>
 </entry>
 
 <entry>
   <title>v2rayçš„wsæ¨¡å¼åœ¨openwrtä¸Šçš„å…¨å±€å’Œç™½åå•çš„ä¼˜åŒ–é…ç½®</title>
   <link href="https://jibenfa.github.io/openwrt/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/2020/03/24/v2rayE79A84wsE6A8A1E5BC8FE59CA8openwrtE4B88AE79A84E585A8E5B180E5928CE799BDE5908DE58D95E79A84E4BC98E58C96E9858DE7BDAE/"/>
   <updated>2020-03-24T14:25:57+00:00</updated>
   <id>https://jibenfa.github.io/openwrt/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/2020/03/24/v2rayE79A84wsE6A8A1E5BC8FE59CA8openwrtE4B88AE79A84E585A8E5B180E5928CE799BDE5908DE58D95E79A84E4BC98E58C96E9858DE7BDAE</id>
   <content type="html">&lt;p&gt;ä¸€ã€ç®€ä»‹&lt;/p&gt;

&lt;p&gt;éšç€v2rayçš„ws+tls+cdnæˆä¸ºæ ‡é…ï¼Œopenwrtä¸Šå¯¹åº”çš„é€æ˜ä»£ç†çš„é…ç½®ä¸€èˆ¬æœ‰ä¸¤ç§æ¨¡å¼ï¼š&lt;/p&gt;

&lt;p&gt;1.ç™½åå•ä»£ç†æ¨¡å¼ã€‚&lt;/p&gt;

&lt;p&gt;ä¼˜ç‚¹æ˜¯ï¼šç½‘é¡µåŠ è½½é€Ÿåº¦è¾ƒå…¨å±€æ¨¡å¼å¿«&lt;/p&gt;

&lt;p&gt;ç¼ºç‚¹æ˜¯ï¼šä¸åŠ å…¥gfwlistä¸”è¢«å¢™çš„ç½‘ç«™æ‰“ä¸å¼€ï¼Œéœ€è¦æ‰‹åŠ¨åŠ ç™½åå•&lt;/p&gt;

&lt;p&gt;2.å¢ƒå¤–å…¨å±€ä»£ç†æ¨¡å¼ã€‚&lt;/p&gt;

&lt;p&gt;ä¼˜ç‚¹æ˜¯ï¼šæ‰€æœ‰è¢«å¢™çš„ç½‘ç«™éƒ½èƒ½æ‰“å¼€ï¼Œä¸ç”¨ç»´æŠ¤å¤æ‚çš„gfwlist&lt;/p&gt;

&lt;p&gt;ç¼ºç‚¹æ˜¯ï¼šç½‘é¡µåŠ è½½é€Ÿåº¦è¾ƒç™½åå•ä»£ç†æ¨¡å¼æ…¢ä¸€äº›&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;äºŒã€ä¸ºä»€ä¹ˆè¦ä¼˜åŒ–&lt;/p&gt;

&lt;p&gt;æ‰€è°“çš„ä¼˜åŒ–é…ç½®ï¼Œä¸»è¦æ˜¯è§£å†³å‡ ä¸ªé—®é¢˜ï¼š&lt;/p&gt;

&lt;p&gt;1.ç®€åŒ–v2rayçš„é…ç½®ï¼Œå°½é‡ä¸ä½¿ç”¨sniffingå—…æ¢ã€geoipã€geositeç­‰ï¼Œä¸€æ–¹é¢æå‡v2rayçš„é€Ÿåº¦å’Œç¨³å®šæ€§ï¼Œä¸€æ–¹é¢å¯ä»¥å‡å°‘è·¯ç”±ç©ºé—´çš„å ç”¨ï¼ˆå¯ä»¥ä½¿ç”¨ç©ºåº“çš„geoipå’Œgeositeï¼Œåªéœ€å…±ç”¨chinadnsçš„æ•°æ®æ–‡ä»¶ï¼‰&lt;/p&gt;

&lt;p&gt;2.ç®€åŒ–firewallè§„åˆ™é…ç½®ï¼Œå°½é‡å‡å°‘ipsetæ¡ç›®ï¼Œä¸å½±å“å¢ƒå†…ç½‘ç«™çš„è®¿é—®é€Ÿåº¦ï¼ŒåŒæ—¶ä¿è¯å¯ä»¥è®¿é—®å¤–ç½‘ã€‚&lt;/p&gt;

&lt;p&gt;3.ä½¿ç”¨chinadnsè§£å†³dnsæ±¡æŸ“é—®é¢˜ï¼Œä¿è¯pingå¤–ç½‘çš„æ—¶å€™èƒ½æ­£ç¡®è·å¾—ipï¼Œä¸”åˆ©ç”¨apnicçš„ç½‘å€åˆ—è¡¨æ¥åŒºåˆ†å¢ƒå†…å¤–ã€‚&lt;/p&gt;

&lt;p&gt;4.é€šè¿‡è‡ªå®šä¹‰lucié¡µé¢ï¼Œå®ç°å…¨å±€å’Œç™½åå•æ¨¡å¼çµæ´»åˆ‡æ¢&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;ä¸‰ã€æ€ä¹ˆè¿›è¡Œä¼˜åŒ–&lt;/p&gt;

&lt;p&gt;ä¸‹é¢ä»¥ws+tls+cdnä¸ºä¾‹ï¼š&lt;/p&gt;

&lt;p&gt;1.v2rayæœåŠ¡å™¨ç«¯é…ç½®å‚è€ƒï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://wallsee.org/2019/06/14/v2ray2bLetsEncrypt2bcdne983a8e7bdb2.html&quot;&gt;é…ç½®çš„ä¸€è‡³ä¸‰å°èŠ‚&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;2.chinadnsåœ¨openwrtçš„é…ç½®å‚è€ƒï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
config chinadns
	option chnroute &lt;span class=&quot;s1&quot;&gt;&apos;/etc/chinadns_chnroute.txt&apos;&lt;/span&gt;
	option addr &lt;span class=&quot;s1&quot;&gt;&apos;0.0.0.0&apos;&lt;/span&gt;
	option &lt;span class=&quot;nb&quot;&gt;enable&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;1&apos;&lt;/span&gt;
	option port &lt;span class=&quot;s1&quot;&gt;&apos;5454&apos;&lt;/span&gt;
	option server &lt;span class=&quot;s1&quot;&gt;&apos;114.114.114.114,127.0.0.1:5354&apos;&lt;/span&gt;
	option bidirectional &lt;span class=&quot;s1&quot;&gt;&apos;0&apos;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3.v2rayåœ¨openwrtå®¢æˆ·ç«¯çš„é…ç½®ä¸ºï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;inbounds&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;    
        &lt;span class=&quot;s2&quot;&gt;&quot;protocol&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;dokodemo-door&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 1060,
        &lt;span class=&quot;s2&quot;&gt;&quot;listen&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;0.0.0.0&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;sniffing&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;s2&quot;&gt;&quot;enabled&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;destOverride&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;http&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;tls&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
         &lt;span class=&quot;s2&quot;&gt;&quot;settings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
           &lt;span class=&quot;s2&quot;&gt;&quot;network&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;tcp,udp&quot;&lt;/span&gt;,
           &lt;span class=&quot;s2&quot;&gt;&quot;followRedirect&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt; 
         &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
         &lt;span class=&quot;s2&quot;&gt;&quot;streamSettings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;s2&quot;&gt;&quot;sockopt&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;s2&quot;&gt;&quot;tproxy&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;redirect&quot;&lt;/span&gt; 
             &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
         &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
      &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;protocol&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;dokodemo-door&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;listen&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;0.0.0.0&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 5354,
        &lt;span class=&quot;s2&quot;&gt;&quot;settings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;s2&quot;&gt;&quot;address&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;8.8.8.8&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 53,
          &lt;span class=&quot;s2&quot;&gt;&quot;network&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;udp&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;timeout&quot;&lt;/span&gt;: 0,
          &lt;span class=&quot;s2&quot;&gt;&quot;followRedirect&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
      &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;protocol&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;dokodemo-door&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;listen&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;0.0.0.0&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 5355,
        &lt;span class=&quot;s2&quot;&gt;&quot;settings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;s2&quot;&gt;&quot;address&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;8.8.8.8&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 53,
          &lt;span class=&quot;s2&quot;&gt;&quot;network&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;udp&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;timeout&quot;&lt;/span&gt;: 0,
          &lt;span class=&quot;s2&quot;&gt;&quot;followRedirect&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
      &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;protocol&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;dokodemo-door&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;listen&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;0.0.0.0&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 5356,
        &lt;span class=&quot;s2&quot;&gt;&quot;settings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;s2&quot;&gt;&quot;address&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;1.1.1.1&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 53,
          &lt;span class=&quot;s2&quot;&gt;&quot;network&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;udp&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;timeout&quot;&lt;/span&gt;: 0,
          &lt;span class=&quot;s2&quot;&gt;&quot;followRedirect&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
      &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;protocol&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;dokodemo-door&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;listen&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;0.0.0.0&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 5357,
        &lt;span class=&quot;s2&quot;&gt;&quot;settings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;s2&quot;&gt;&quot;address&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;8.8.4.4&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 53,
          &lt;span class=&quot;s2&quot;&gt;&quot;network&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;udp&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;timeout&quot;&lt;/span&gt;: 0,
          &lt;span class=&quot;s2&quot;&gt;&quot;followRedirect&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
    &lt;span class=&quot;s2&quot;&gt;&quot;outbounds&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;protocol&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;vmess&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;tag&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;proxy&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;settings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;s2&quot;&gt;&quot;vnext&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;s2&quot;&gt;&quot;address&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;ä½ çš„vpsåŸŸå&quot;&lt;/span&gt;,
              &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 443,
              &lt;span class=&quot;s2&quot;&gt;&quot;users&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                  &lt;span class=&quot;s2&quot;&gt;&quot;id&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;ä½ çš„uuid&quot;&lt;/span&gt;,
                  &lt;span class=&quot;s2&quot;&gt;&quot;alterId&quot;&lt;/span&gt;: 64,
                  &lt;span class=&quot;s2&quot;&gt;&quot;testsEnabled&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;VMessAEAD&quot;&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
              &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;streamSettings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;s2&quot;&gt;&quot;network&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;ws&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;security&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;tls&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;wsSettings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;s2&quot;&gt;&quot;path&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;ä½ çš„è·¯å¾„&quot;&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;tcpSettings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;s2&quot;&gt;&quot;allowInsecureCiphers&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  
  
  

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;4.æ–°å»ºlucièœå•é…ç½®v2rayï¼š&lt;/p&gt;

&lt;p&gt;(1).æ–°å»º/etc/config/advancedconfigï¼Œå†…å®¹ä¸ºï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;

config arguments

config rules
	option v2raymode &lt;span class=&quot;s1&quot;&gt;&apos;gfwlist&apos;&lt;/span&gt;


&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(2)æ–°å»º/usr/lib/lua/luci/controller/advancedconfig.luaï¼Œå†…å®¹ä¸ºï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;

&lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;/usr/lib/lua/luci/controller/advancedconfig.lua
module&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;luci.controller.advancedconfig&quot;&lt;/span&gt;, package.seeall&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;function &lt;/span&gt;index&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if &lt;/span&gt;not nixio.fs.access&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/etc/config/advancedconfig&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
                return
        &lt;/span&gt;end
        page &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; entry&lt;span class=&quot;o&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;admin&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;services&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;advancedconfig&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
		cbi&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;advancedconfig&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;,
		_&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;é«˜çº§è®¾ç½®&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, 70&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
	page.dependent &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true
	&lt;/span&gt;page.acl_depends &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;luci-app-firewall&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
end


&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(3).æ–°å»º/usr/lib/lua/luci/model/cbi/advancedconfig.luaï¼Œå†…å®¹ä¸ºï¼š&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;--/usr/lib/lua/luci/model/cbi/advancedconfig.lua&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;nixio.fs&quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;advancedconfig&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;translate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;é«˜çº§è®¾ç½®&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;translate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;å„ç±»æœåŠ¡å†…ç½®è„šæœ¬æ–‡æ¡£çš„ç›´æ¥ç¼–è¾‘ï¼Œè¦æ±‚å¿…é¡»æå‰å®‰è£…v2rayï¼Œchinadnsï¼Œdnsmasq-fullï¼Œå¦åˆ™åŠŸèƒ½ä¼šä¸æ­£å¸¸&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;section&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TypedSection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;arguments&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addremove&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;anonymous&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;


&lt;span class=&quot;c1&quot;&gt;--é…ç½®1å¼€å§‹&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nixio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;access&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/etc/dnsmasq.d/custom.conf&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tab&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;config1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;translate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ç¼–è¾‘gfwlistè‡ªå®šä¹‰è§£ææ–‡ä»¶&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;translate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;p&amp;gt;æœ¬é¡µæ˜¯ç¼–è¾‘/etc/dnsmasq.d/custom.confçš„å†…å®¹ï¼Œgfwlistä¸­çš„å›ºå®šç½‘ç«™å·²ç»æ·»åŠ ï¼Œæ­¤æ–‡ä»¶æ˜¯é¢å¤–çš„è‡ªå®šä¹‰è§£ææ–‡ä»¶ï¼Œç¤ºä¾‹ï¼š&amp;lt;p&amp;gt; 1.åœ¨gfwlistç™½åå•æ¨¡å¼ä¸‹ï¼Œå¦‚è¦æ·»åŠ xxx.comç½‘ç«™èµ°ä»£ç†ï¼Œåˆ™å¢åŠ ä¸¤è¡Œï¼š&amp;lt;p&amp;gt; server=/xxx.com/127.0.0.1#5353 &amp;lt;p&amp;gt; ipset=/xxx.com/gfwlist &amp;lt;p&amp;gt;ï¼ˆå…¶ä¸­5353æ˜¯chinadnsä¸Šæ¸¸æœåŠ¡å™¨çš„ç›‘å¬ç«¯å£ï¼‰ã€‚&amp;lt;p&amp;gt; 2.åœ¨gfwlistç™½åå•æ¨¡å¼ä¸‹ï¼Œå¦‚æœè¦æ·»åŠ 333.com ç›´è¿ä¸èµ°ä»£ç†ï¼Œåˆ™å¢åŠ ä¸€è¡Œï¼š&amp;lt;p&amp;gt; server=/333.com/114.114.114.114 &amp;lt;p&amp;gt;3.åœ¨ä»»ä½•ä¸€ç§æ¨¡å¼ä¸‹å¦‚éœ€é˜²æ­¢bbb.comçš„dnsæŸ¥è¯¢æ³„éœ²ï¼Œåˆ™å¢åŠ ä¸€è¡Œï¼š&amp;lt;p&amp;gt; server=/bbb.com/127.0.0.1#5353 &amp;lt;p&amp;gt;ï¼ˆå…¶ä¸­5353æ˜¯chinadnsä¸Šæ¸¸æœåŠ¡å™¨çš„ç›‘å¬ç«¯å£ï¼‰ã€‚&amp;lt;p&amp;gt; &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;view_cfg1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;taboption&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;config1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TextValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;editconf1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;translate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;æ¯è¡Œå¼€å¤´çš„ç¬¦å·ï¼ˆï¼ƒï¼‰è¢«è§†ä¸ºæ³¨é‡Šï¼›åˆ é™¤ï¼ˆ#ï¼‰å¯ç”¨æŒ‡å®šé€‰é¡¹ã€‚&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;view_cfg1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rmempty&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;view_cfg1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rows&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;30&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;view_cfg1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;cfgvalue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;section&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nixio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;readfile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/etc/dnsmasq.d/custom.conf&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;view_cfg1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;section&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;gsub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n?&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	      &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;old_value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nixio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;readfile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/etc/dnsmasq.d/custom.conf&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;~=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;old_value&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
		       &lt;span class=&quot;n&quot;&gt;nixio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;writefile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/etc/dnsmasq.d/custom.conf&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;n&quot;&gt;luci&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/etc/init.d/dnsmasq restart &amp;gt;/dev/null&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;--é…ç½®1ç»“æŸ&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;--é…ç½®2å¼€å§‹&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nixio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;access&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/etc/config/v2ray.json&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tab&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;config2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;translate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ç¼–è¾‘v2rayé…ç½®æ–‡ä»¶&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;translate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;p&amp;gt;æœ¬é¡µæ˜¯ç¼–è¾‘/etc/config/v2ray.jsonçš„å†…å®¹ã€‚&amp;lt;p&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;view_cfg2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;taboption&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;config2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TextValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;editconf2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;translate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;æ¯è¡Œå¼€å¤´çš„ç¬¦å·ï¼ˆï¼ƒï¼‰è¢«è§†ä¸ºæ³¨é‡Šï¼›åˆ é™¤ï¼ˆ#ï¼‰å¯ç”¨æŒ‡å®šé€‰é¡¹ã€‚&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;view_cfg2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rmempty&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;view_cfg2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rows&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;30&lt;/span&gt;


&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;view_cfg2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;cfgvalue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;section&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nixio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;readfile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/etc/config/v2ray.json&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;view_cfg2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;section&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;gsub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n?&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	      &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;old_value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nixio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;readfile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/etc/config/v2ray.json&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;~=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;old_value&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
		       &lt;span class=&quot;n&quot;&gt;nixio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;writefile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/etc/config/v2ray.json&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;n&quot;&gt;luci&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/etc/init.d/v2ray restart &amp;gt;/dev/null&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;--é…ç½®2ç»“æŸ&lt;/span&gt;


&lt;span class=&quot;n&quot;&gt;s2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;section&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TypedSection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;rules&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;s2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addremove&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;s2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;anonymous&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;s2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tab&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;config3&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;translate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;é€‰æ‹©v2rayçš„è¿è¡Œæ¨¡å¼&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;translate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;p&amp;gt;æœ¬æ¨¡å—æ˜¯é€‰æ‹©v2rayçš„è¿è¡Œæ¨¡å¼ï¼Œæ”¯æŒä¸‰ç§æ¨¡å¼ï¼šç™½åå•æ¨¡å¼ï¼Œå¢ƒå¤–å…¨å±€ä»£ç†æ¨¡å¼ï¼Œå¢™å†…ä¸Šç½‘æ¨¡å¼ã€‚&amp;lt;p&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;taboption&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;config3&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ListValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;v2raymode&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;translate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ä»£ç†æ¨¡å¼ï¼šç™½åå•æ¨¡å¼é€Ÿåº¦è¾ƒå¿«ï¼Œä½†æœªæ·»åŠ çš„è¢«å¢™ç½‘ç«™æ‰“ä¸å¼€ï¼Œå¢ƒå¤–å…¨å±€ä»£ç†æ¨¡å¼é€Ÿåº¦è¾ƒæ…¢ï¼Œä½†æ‰€æœ‰ç½‘ç«™éƒ½èƒ½æ‰“å¼€&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;gfwlist&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;translate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ç™½åå•æ¨¡å¼&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;outlands&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;translate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;å¢ƒå¤–å…¨å±€æ¨¡å¼&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ingfw&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;translate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;å¢™å†…ä¸Šç½‘æ¨¡å¼&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;gfwlist&quot;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;section&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;   
    &lt;span class=&quot;n&quot;&gt;ListValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;section&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;nixio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;writefile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/tmp/v2raymode.txt&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;~=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ingfw&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;luci&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/etc/init.d/v2ray restart &amp;gt;/dev/null&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;luci&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/etc/init.d/v2ray stop &amp;gt;/dev/null&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é‡å¤´æˆæ¥äº†~~~~&lt;/p&gt;

&lt;p&gt;5.åœ¨openwrtä¸Šä¿®æ”¹/etc/init.d/v2rayï¼Œï¼ˆæ³¨æ„è¦æå‰å®‰è£…å¥½ï¼šchinadns,v2ray,dnsmasq-full,coreutils-nohupï¼‰ï¼Œå†…å®¹ä¸ºï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;c&quot;&gt;#!/bin/sh /etc/rc.common&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# This is free software, licensed under the GNU General Public License v3.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# See /LICENSE for more information.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# To use this file, install chinadns,v2ray,dnsmasq-full,coreutils-nohup first&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;START&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;90

&lt;span class=&quot;nv&quot;&gt;USE_PROCD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1
&lt;span class=&quot;nv&quot;&gt;LimitNOFILE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1048576
&lt;span class=&quot;nv&quot;&gt;LimitNPROC&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;512

&lt;span class=&quot;nv&quot;&gt;DOMAIN&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;v2rayçš„vpsçš„ip&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;domestic_dns_1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;114.114.114.114&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;domestic_dns_2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;119.29.29.29&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;domestic_dns_3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;223.5.5.5&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;domestic_dns_4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;180.76.76.76&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;localip&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;127.0.0.1&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;chinadns_port_2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;5555&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;chinadns_port_3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;5656&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;chinadns_port_4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;5757&quot;&lt;/span&gt;

set_multi_domestic_dns&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;current_dns_list&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;uci get dhcp.@dnsmasq[0].server 2&amp;gt;/dev/null&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; x&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;domestic_dns_1&lt;/span&gt;:0:15&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; x&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;current_dns_list&lt;/span&gt;:0:15&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;setting domestic dns&quot;&lt;/span&gt; 
        uci &lt;span class=&quot;nt&quot;&gt;-q&lt;/span&gt; delete dhcp.@dnsmasq[0].server
        uci add_list dhcp.@dnsmasq[0].server&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;domestic_dns_1&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
        uci add_list dhcp.@dnsmasq[0].server&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;domestic_dns_2&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
        uci add_list dhcp.@dnsmasq[0].server&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;domestic_dns_3&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
        uci add_list dhcp.@dnsmasq[0].server&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;domestic_dns_4&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
        uci &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;dhcp.@dnsmasq[0].noresolv&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0
        uci &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;dhcp.@dnsmasq[0].nohosts&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0
        uci commit dhcp
        /etc/init.d/dnsmasq restart 1&amp;gt;/dev/null 2&amp;gt;&amp;amp;1
        &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;done&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

set_multi_foreign_dns&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;current_dns_list&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;uci get dhcp.@dnsmasq[0].server 2&amp;gt;/dev/null&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; x&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;localip&lt;/span&gt;:0:9&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; x&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;current_dns_list&lt;/span&gt;:0:9&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;setting foreign dns&quot;&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;chinadns_port&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;uci get chinadns.@chinadns[0].port 2&amp;gt;/dev/null&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;chinadns_listen_ipport&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;localip&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;#&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;chinadns_port&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
        uci &lt;span class=&quot;nt&quot;&gt;-q&lt;/span&gt; delete dhcp.@dnsmasq[0].server
        uci add_list dhcp.@dnsmasq[0].server&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;chinadns_listen_ipport&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
        uci add_list dhcp.@dnsmasq[0].server&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;localip&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;chinadns_port_2&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
        uci add_list dhcp.@dnsmasq[0].server&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;localip&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;chinadns_port_3&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
        uci add_list dhcp.@dnsmasq[0].server&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;localip&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;chinadns_port_4&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
        uci &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;dhcp.@dnsmasq[0].noresolv&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1
        uci &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;dhcp.@dnsmasq[0].nohosts&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1
        uci commit dhcp
        /etc/init.d/dnsmasq restart 1&amp;gt;/dev/null 2&amp;gt;&amp;amp;1
        &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;done&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

create_bypasslist&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;##########################################################################################################  &lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;bypasscount&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;ipset list bypasslist | &lt;span class=&quot;nb&quot;&gt;wc&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;    
      
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$bypasscount&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-le&lt;/span&gt; 1 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;#create ipset list&lt;/span&gt;
        ipset create bypasslist &lt;span class=&quot;nb&quot;&gt;hash&lt;/span&gt;:net family inet hashsize 1024 maxelem 65535
          
        &lt;span class=&quot;c&quot;&gt;#add private address&lt;/span&gt;
        ipset add bypasslist 0.0.0.0/8
        ipset add bypasslist 10.0.0.0/8
        ipset add bypasslist 127.0.0.0/8
        ipset add bypasslist 169.254.0.0/16
        ipset add bypasslist 172.16.0.0/12
        ipset add bypasslist 192.168.0.0/16
        ipset add bypasslist 224.0.0.0/4
        ipset add bypasslist 240.0.0.0/4
          
        &lt;span class=&quot;c&quot;&gt;#add china ip list from apnic&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;line &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /etc/chinadns_chnroute.txt&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;do
            &lt;/span&gt;ipset add bypasslist &lt;span class=&quot;nv&quot;&gt;$line&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;done
    fi&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;#by pass vps server ip&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;sleep &lt;/span&gt;1
    &lt;span class=&quot;c&quot;&gt;#SIP=` ping ${DOMAIN} -c 1 |awk &apos;NR==2 {print $4}&apos; |awk -F &apos;:&apos; &apos;{print $1}&apos;`&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;SIP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;dig +short &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DOMAIN&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; @&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;domestic_dns_1&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; x&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;SIP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; x &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        for &lt;/span&gt;eachip &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;SIP&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
            &lt;span class=&quot;c&quot;&gt;#echo &quot;${eachip}&quot;&lt;/span&gt;
            ipset add bypasslist &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;eachip&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;done
    fi&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;##########################################################################################################&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

create_gfwlist&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;##########################################################################################################&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;gfcount&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;ipset list gfwlist | &lt;span class=&quot;nb&quot;&gt;wc&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;    
      
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$gfcount&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-le&lt;/span&gt; 1 &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;ipset &lt;span class=&quot;nt&quot;&gt;-N&lt;/span&gt; gfwlist iphash
         
        &lt;span class=&quot;c&quot;&gt;#add telegram server&lt;/span&gt;
        ipset add gfwlist 93.119.240.0/24
        ipset add gfwlist 93.119.241.0/24
        ipset add gfwlist 93.119.242.0/24
        ipset add gfwlist 93.119.243.0/24
        ipset add gfwlist 93.119.244.0/24
        ipset add gfwlist 93.119.245.0/24
        ipset add gfwlist 93.119.246.0/24
        ipset add gfwlist 93.119.247.0/24
        ipset add gfwlist 93.119.248.0/24
        ipset add gfwlist 93.119.249.0/24
        ipset add gfwlist 93.119.250.0/24
        ipset add gfwlist 93.119.251.0/24
        ipset add gfwlist 93.119.252.0/24
        ipset add gfwlist 93.119.253.0/24
        ipset add gfwlist 93.119.254.0/24
        ipset add gfwlist 93.119.255.0/24
        ipset add gfwlist 149.154.172.0/22
        ipset add gfwlist 91.108.12.0/22
        ipset add gfwlist 149.154.160.0/20
        ipset add gfwlist 149.154.164.0/22
        ipset add gfwlist 91.108.4.0/22
        ipset add gfwlist 91.108.56.0/22
        ipset add gfwlist 91.108.8.0/22
        
    &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;########################################################################################################&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

enable_bypasslist_firewall_rules&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;########################################################################################################&lt;/span&gt;
    iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; PREROUTING &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--match-set&lt;/span&gt; bypasslist dst &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; REDIRECT &lt;span class=&quot;nt&quot;&gt;--to-port&lt;/span&gt; 1060 1&amp;gt;/dev/null 2&amp;gt;&amp;amp;1
    iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; OUTPUT &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--match-set&lt;/span&gt; bypasslist dst &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; REDIRECT &lt;span class=&quot;nt&quot;&gt;--to-port&lt;/span&gt; 1060 1&amp;gt;/dev/null 2&amp;gt;&amp;amp;1
    &lt;span class=&quot;c&quot;&gt;########################################################################################################&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

disable_bypasslist_firewall_rules&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;########################################################################################################&lt;/span&gt;
    iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-D&lt;/span&gt; PREROUTING &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--match-set&lt;/span&gt; bypasslist dst &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; REDIRECT &lt;span class=&quot;nt&quot;&gt;--to-port&lt;/span&gt; 1060 1&amp;gt;/dev/null 2&amp;gt;&amp;amp;1
    iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-D&lt;/span&gt; OUTPUT &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--match-set&lt;/span&gt; bypasslist dst &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; REDIRECT &lt;span class=&quot;nt&quot;&gt;--to-port&lt;/span&gt; 1060 1&amp;gt;/dev/null 2&amp;gt;&amp;amp;1
    &lt;span class=&quot;c&quot;&gt;########################################################################################################&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

enable_gfwlist_firewall_rules&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;########################################################################################################&lt;/span&gt;
    iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; PREROUTING &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--match-set&lt;/span&gt; gfwlist dst &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; REDIRECT &lt;span class=&quot;nt&quot;&gt;--to-port&lt;/span&gt; 1060 1&amp;gt;/dev/null 2&amp;gt;&amp;amp;1
    iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; OUTPUT &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--match-set&lt;/span&gt; gfwlist dst &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; REDIRECT &lt;span class=&quot;nt&quot;&gt;--to-port&lt;/span&gt; 1060 1&amp;gt;/dev/null 2&amp;gt;&amp;amp;1
    &lt;span class=&quot;c&quot;&gt;########################################################################################################&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

disable_gfwlist_firewall_rules&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;########################################################################################################&lt;/span&gt;
    iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-D&lt;/span&gt; PREROUTING &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--match-set&lt;/span&gt; gfwlist dst &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; REDIRECT &lt;span class=&quot;nt&quot;&gt;--to-port&lt;/span&gt; 1060 1&amp;gt;/dev/null 2&amp;gt;&amp;amp;1
    iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-D&lt;/span&gt; OUTPUT &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--match-set&lt;/span&gt; gfwlist dst &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; REDIRECT &lt;span class=&quot;nt&quot;&gt;--to-port&lt;/span&gt; 1060 1&amp;gt;/dev/null 2&amp;gt;&amp;amp;1
    &lt;span class=&quot;c&quot;&gt;########################################################################################################&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

disable_v2ray_rules&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;########################################################################################################&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;v2_mode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /tmp/v2raymode.txt 2&amp;gt;/dev/null&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
    disable_gfwlist_firewall_rules
    disable_bypasslist_firewall_rules
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ingfw&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;set_multi_domestic_dns
    &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;########################################################################################################&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

stop_service&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;stopping v2ray service&quot;&lt;/span&gt;
    disable_v2ray_rules
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

enable_v2ray_rules&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;########################################################################################################&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /tmp/v2raymode.txt 2&amp;gt;/dev/null&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; x&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; x &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;uci get advancedconfig.@rules[0].v2raymode 2&amp;gt;/dev/null&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;setting &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; mode&quot;&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /tmp/v2raymode.txt
    &lt;span class=&quot;k&quot;&gt;fi
    if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;outlands&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;create_bypasslist
        disable_gfwlist_firewall_rules
        enable_bypasslist_firewall_rules
        set_multi_foreign_dns
    &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2ray_mode&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;gfwlist&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
        &lt;/span&gt;create_gfwlist
        disable_bypasslist_firewall_rules
        enable_gfwlist_firewall_rules
        set_multi_foreign_dns
    &lt;span class=&quot;k&quot;&gt;else
        &lt;/span&gt;stop
    &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;########################################################################################################&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

start_service&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;starting v2ray service&quot;&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;mkdir&lt;/span&gt; /var/log/v2ray &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /dev/null 2&amp;gt;&amp;amp;1
    &lt;span class=&quot;nb&quot;&gt;ulimit&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; 99999
    procd_open_instance
    procd_set_param respawn
&lt;span class=&quot;c&quot;&gt;#    procd_set_param command /usr/bin/v2ray -config /etc/config/v2ray.json&lt;/span&gt;
    procd_set_param &lt;span class=&quot;nb&quot;&gt;command&lt;/span&gt; /usr/bin/v2rayx64/v2ray &lt;span class=&quot;nt&quot;&gt;-config&lt;/span&gt; /etc/config/v2ray.json
    procd_set_param file /etc/config/v2ray.json
    procd_set_param stdout 1
    procd_set_param stderr 1
    procd_set_param pidfile /var/run/v2ray.pid
    enable_v2ray_rules
    procd_close_instance
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

service_triggers&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
	procd_add_reload_trigger &lt;span class=&quot;s2&quot;&gt;&quot;advancedconfig&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;


&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¸¤ç§æ¨¡å¼éƒ½å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªv2rayçš„openwrtå®¢æˆ·ç«¯é…ç½®ï¼Œå…¶ä¸­å¢ƒå¤–å…¨å±€æ¨¡å¼çš„é˜²ç«å¢™é…ç½®éå¸¸ç®€æ´ï¼Œçœ‹èµ·æ¥å¾ˆèˆ’æœã€‚ã€‚ã€‚&lt;/p&gt;

&lt;p&gt;6.æœ€åè®¾ç½®ä¸€ä¸ªå¤šè¿›ç¨‹çš„chinadnså¯åŠ¨è„šæœ¬ï¼Œstart_multi_chinadns.shï¼Œå†…å®¹ä¸ºï¼š&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;c&quot;&gt;#!/bin/sh&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# To use this file, install chinadns,v2ray,dnsmasq-full,coreutils-nohup first&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;domestic_dns_1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;114.114.114.114&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;domestic_dns_2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;119.29.29.29&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;domestic_dns_3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;223.5.5.5&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;domestic_dns_4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;180.76.76.76&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;localip&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;127.0.0.1&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;chinadns_port_2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;5555&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;chinadns_port_3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;5656&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;chinadns_port_4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;5757&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;v2_dns_port_2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;5355&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;v2_dns_port_3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;5356&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;v2_dns_port_4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;5357&quot;&lt;/span&gt;
killall chinadns
/etc/init.d/chinadns restart
&lt;span class=&quot;nb&quot;&gt;sleep &lt;/span&gt;1
&lt;span class=&quot;nb&quot;&gt;nohup&lt;/span&gt; /usr/bin/chinadns &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-b&lt;/span&gt; 0.0.0.0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;chinadns_port_2&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;domestic_dns_2&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;,&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;localip&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;:&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2_dns_port_2&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; /etc/chinadns_chnroute.txt 1&amp;gt;/dev/null 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;span class=&quot;nb&quot;&gt;sleep &lt;/span&gt;1
&lt;span class=&quot;nb&quot;&gt;nohup&lt;/span&gt; /usr/bin/chinadns &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-b&lt;/span&gt; 0.0.0.0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;chinadns_port_3&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;domestic_dns_3&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;,&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;localip&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;:&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2_dns_port_3&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; /etc/chinadns_chnroute.txt 1&amp;gt;/dev/null 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;span class=&quot;nb&quot;&gt;sleep &lt;/span&gt;1
&lt;span class=&quot;nb&quot;&gt;nohup&lt;/span&gt; /usr/bin/chinadns &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-b&lt;/span&gt; 0.0.0.0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;chinadns_port_4&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;domestic_dns_4&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;,&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;localip&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;:&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v2_dns_port_4&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; /etc/chinadns_chnroute.txt 1&amp;gt;/dev/null 2&amp;gt;&amp;amp;1 &amp;amp;


&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;è®¾ç½®åœ¨rc.localä¸­ä½œä¸ºå¯åŠ¨é¡¹ï¼Œå³å¯åœ¨openwrtå¯åŠ¨çš„æ—¶å€™å¸¦èµ·4ä¸ªè¿›ç¨‹çš„chinadnsã€‚&lt;/p&gt;

&lt;p&gt;é™„ï¼šluciçš„æ•ˆæœå›¾å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://jibenfa.github.io/uploads/2020/03/screencapture-2020-03-29-20_27_10.png&quot; width=&quot;900&quot; height=&quot;1100&quot; alt=&quot;AltText&quot; /&gt;&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>å®šåˆ¶esxi6.7é•œåƒæ–‡ä»¶</title>
   <link href="https://jibenfa.github.io/%E8%99%9A%E6%8B%9F%E5%8C%96/2020/01/20/e5ae9ae588b6esxi6.7e9959ce5838fe69687e4bbb6/"/>
   <updated>2020-01-20T08:25:57+00:00</updated>
   <id>https://jibenfa.github.io/%E8%99%9A%E6%8B%9F%E5%8C%96/2020/01/20/e5ae9ae588b6esxi6.7e9959ce5838fe69687e4bbb6</id>
   <content type="html">&lt;p&gt;æœ€è¿‘å‡çº§äº†æœåŠ¡å™¨ï¼Œä½¿ç”¨äº†x550ä¸‡å…†ç½‘å¡ï¼Œäºæ˜¯æƒ³åœ¨esxi6.7ä¸­é›†æˆæœ€æ–°çš„1.8.7çš„ç½‘å¡é©±åŠ¨ï¼ŒæŠ˜è…¾äº†3ä¸ªå°æ—¶ï¼Œç»ˆäºæå®šï¼š&lt;/p&gt;

&lt;p&gt;1.ä¸‹è½½å¹¶å®‰è£…VMware-PowerCLI-6.5.0å’ŒESXi-Customizer-PSå°è£…å·¥å…·&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;

VMware-PowerCLI-6.5.0-4624819

ESXi-Customizer-PS-v2.6.0.ps1ï¼ˆç»¿è‰²ç‰ˆï¼‰


&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2.ä¸‹è½½ESXI6.7 offline bundle&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;

ESXi670-201912001.zip æ”¾åˆ°å’ŒESXi-CustomizeråŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹


&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3.å‡çº§powershellè‡³3.0ç‰ˆæœ¬ä»¥ä¸Šï¼ˆwin10è‡ªå¸¦çš„æ˜¯5.1ï¼Œæ— éœ€å‡çº§ï¼‰&lt;/p&gt;

&lt;p&gt;4.ä¸‹è½½ç½‘å¡é©±åŠ¨&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;

VMware ESXi 6.7 ixgben 1.8.7 NIC Driver &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;Intel Ethernet Controllers 82599, x520, x540, x550, x552 and x553 family

https://my.vmware.com/web/vmware/details?productId&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;742&amp;amp;downloadGroup&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;ESXI67U3B#drivers_tools


&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;è§£å‹é©±åŠ¨åˆ°D:\vmware67u3b\vib\&lt;/p&gt;

&lt;p&gt;5.ç”¨ç®¡ç†å‘˜æƒé™æ‰“å¼€powershellï¼Œåˆ‡æ¢è‡³ESXi-Customizeræ‰€åœ¨æ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;

1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;.Powershellä¸­é»˜è®¤ç¦æ­¢æ‰§è¡Œè„šæœ¬ï¼Œæ‰€ä»¥å…ˆä¿®æ”¹ç­–ç•¥å…è®¸æ‰§è¡Œ

Set-ExecutionPolicy Unrestricted

2&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;.ç¦æ­¢ç­¾åæ ¡éªŒéœ€ä¿®æ”¹2ä¸ªå‚æ•°&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ç¯å¢ƒå‚æ•°ä¸­nosignaturecheckæ”¹æˆtrueï¼Œå¦å¤–æ‰“åŒ…å‘½ä»¤åå¢åŠ -nsc&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$DeployNoSignatureCheck&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$true&lt;/span&gt;

 .&lt;span class=&quot;se&quot;&gt;\E&lt;/span&gt;SXi-Customizer-PS-v2.6.0.ps1 &lt;span class=&quot;nt&quot;&gt;-izip&lt;/span&gt; .&lt;span class=&quot;se&quot;&gt;\E&lt;/span&gt;SXi670-201912001.zip &lt;span class=&quot;nt&quot;&gt;-pkgDir&lt;/span&gt; D:&lt;span class=&quot;se&quot;&gt;\v&lt;/span&gt;mware67u3b&lt;span class=&quot;se&quot;&gt;\v&lt;/span&gt;ib&lt;span class=&quot;se&quot;&gt;\ &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-nsc&lt;/span&gt;
 

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœå‡ºç°äº†all done,å°±è¡¨ç¤ºæˆåŠŸäº†ï¼Œå¯ä»¥åœ¨ä¸Šè¿°æ–‡ä»¶å¤¹ä¸‹æ‰¾åˆ°ESXi-6.7.0-20191204001-standard-customized.iso&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>perlä½¿ç”¨mimeå‘é€å¸¦é™„ä»¶çš„é‚®ä»¶</title>
   <link href="https://jibenfa.github.io/%E7%BC%96%E7%A8%8B/2019/08/24/perle4bdbfe794a8mimee58f91e98081e5b8a6e99984e4bbb6e79a84e982aee4bbb6/"/>
   <updated>2019-08-24T11:38:57+00:00</updated>
   <id>https://jibenfa.github.io/%E7%BC%96%E7%A8%8B/2019/08/24/perle4bdbfe794a8mimee58f91e98081e5b8a6e99984e4bbb6e79a84e982aee4bbb6</id>
   <content type="html">&lt;p&gt;å¥½ä¹…ä¸ç”¨perlè„šæœ¬å†™ä¸œè¥¿äº†ï¼Œä»Šå¤©çªå‘å¥‡æƒ³ï¼Œéœ€è¦è‡ªåŠ¨å‘é€å¸¦é™„ä»¶çš„é‚®ä»¶ï¼Œç½‘ä¸Šæ‰¾äº†å¾ˆå¤šèµ„æ–™ï¼Œä¿®æ”¹äº†ä¸€ä¸‹ï¼Œå°±æ˜¯è¿™æ ·äº†ï¼Œå…ˆç”¨ppmå®‰è£…MIME::Liteå’ŒAuthen::SASLåŒ…&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;c&quot;&gt;#!/usr/bin/perl -w&lt;/span&gt;
use strict&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
use warnings&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
use MIME::Lite&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
use MIME::Base64&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
use Authen::SASL&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
 
  my &lt;span class=&quot;nv&quot;&gt;$from&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;å‘ä»¶äººé‚®ç®±&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  my &lt;span class=&quot;nv&quot;&gt;$passwd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;å‘ä»¶äººé‚®ç®±å¯†ç &apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  my &lt;span class=&quot;nv&quot;&gt;$to&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;æ”¶ä»¶äººé‚®ç®±&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  my &lt;span class=&quot;nv&quot;&gt;$subject&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;æ ‡é¢˜&quot;&lt;/span&gt;
  my &lt;span class=&quot;nv&quot;&gt;$content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;æ­£æ–‡å†…å®¹&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  my &lt;span class=&quot;nv&quot;&gt;$fileone&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;z:\\123.png&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  my &lt;span class=&quot;nv&quot;&gt;$filetwo&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;z:\\456.png&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  my &lt;span class=&quot;nv&quot;&gt;$msg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; MIME::Lite-&amp;gt;new&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
      From     &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;  &lt;span class=&quot;nv&quot;&gt;$from&lt;/span&gt;,
      To       &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;  &lt;span class=&quot;nv&quot;&gt;$to&lt;/span&gt;,
      Subject  &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;  &lt;span class=&quot;nv&quot;&gt;$subject&lt;/span&gt;,
      Type     &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;  &lt;span class=&quot;s1&quot;&gt;&apos;TEXT&apos;&lt;/span&gt;,
      Data     &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;  &lt;span class=&quot;nv&quot;&gt;$content&lt;/span&gt;,
  &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;$msg&lt;/span&gt;-&amp;gt;attach &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
   Type        &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;AUTO&apos;&lt;/span&gt;,
   Path        &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$fileone&lt;/span&gt;,
   Filename    &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;1111.png&quot;&lt;/span&gt;,
   Disposition &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;attachment&apos;&lt;/span&gt;
   &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; or die &lt;span class=&quot;s2&quot;&gt;&quot;Error adding &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$fileone&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$!&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
   &lt;span class=&quot;nv&quot;&gt;$msg&lt;/span&gt;-&amp;gt;attach &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
   Type        &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;AUTO&apos;&lt;/span&gt;,
   Path        &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$filetwo&lt;/span&gt;,
   Filename    &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;2222.png&quot;&lt;/span&gt;,
   Disposition &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;attachment&apos;&lt;/span&gt;
   &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; or die &lt;span class=&quot;s2&quot;&gt;&quot;Error adding &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$filetwo&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$!&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  
  
  MIME::Lite-&amp;gt;send&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;smtp&apos;&lt;/span&gt;,&lt;span class=&quot;s1&quot;&gt;&apos;smtpé‚®ç®±æœåŠ¡å™¨&apos;&lt;/span&gt;,
      Debug   &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;0&apos;&lt;/span&gt;,
      &lt;span class=&quot;nv&quot;&gt;AuthUser&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$from&lt;/span&gt;,
      &lt;span class=&quot;nv&quot;&gt;AuthPass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$passwd&lt;/span&gt;,
  &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;$msg&lt;/span&gt;-&amp;gt;send&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
</content>
 </entry>
 
 <entry>
   <title>v2ray+LetsEncrypt+cdnéƒ¨ç½²</title>
   <link href="https://jibenfa.github.io/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/2019/06/14/v2ray2bLetsEncrypt2bcdne983a8e7bdb2/"/>
   <updated>2019-06-14T14:46:57+00:00</updated>
   <id>https://jibenfa.github.io/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/2019/06/14/v2ray2bLetsEncrypt2bcdne983a8e7bdb2</id>
   <content type="html">&lt;p&gt;ä¸ºäº†æ‹¯æ•‘è¢«å¢™çš„ipï¼Œå‚è€ƒäº†ä¸€äº›èµ„æ–™ï¼Œæœ€ç»ˆå®ç°äº†v2ray+LetsEncrypt+cdnéƒ¨ç½²ã€‚
é¦–å…ˆæ˜¯ç”³è¯·ä¸€ä¸ªåŸŸåï¼Œexample.com&lt;/p&gt;

&lt;p&gt;ä¸€ã€vpséƒ¨ç½²Nginxå’ŒLetsEncrypt&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
apt update
apt &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;nginx &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt;
apt-get update
apt-get &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;software-properties-common
add-apt-repository universe
add-apt-repository ppaï¼šcertbot/certbot
apt-get update
apt-get &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;certbot python-certbot-nginx 

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è‡ªåŠ¨å®‰è£…Nginxè¯ä¹¦ï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
certbot &lt;span class=&quot;nt&quot;&gt;--nginx&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç„¶åcrontab -eå¢åŠ è®¡åˆ’ä»»åŠ¡ï¼Œè‡ªåŠ¨æ›´æ–°httpsè¯ä¹¦&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
certbot renew &lt;span class=&quot;nt&quot;&gt;--dry-run&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;äºŒã€vpsé…ç½®Nginxå’Œå®‰è£…é…ç½®v2ray&lt;/p&gt;

&lt;p&gt;è®¾ç½®/etc/nginx/sites-enabled/defaultä¸ºï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
server &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

        &lt;span class=&quot;c&quot;&gt;#index index.html index.htm index.nginx-debian.html;&lt;/span&gt;
        server_name example.com&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# managed by Certbot&lt;/span&gt;


        location /test
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
           proxy_redirect off&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
           proxy_pass http://127.0.0.1:23456&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
           proxy_http_version 1.1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
           proxy_set_header Upgrade &lt;span class=&quot;nv&quot;&gt;$http_upgrade&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
           proxy_set_header Connection &lt;span class=&quot;s2&quot;&gt;&quot;upgrade&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
           proxy_set_header Host &lt;span class=&quot;nv&quot;&gt;$http_host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;



    listen &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;::]:443 ssl &lt;span class=&quot;nv&quot;&gt;ipv6only&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;on&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# managed by Certbot&lt;/span&gt;
    listen 443 ssl&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# managed by Certbot&lt;/span&gt;
    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# managed by Certbot&lt;/span&gt;
    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# managed by Certbot&lt;/span&gt;
    include /etc/letsencrypt/options-ssl-nginx.conf&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# managed by Certbot&lt;/span&gt;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# managed by Certbot&lt;/span&gt;
    ssl on&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æå®Œä»¥åï¼Œæ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
service nginx restart

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å®‰è£…v2rayå°±ä¸è¯´äº†ï¼ŒæœåŠ¡ç«¯é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;s2&quot;&gt;&quot;inbounds&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 123456,
      &lt;span class=&quot;s2&quot;&gt;&quot;listen&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;127.0.0.1&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;protocol&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;vmess&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;settings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;clients&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;s2&quot;&gt;&quot;id&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;ä½ çš„id&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;alterId&quot;&lt;/span&gt;: 64
          &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;streamSettings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;network&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;ws&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;wsSettings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;path&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;/test&quot;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;outbounds&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;protocol&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;freedom&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;settings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æå®Œä»¥åï¼Œæ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
service v2ray restart

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¸‰ã€åœ¨cloudflareä¸Šé…ç½®cdn
ä¸æäº†ï¼Œè¯´å¤šæ³ªï¼Œä¸»è¦æ˜¯:&lt;/p&gt;

&lt;p&gt;1)åœ¨dnsé‡Œé¢ï¼Œå°†è§£æåŸŸåexample.comæŒ‡å‘è¢«å¢™ip&lt;/p&gt;

&lt;p&gt;2)å°†ns serverè®¾ç½®ä¸ºcloudflareçš„ns&lt;/p&gt;

&lt;p&gt;3ï¼‰åœ¨cryptoèœå•é‡Œé¢è®²sslè®¾ç½®ä¸ºfullï¼Œå°†â€œAlways Use HTTPSâ€è®¾ç½®ä¸ºONï¼ï¼ï¼&lt;/p&gt;

&lt;p&gt;å››ã€å®¢æˆ·ç«¯é…ç½®v2ray&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;#è¿™ä¸ªé…ç½®é¡¹æ˜¯ç»“åˆchinadnsä½¿ç”¨çš„&lt;/span&gt;
  &lt;span class=&quot;s2&quot;&gt;&quot;inbound&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;protocol&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;dokodemo-door&quot;&lt;/span&gt;,
    &lt;span class=&quot;s2&quot;&gt;&quot;listen&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;0.0.0.0&quot;&lt;/span&gt;,
    &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 5353,
    &lt;span class=&quot;s2&quot;&gt;&quot;settings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;address&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;8.8.8.8&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 53,
      &lt;span class=&quot;s2&quot;&gt;&quot;network&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;udp&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;timeout&quot;&lt;/span&gt;: 0,
      &lt;span class=&quot;s2&quot;&gt;&quot;followRedirect&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;inboundDetour&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
       &lt;span class=&quot;s2&quot;&gt;&quot;domainOverride&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;http&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;tls&quot;&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;protocol&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;dokodemo-door&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 1080,
      &lt;span class=&quot;s2&quot;&gt;&quot;listen&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;0.0.0.0&quot;&lt;/span&gt;,
      
      &lt;span class=&quot;s2&quot;&gt;&quot;settings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;network&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;tcp&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;timeout&quot;&lt;/span&gt;: 30,
        &lt;span class=&quot;s2&quot;&gt;&quot;followRedirect&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;outbounds&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;protocol&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;vmess&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;tag&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;proxy&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;settings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;vnext&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;s2&quot;&gt;&quot;address&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;ä½ çš„ç½‘å€&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 443,
            &lt;span class=&quot;s2&quot;&gt;&quot;users&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
              &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;s2&quot;&gt;&quot;id&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;ä½ çš„key&quot;&lt;/span&gt;,
                &lt;span class=&quot;s2&quot;&gt;&quot;alterId&quot;&lt;/span&gt;: 64
              &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;streamSettings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;network&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;ws&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;security&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;tls&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;wsSettings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;s2&quot;&gt;&quot;path&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;/test&quot;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;outboundDetour&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;protocol&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;freedom&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;settings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;tag&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;direct&quot;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
  
  &lt;span class=&quot;s2&quot;&gt;&quot;routing&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;strategy&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;rules&quot;&lt;/span&gt;,
    &lt;span class=&quot;s2&quot;&gt;&quot;settings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;domainStrategy&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;IPIfNonMatch&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;rules&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
           &lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;field&quot;&lt;/span&gt;,
           &lt;span class=&quot;s2&quot;&gt;&quot;ip&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
             &lt;span class=&quot;s2&quot;&gt;&quot;8.8.8.8/32&quot;&lt;/span&gt;,
             &lt;span class=&quot;s2&quot;&gt;&quot;8.8.4.4/32&quot;&lt;/span&gt;,
             &lt;span class=&quot;s2&quot;&gt;&quot;91.108.56.0/22&quot;&lt;/span&gt;,
             &lt;span class=&quot;s2&quot;&gt;&quot;91.108.4.0/22&quot;&lt;/span&gt;,
             &lt;span class=&quot;s2&quot;&gt;&quot;109.239.140.0/24&quot;&lt;/span&gt;,
             &lt;span class=&quot;s2&quot;&gt;&quot;149.154.164.0/22&quot;&lt;/span&gt;,
             &lt;span class=&quot;s2&quot;&gt;&quot;91.108.56.0/23&quot;&lt;/span&gt;,
             &lt;span class=&quot;s2&quot;&gt;&quot;67.198.55.0/24&quot;&lt;/span&gt;,
             &lt;span class=&quot;s2&quot;&gt;&quot;149.154.168.0/22&quot;&lt;/span&gt;,
             &lt;span class=&quot;s2&quot;&gt;&quot;149.154.172.0/22&quot;&lt;/span&gt;
           &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
           &lt;span class=&quot;s2&quot;&gt;&quot;outboundTag&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;proxy&quot;&lt;/span&gt;
         &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
         &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;field&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;domain&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
            &lt;span class=&quot;s2&quot;&gt;&quot;googleapis.cn&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;google.cn&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;googleapis&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;google&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;domain:facebook.com&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;domain:github.com&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;domain:githubusercontent.com&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;youtube&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;twitter&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;instagram&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;gmail&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;v2ray.com&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;github.io&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;domain:twimg.com&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;domain:t.co&quot;&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;outboundTag&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;proxy&quot;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
           &lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;field&quot;&lt;/span&gt;,           
           &lt;span class=&quot;s2&quot;&gt;&quot;domain&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
                &lt;span class=&quot;s2&quot;&gt;&quot;ext:h2y.dat:gfw&quot;&lt;/span&gt;   &lt;span class=&quot;c&quot;&gt;#è¿™ä¸ªæ–‡ä»¶å¯ä»¥ä»https://github.com/ToutyRater/V2Ray-SiteDAT/tree/master/geofilesä¸‹è½½&lt;/span&gt;
           &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
           &lt;span class=&quot;s2&quot;&gt;&quot;outboundTag&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;proxy&quot;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;field&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;domain&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
            &lt;span class=&quot;s2&quot;&gt;&quot;geosite:cn&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;domain:ä½ çš„ç½‘å€&quot;&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;outboundTag&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;direct&quot;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;field&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;ip&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
            &lt;span class=&quot;s2&quot;&gt;&quot;0.0.0.0/8&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;10.0.0.0/8&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;100.64.0.0/10&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;127.0.0.0/8&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;169.254.0.0/16&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;172.16.0.0/12&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;192.0.0.0/24&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;192.0.2.0/24&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;192.168.0.0/16&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;198.18.0.0/15&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;198.51.100.0/24&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;203.0.113.0/24&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;::1/128&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;fc00::/7&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;fe80::/10&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;geoip:cn&quot;&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;outboundTag&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;direct&quot;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
   &lt;span class=&quot;s2&quot;&gt;&quot;transport&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;tcpSettings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;connectionReuse&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;äº”ã€openwrtä¸Šé…ç½®é˜²ç«å¢™&lt;/p&gt;

&lt;p&gt;å‚è€ƒä¸Šä¸€ç¯‡æ–‡ç« 
&lt;a href=&quot;https://jibenfa.github.io/openwrt/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/2019/06/09/v2raye59ca8openwrte4b88be79a84e5ae89e8a385e983a8e7bdb2/&quot;&gt;é…ç½®&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å‚è€ƒèµ„æ–™ï¼š&lt;/p&gt;

&lt;p&gt;1).https://certbot.eff.org/lets-encrypt/ubuntubionic-nginx&lt;/p&gt;

&lt;p&gt;2).https://zorz.cc/post/v2ray-cdn.html&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>v2rayåœ¨openwrtä¸‹çš„å®‰è£…éƒ¨ç½²</title>
   <link href="https://jibenfa.github.io/openwrt/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/2019/06/09/v2raye59ca8openwrte4b88be79a84e5ae89e8a385e983a8e7bdb2/"/>
   <updated>2019-06-09T09:44:57+00:00</updated>
   <id>https://jibenfa.github.io/openwrt/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/2019/06/09/v2raye59ca8openwrte4b88be79a84e5ae89e8a385e983a8e7bdb2</id>
   <content type="html">&lt;p&gt;ä»æœ¬æœˆå¼€å§‹ï¼Œssæ‰¶å¢™çš„æœåŠ¡å™¨å…¨ç­ï¼Œæœ€å¤¸å¼ çš„æ˜¯æ–°å»ºä¸€ä¸ªç­ä¸€ä¸ªï¼Œæ´»ä¸è¿‡2å°æ—¶ã€‚ä¸å¾—ä¸å¯»æ‰¾æ–°çš„è§£å†³æ–¹æ¡ˆï¼Œç»ˆäºï¼ŒèŠ±äº†å‡ å¤©æ—¶é—´æå®šäº†ã€‚é‚£å°±æ˜¯è¿ç§»åˆ°v2rayã€‚&lt;/p&gt;

&lt;p&gt;ä¸€ã€æ€§èƒ½&lt;/p&gt;

&lt;p&gt;v2rayæ¯”sså¼ºå¤§å¾ˆå¤šï¼Œä½†æ˜¯å¯¹è·¯ç”±çš„æ€§èƒ½è¦æ±‚é«˜å¾ˆå¤šï¼Œç»è¿‡æµ‹è¯•ï¼Œå‘ç°å¦‚æœè¦å®Œæ•´å®‰è£…v2ray-coreï¼Œè·¯ç”±æœ¬èº«è‡³å°‘éœ€è¦256M ROMï¼Œ32M RAMï¼Œè¿™æ ·çš„è¯ï¼Œå¸‚é¢å¤§å¤šæ•°è·‘å¾—åŠ¨ssè·¯ç”±éƒ½è¢«æ·˜æ±°äº†ï¼Œç›®å‰mipsè·¯ç”±ï¼Œæˆ‘åªåœ¨MT7621ATä¸Šæµ‹è¯•æˆåŠŸï¼Œä½¿ç”¨çš„æ˜¯è”æƒ³newifi3 d2ï¼Œä½†æ˜¯æƒ³è·‘æ»¡å¸¦å®½è¿˜æ˜¯å»ºè®®ä½¿ç”¨x86è½¯è·¯ç”±ï¼Œ100M vmessè·‘æ»¡çš„è¯ï¼Œi3 4ä»£å¤§çº¦å ç”¨13~24%ã€‚&lt;/p&gt;

&lt;p&gt;äºŒã€å®‰è£…&lt;/p&gt;

&lt;p&gt;1.æœåŠ¡å™¨ç«¯&lt;/p&gt;

&lt;p&gt;1).é¦–å…ˆæ˜¯æ‰¾ä¸€å°å¢™å¤–çš„vpsï¼Œlinuxå°±è¡Œï¼Œæ¨èdebianå’Œubuntuï¼Œæ ¹æ®v2rayå®˜æ–¹æ–‡æ¡£ï¼Œå‘½ä»¤è¡Œæ‰§è¡Œï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
bash &amp;lt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-L&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; https://install.direct/go.sh&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2).é…ç½®æœåŠ¡å™¨ç«¯é…ç½®æ–‡ä»¶/etc/v2ray/config.json (v2rayå®‰è£…å®Œæˆåæ­¤æ–‡ä»¶å°±å·²ç»å­˜åœ¨äº†ï¼Œä¿ç•™idï¼Œç¼–è¾‘å…¶ä»–éƒ¨åˆ†)ï¼š&lt;/p&gt;

&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;c&quot;&gt;&quot;inbound&quot;: {&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;&quot;port&quot;: 11111,&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;&quot;protocol&quot;: &quot;vmess&quot;,&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;&quot;settings&quot;: {&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;clients&quot;: [&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;c&quot;&gt;&quot;id&quot;: &quot;ä½ çš„ID&quot;,&lt;/span&gt;
          &lt;span class=&quot;c&quot;&gt;&quot;level&quot;: 1,&lt;/span&gt;
          &lt;span class=&quot;c&quot;&gt;&quot;alterId&quot;: 64&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;detour&quot;:{&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;to&quot;:&quot;dynamicPort&quot;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;&quot;streamSettings&quot;:{&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;network&quot;:&quot;kcp&quot;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;&quot;inboundDetour&quot;:[&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;protocol&quot;: &quot;vmess&quot;,&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;port&quot;: &quot;10000-50000&quot;,&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;tag&quot;: &quot;dynamicPort&quot;,&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;settings&quot;: {&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;default&quot;: {&lt;/span&gt;
          &lt;span class=&quot;c&quot;&gt;&quot;level&quot;: 1,&lt;/span&gt;
          &lt;span class=&quot;c&quot;&gt;&quot;alterId&quot;: 64&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;allocate&quot;: {&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;strategy&quot;: &quot;random&quot;,&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;concurrency&quot;: 4,&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;refresh&quot;: 300&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;streamSettings&quot;: {&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&quot;network&quot;: &quot;kcp&quot;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;&quot;outbound&quot;: {&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;&quot;protocol&quot;: &quot;freedom&quot;,&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;&quot;settings&quot;: {}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;&quot;outboundDetour&quot;: [&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;protocol&quot;: &quot;blackhole&quot;,&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;settings&quot;: {},&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;tag&quot;: &quot;blocked&quot;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
 &lt;span class=&quot;c&quot;&gt;&quot;transport&quot;:{&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&quot;kcpSettings&quot;:{&lt;/span&gt;
         &lt;span class=&quot;c&quot;&gt;&quot;mtu&quot;:1350,&lt;/span&gt;
         &lt;span class=&quot;c&quot;&gt;&quot;tti&quot;:50,&lt;/span&gt;
         &lt;span class=&quot;c&quot;&gt;&quot;uplinkCapacity&quot;:100,&lt;/span&gt;
         &lt;span class=&quot;c&quot;&gt;&quot;downlinkCapacity&quot;:200,&lt;/span&gt;
         &lt;span class=&quot;c&quot;&gt;&quot;congestion&quot;:true,&lt;/span&gt;
         &lt;span class=&quot;c&quot;&gt;&quot;readBufferSize&quot;:2,&lt;/span&gt;
         &lt;span class=&quot;c&quot;&gt;&quot;writeBufferSize&quot;:2,&lt;/span&gt;
         &lt;span class=&quot;c&quot;&gt;&quot;header&quot;:{&lt;/span&gt;
            &lt;span class=&quot;c&quot;&gt;&quot;type&quot;:&quot;wechat-video&quot;&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3).è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
service v2ray restart

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;psæŸ¥çœ‹è¿›ç¨‹å¦‚æœå‡ºç°&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
/usr/bin/v2ray &lt;span class=&quot;nt&quot;&gt;-config&lt;/span&gt; /etc/v2ray/config.json

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;å³æˆåŠŸäº†ã€‚&lt;/p&gt;

&lt;p&gt;2.æœ¬åœ°è·¯ç”±å®‰è£…&lt;/p&gt;

&lt;p&gt;1).æ ¡å‡†æ—¶é—´&lt;/p&gt;

&lt;p&gt;ç”±äºv2ray dynamic portå¯¹æ—¶é—´è¦æ±‚å¾ˆé«˜ï¼Œæ‰€ä»¥ï¼Œé¦–å…ˆæ˜¯æ ¡å‡†æ—¶é—´ï¼Œå¯ä»¥åœ¨å¯åŠ¨é¡¹é‡Œé¢æ·»åŠ &lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;nb&quot;&gt;sleep &lt;/span&gt;10
ntpd &lt;span class=&quot;nt&quot;&gt;-q&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; 1.openwrt.pool.ntp.org
ntpd &lt;span class=&quot;nt&quot;&gt;-q&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt;  ntp1.aliyun.com

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è®¡åˆ’ä»»åŠ¡é‡Œé¢æ·»åŠ &lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
10 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; ntpd &lt;span class=&quot;nt&quot;&gt;-q&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; 1.openwrt.pool.ntp.org
10 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; ntpd &lt;span class=&quot;nt&quot;&gt;-q&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt;  ntp1.aliyun.com

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2).å®‰è£…v2ray-core, kuoruan å¤§ç¥çš„githubä»“åº“é‡Œé¢æœ‰releaseçš„ç‰ˆæœ¬ï¼Œå¯ä»¥ç›´æ¥å»ä¸‹è½½åˆé€‚çš„æ¶æ„ï¼Œæˆ‘è¿™é‡Œä¸‹è½½çš„æ˜¯ï¼š&lt;/p&gt;

&lt;p&gt;https://github.com/kuoruan/openwrt-v2ray/releases/download/v4.19.1-2/v2ray-core_4.19.1-2_x86_64.ipk&lt;/p&gt;

&lt;p&gt;å°è¯•è‡ªå·±ç¼–è¯‘äº†ä¸€ä¸‹ï¼ŒæŠ¥é”™äº†æ²¡æœ‰æˆåŠŸï¼Œå°±ç”¨äº†ç°æˆçš„ã€‚&lt;/p&gt;

&lt;p&gt;ps:å…¶å®x86çš„openwrtè£…v2ray linux x64åŸç‰ˆçš„ä¹Ÿè¡Œï¼Œç›´æ¥è§£å‹æ‹·è´åˆ°openwrtæŸä¸ªç›®å½•ä¸‹chmodå°±è¡Œäº†ï¼Œè¿™2ä¸ªç‰ˆæœ¬éƒ½è¦æ±‚è£…ca-certificatesã€‚&lt;/p&gt;

&lt;p&gt;opkgç›´æ¥å®‰è£…ï¼Œå»ºè®®å…ˆopkg updateä¸€ä¸‹ï¼Œå¦‚æœæœ‰å…³è”çš„packageå°±ä¸€èµ·è£…äº†ã€‚&lt;/p&gt;

&lt;p&gt;3)é…ç½®v2rayï¼Œå¯ä»¥æ”¾åœ¨/etc/config/v2ray.json&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;s2&quot;&gt;&quot;outbound&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;protocol&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;vmess&quot;&lt;/span&gt;,
    &lt;span class=&quot;s2&quot;&gt;&quot;tag&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;proxy&quot;&lt;/span&gt;,
    &lt;span class=&quot;s2&quot;&gt;&quot;settings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;vnext&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;s2&quot;&gt;&quot;address&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;VPSçš„ipåœ°å€&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 11111,
          &lt;span class=&quot;s2&quot;&gt;&quot;users&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;s2&quot;&gt;&quot;id&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;ä½ çš„id&quot;&lt;/span&gt;,
              &lt;span class=&quot;s2&quot;&gt;&quot;level&quot;&lt;/span&gt;: 1,
              &lt;span class=&quot;s2&quot;&gt;&quot;alterId&quot;&lt;/span&gt;: 64
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
    &lt;span class=&quot;s2&quot;&gt;&quot;streamSettings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;network&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;kcp&quot;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
    &lt;span class=&quot;s2&quot;&gt;&quot;mux&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;#ä¸å»ºè®®æ‰“å¼€ï¼Œå¦åˆ™ä¼šæ–­æµ&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;enabled&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;outboundDetour&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;protocol&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;freedom&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;settings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;tag&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;direct&quot;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;inbound&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;protocol&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;dokodemo-door&quot;&lt;/span&gt;,
    &lt;span class=&quot;s2&quot;&gt;&quot;listen&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;127.0.0.1&quot;&lt;/span&gt;,
    &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 5353,
    &lt;span class=&quot;s2&quot;&gt;&quot;settings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;address&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;8.8.8.8&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 53,
      &lt;span class=&quot;s2&quot;&gt;&quot;network&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;udp&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;timeout&quot;&lt;/span&gt;: 0,
      &lt;span class=&quot;s2&quot;&gt;&quot;followRedirect&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;inboundDetour&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;#å¦‚æœä½¿ç”¨chinadnsï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥ä¸è¦&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;sniffing&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;enabled&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;destOverride&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;http&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;tls&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;protocol&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;dokodemo-door&quot;&lt;/span&gt;,
       &lt;span class=&quot;s2&quot;&gt;&quot;listen&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;ç½‘å…³çš„lan ipä¾‹å¦‚192.168.1.1ï¼Œå¦‚æœä¸æŒ‡å®šä»…ç›‘å¬lanï¼Œä¼šæœ‰å®‰å…¨æ€§é—®é¢˜&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: 1060,
      &lt;span class=&quot;s2&quot;&gt;&quot;settings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;network&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;tcp&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;timeout&quot;&lt;/span&gt;: 30,
        &lt;span class=&quot;s2&quot;&gt;&quot;followRedirect&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;dns&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;servers&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
       &lt;span class=&quot;s2&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,
       &lt;span class=&quot;s2&quot;&gt;&quot;8.8.8.8&quot;&lt;/span&gt;,
       &lt;span class=&quot;s2&quot;&gt;&quot;1.1.1.1&quot;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;routing&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;strategy&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;rules&quot;&lt;/span&gt;,
    &lt;span class=&quot;s2&quot;&gt;&quot;settings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;domainStrategy&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;IPIfNonMatch&quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;rules&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
           &lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;field&quot;&lt;/span&gt;,
           &lt;span class=&quot;s2&quot;&gt;&quot;ip&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
             &lt;span class=&quot;s2&quot;&gt;&quot;8.8.8.8/32&quot;&lt;/span&gt;,
             &lt;span class=&quot;s2&quot;&gt;&quot;8.8.4.4/32&quot;&lt;/span&gt;,
             &lt;span class=&quot;s2&quot;&gt;&quot;91.108.56.0/22&quot;&lt;/span&gt;,
             &lt;span class=&quot;s2&quot;&gt;&quot;91.108.4.0/22&quot;&lt;/span&gt;,
             &lt;span class=&quot;s2&quot;&gt;&quot;109.239.140.0/24&quot;&lt;/span&gt;,
             &lt;span class=&quot;s2&quot;&gt;&quot;149.154.164.0/22&quot;&lt;/span&gt;,
             &lt;span class=&quot;s2&quot;&gt;&quot;91.108.56.0/23&quot;&lt;/span&gt;,
             &lt;span class=&quot;s2&quot;&gt;&quot;67.198.55.0/24&quot;&lt;/span&gt;,
             &lt;span class=&quot;s2&quot;&gt;&quot;149.154.168.0/22&quot;&lt;/span&gt;,
             &lt;span class=&quot;s2&quot;&gt;&quot;149.154.172.0/22&quot;&lt;/span&gt;
           &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
           &lt;span class=&quot;s2&quot;&gt;&quot;outboundTag&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;proxy&quot;&lt;/span&gt;
         &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
         &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;field&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;domain&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
            &lt;span class=&quot;s2&quot;&gt;&quot;googleapis.cn&quot;&lt;/span&gt;,
    	    &lt;span class=&quot;s2&quot;&gt;&quot;google.cn&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;googleapis&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;google&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;facebook&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;youtube&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;twitter&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;instagram&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;gmail&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;domain:twimg.com&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;domain:t.co&quot;&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;outboundTag&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;proxy&quot;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;field&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;domain&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
            &lt;span class=&quot;s2&quot;&gt;&quot;geosite:cn&quot;&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;outboundTag&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;direct&quot;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;field&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;1-21&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;outboundTag&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;direct&quot;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;field&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;54-79&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;outboundTag&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;direct&quot;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;field&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;81-442&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;outboundTag&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;direct&quot;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;field&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;444-3999&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;outboundTag&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;direct&quot;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;field&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;4001-65535&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;outboundTag&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;direct&quot;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;s2&quot;&gt;&quot;domain&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
            &lt;span class=&quot;s2&quot;&gt;&quot;vultr.com&quot;&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;field&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;outboundTag&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;direct&quot;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;chinasites&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;outboundTag&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;direct&quot;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;field&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;ip&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
            &lt;span class=&quot;s2&quot;&gt;&quot;0.0.0.0/8&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;10.0.0.0/8&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;100.64.0.0/10&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;127.0.0.0/8&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;169.254.0.0/16&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;172.16.0.0/12&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;192.0.0.0/24&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;192.0.2.0/24&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;192.168.0.0/16&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;198.18.0.0/15&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;198.51.100.0/24&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;203.0.113.0/24&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;::1/128&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;fc00::/7&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;fe80::/10&quot;&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;outboundTag&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;direct&quot;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;chinaip&quot;&lt;/span&gt;,
          &lt;span class=&quot;s2&quot;&gt;&quot;outboundTag&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;direct&quot;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&quot;transport&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
     &lt;span class=&quot;s2&quot;&gt;&quot;tcpSettings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;connectionReuse&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
    &lt;span class=&quot;s2&quot;&gt;&quot;kcpSettings&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;mtu&quot;&lt;/span&gt;: 1350,
      &lt;span class=&quot;s2&quot;&gt;&quot;tti&quot;&lt;/span&gt;: 50,
      &lt;span class=&quot;s2&quot;&gt;&quot;uplinkCapacity&quot;&lt;/span&gt;: 100,
      &lt;span class=&quot;s2&quot;&gt;&quot;downlinkCapacity&quot;&lt;/span&gt;: 200,
      &lt;span class=&quot;s2&quot;&gt;&quot;congestion&quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&quot;readBufferSize&quot;&lt;/span&gt;: 2,
      &lt;span class=&quot;s2&quot;&gt;&quot;writeBufferSize&quot;&lt;/span&gt;: 2,
      &lt;span class=&quot;s2&quot;&gt;&quot;header&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;wechat-video&quot;&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;4)æ·»åŠ æ–‡ä»¶/etc/init.d/v2ray,å¡«å†™å¦‚ä¸‹å†…å®¹ï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;c&quot;&gt;#!/bin/sh /etc/rc.common&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Copyright (C) 2017 Ian Li &amp;lt;OpenSource@ianli.xyz&amp;gt;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# This is free software, licensed under the GNU General Public License v3.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# See /LICENSE for more information.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;START&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;90

&lt;span class=&quot;nv&quot;&gt;USE_PROCD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1
&lt;span class=&quot;nv&quot;&gt;LimitNOFILE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1048576
&lt;span class=&quot;nv&quot;&gt;LimitNPROC&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;512

start_service&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;mkdir&lt;/span&gt; /var/log/v2ray &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /dev/null 2&amp;gt;&amp;amp;1
        &lt;span class=&quot;nb&quot;&gt;ulimit&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; 99999
        procd_open_instance
        procd_set_param respawn
        procd_set_param &lt;span class=&quot;nb&quot;&gt;command&lt;/span&gt; /usr/bin/v2ray &lt;span class=&quot;nt&quot;&gt;-config&lt;/span&gt; /etc/config/v2ray.json
        procd_set_param file /etc/config/v2ray.json
        procd_set_param stdout 1
        procd_set_param stderr 1
        procd_set_param pidfile /var/run/v2ray.pid
        procd_close_instance
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;


&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;5)æ·»åŠ æœåŠ¡ï¼Œå¼€æœºè‡ªåŠ¨è¿è¡Œï¼Œå¹¶è¿è¡Œï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;nb&quot;&gt;chmod&lt;/span&gt; +x /etc/init.d/v2ray
/etc/init.d/v2ray &lt;span class=&quot;nb&quot;&gt;enable
&lt;/span&gt;service v2ray start

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;psæŸ¥çœ‹è¿›ç¨‹ï¼Œå¦‚æœå­˜åœ¨ï¼Œå³æ­£å¸¸å¯åŠ¨ã€‚&lt;/p&gt;

&lt;p&gt;6)ä¸¤ç§æ¨¡å¼ï¼Œä»»é€‰ä¸€ç§ï¼š&lt;/p&gt;

&lt;p&gt;a) å¢ƒå¤–å…¨å±€æ¨¡å¼ï¼Œæ‰€æœ‰å¢ƒå¤–ç½‘ç«™å‡æŒ‚ä»£ç†&lt;/p&gt;

&lt;p&gt;æ·»åŠ é˜²ç«å¢™è§„åˆ™(ç›´æ¥æ·»åŠ åˆ°/etc/firewall.user æˆ–è€…luciç•Œé¢ ç½‘ç»œ-&amp;gt;é˜²ç«å¢™ ç¼–è¾‘)ï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-N&lt;/span&gt; V2RAY
iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; V2RAY &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; VPSåœ°å€ &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; RETURN
iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; V2RAY &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; 0.0.0.0/8 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; RETURN
iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; V2RAY &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; 10.0.0.0/8 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; RETURN
iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; V2RAY &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; 127.0.0.0/8 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; RETURN
iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; V2RAY &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; 169.254.0.0/16 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; RETURN
iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; V2RAY &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; 172.16.0.0/12 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; RETURN
iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; V2RAY &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; 192.168.0.0/16 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; RETURN
iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; V2RAY &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; 224.0.0.0/4 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; RETURN
iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; V2RAY &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; 240.0.0.0/4 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; RETURN
iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; V2RAY &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; å†…ç½‘ipæ®µï¼Œä¾‹å¦‚192.168.1.0/24 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; REDIRECT &lt;span class=&quot;nt&quot;&gt;--to-ports&lt;/span&gt; 1060
iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; PREROUTING &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; V2RAY
iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; OUTPUT &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; V2RAY

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;b) gwflistæ¨¡å¼ï¼Œä»…å¯¹gfwlistæŒ‚ä»£ç†ï¼Œæ­¤æ–¹æ³•å¯ä»¥æå‡è·¯ç”±å›½å†…ç½‘ç«™è®¿é—®æ€§èƒ½ï¼ˆå»ºè®®åˆ é™¤v2rayé…ç½®æ–‡ä»¶ä¸­çš„ â€œroutingâ€è·¯ç”±éƒ¨åˆ†ï¼‰è¿˜èƒ½é¿å…p2pä¸‹è½½æ—¶å½±å“è·¯ç”±æ€§èƒ½&lt;/p&gt;

&lt;p&gt;å…ˆå®‰è£…dnsmasq_full&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
opkg update
opkg &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;dnsmasq_full
opkg remove dnsmasq

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;æ·»åŠ é˜²ç«å¢™è§„åˆ™(ç›´æ¥æ·»åŠ åˆ°/etc/firewall.user æˆ–è€…luciç•Œé¢ ç½‘ç»œ-&amp;gt;é˜²ç«å¢™ ç¼–è¾‘)ï¼š&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
ipset &lt;span class=&quot;nt&quot;&gt;-N&lt;/span&gt; gfwlist iphash
iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; PREROUTING &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--match-set&lt;/span&gt; gfwlist dst &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; REDIRECT &lt;span class=&quot;nt&quot;&gt;--to-port&lt;/span&gt; 1060
iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; OUTPUT &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--match-set&lt;/span&gt; gfwlist dst &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; REDIRECT &lt;span class=&quot;nt&quot;&gt;--to-port&lt;/span&gt; 1060
&lt;span class=&quot;c&quot;&gt;#add telegram server&lt;/span&gt;
ipset add gfwlist 93.119.240.0/24
ipset add gfwlist 93.119.241.0/24
ipset add gfwlist 93.119.242.0/24
ipset add gfwlist 93.119.243.0/24
ipset add gfwlist 93.119.244.0/24
ipset add gfwlist 93.119.245.0/24
ipset add gfwlist 93.119.246.0/24
ipset add gfwlist 93.119.247.0/24
ipset add gfwlist 93.119.248.0/24
ipset add gfwlist 93.119.249.0/24
ipset add gfwlist 93.119.250.0/24
ipset add gfwlist 93.119.251.0/24
ipset add gfwlist 93.119.252.0/24
ipset add gfwlist 93.119.253.0/24
ipset add gfwlist 93.119.254.0/24
ipset add gfwlist 93.119.255.0/24
ipset add gfwlist 149.154.172.0/22
ipset add gfwlist 91.108.12.0/22
ipset add gfwlist 149.154.160.0/20
ipset add gfwlist 149.154.164.0/22
ipset add gfwlist 91.108.4.0/22
ipset add gfwlist 91.108.56.0/22
ipset add gfwlist 91.108.8.0/22

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ç¼–è¾‘/etc/dnsmasq.confï¼Œgithubä¸Šæœ‰å¾ˆå¤šè„šæœ¬è‡ªåŠ¨å°†gfwlistè½¬æ¢ä¸ºdnsmasq.confï¼Œä¹Ÿå¯ä»¥ä¸‹ä¸ªç°æˆçš„ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;

&lt;p&gt;https://cokebar.github.io/gfwlist2dnsmasq/dnsmasq_gfwlist_ipset.conf&lt;/p&gt;

&lt;p&gt;å…¶ä¸­éƒ¨åˆ†å†…å®¹ï¼ˆè§„åˆ™ï¼‰ä¸ºï¼š&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;nv&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/030buy.com/127.0.0.1#5353
&lt;span class=&quot;nv&quot;&gt;ipset&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/030buy.com/gfwlist
&lt;span class=&quot;nv&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/0rz.tw/127.0.0.1#5353
&lt;span class=&quot;nv&quot;&gt;ipset&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/0rz.tw/gfwlist
â€¦â€¦

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;7)é…ç½®/etc/dnsmasq.confï¼Œé˜²æ­¢dnsæŸ¥è¯¢æ³„éœ²ï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;nv&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/google.com/127.0.0.1#5353
&lt;span class=&quot;nv&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/google.com.hk/127.0.0.1#5353
&lt;span class=&quot;nv&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/google.com.tw/127.0.0.1#5353
&lt;span class=&quot;nv&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/google.com.sg/127.0.0.1#5353
&lt;span class=&quot;nv&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/google.co.jp/127.0.0.1#5353
&lt;span class=&quot;nv&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/google.co.kr/127.0.0.1#5353
&lt;span class=&quot;nv&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/freeweibo.com/127.0.0.1#5353
&lt;span class=&quot;nv&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/twitter.com/127.0.0.1#5353
&lt;span class=&quot;nv&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/facebook.com/127.0.0.1#5353
&lt;span class=&quot;nv&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/instagram.com/127.0.0.1#5353

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è¿è¡Œï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
/etc/init.d/dnsmasq restart

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;8ï¼‰å®‰è£…å’Œé…ç½®chinadns&lt;/p&gt;

&lt;p&gt;è™½ç„¶v2rayä¹Ÿæœ‰dnsé…ç½®ï¼Œä½†ï¼š&lt;/p&gt;

&lt;p&gt;a.ä¸æ”¯æŒå›ºå®šç«¯å£çš„dnså›½å†…å¤–åˆ†æµï¼ˆdomainoverrideæˆ–sniffingç¡®å®å¯ä»¥é˜²æ­¢æ±¡æŸ“ï¼Œä½†æ˜¯å¶å°”ä¼šæœ‰resetçš„é—®é¢˜ï¼‰&lt;/p&gt;

&lt;p&gt;b.ipåœ°å€åº“è¿‡äºåºå¤§&lt;/p&gt;

&lt;p&gt;c.è¢«å¢™ç½‘ç«™èƒ½ä¸Šä½†pingä¸é€šï¼ˆå¯¹äºdnsæ±¡æŸ“çš„ç½‘å€ï¼Œå­ç½‘æ‹¿ä¸åˆ°çœŸå®ipï¼‰&lt;/p&gt;

&lt;p&gt;å› æ­¤è¿˜æ˜¯ä½¿ç”¨chinadnsã€‚&lt;/p&gt;

&lt;p&gt;é¦–å…ˆå®‰è£…chinadns (ç›´æ¥å»githubä¸‹è½½å¯¹åº”å®‰è£…åŒ…)ï¼š&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
opkg update
opkg &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;chinadns

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å…¶æ¬¡ç™»é™†luciç•Œé¢ï¼š&lt;/p&gt;

&lt;p&gt;a.æœåŠ¡-&amp;gt;chinadnsè®¾ç½®&lt;/p&gt;

&lt;p&gt;â€˜å¯ç”¨å‹ç¼©æŒ‡é’ˆâ€™å‹¾æ‰“ä¸Šï¼Œ&lt;/p&gt;

&lt;p&gt;â€˜å¯ç”¨åŒå‘è¿‡æ»¤â€™å‹¾å»æ‰ï¼Œ&lt;/p&gt;

&lt;p&gt;â€˜ä¸Šæ¸¸æœåŠ¡å™¨â€™æ”¹æˆ114.114.114.114,127.0.0.1:5353ï¼Œ&lt;/p&gt;

&lt;p&gt;æ³¨ï¼š5353ä¹Ÿå¯ä»¥æ”¹æˆdns forwardç›‘å¬ç«¯å£ï¼Œè¿™æ ·èµ°tcpæŸ¥dns&lt;/p&gt;

&lt;p&gt;chinadnsçš„ç›‘å¬ç«¯å£ä¸º5454ï¼Œæ‰“å‹¾å¯ç”¨&lt;/p&gt;

&lt;p&gt;ç›‘å¬åœ°å€ä¸º127.0.0.1&lt;/p&gt;

&lt;p&gt;b.ç½‘ç»œ-&amp;gt;dhcp/dnsè®¾ç½®&lt;/p&gt;

&lt;p&gt;åŸºæœ¬è®¾ç½®-&amp;gt;dnsè½¬å‘ é‡Œé¢è®¾ç½®ä¸º&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
127.0.0.1#5454
127.0.0.1#5454
127.0.0.1#5454
127.0.0.1#5454

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¡«4ä¸ªæ˜¯ä¸ºäº†ä¿è¯ç¨³å®šæ€§ï¼Œå¦åˆ™ç»å¸¸ä¼šå‡ºç°è§£æå¤±è´¥å¯¼è‡´ç½‘é¡µæ— æ³•æ‰“å¼€&lt;/p&gt;

&lt;p&gt;c.åŸºæœ¬è®¾ç½®-&amp;gt;hostå’Œè§£ææ–‡ä»¶&lt;/p&gt;

&lt;p&gt;å¿½ç•¥è§£ææ–‡ä»¶ æ‰“é’©&lt;/p&gt;

&lt;p&gt;å¿½ç•¥HOSTSæ–‡ä»¶ æ‰“é’©&lt;/p&gt;

&lt;p&gt;9)é‡å¯é˜²ç«å¢™/è·¯ç”±å³å¯&lt;/p&gt;

&lt;p&gt;æ³¨æ„ï¼šå¦‚æœä¹‹å‰é…ç½®è¿‡ss+dnsforwarder+chinadnsï¼Œå»ºè®®é‡æ–°åˆ·æœºæˆ–è€…åˆ é™¤æ‰€æœ‰é…ç½®åé‡æ–°é…ç½®ï¼Œå¦åˆ™ä¼šæœ‰å†²çªã€‚
å¦å¤–å»ºè®®åœ¨/etc/sysctl.confå¢åŠ ï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
fs.file-max&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;90000

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¹‹å‰è²Œä¼¼è¿è¡Œæ—¶é—´ä¸€ä¹…ï¼Œä¼šå‡ºç° too many open files çš„æç¤ºï¼Œç”¨ä¸Šè¿°åŠæ³•ï¼ˆåŒ…æ‹¬/etc/init.d/v2ray çš„å‚æ•°/å‘½ä»¤è®¾ç½®ï¼‰åæ²¡æœ‰å‡ºç°æ­¤ç±»é—®é¢˜ã€‚&lt;/p&gt;

&lt;p&gt;æ­¤å¤–å›½å†…éƒ¨åˆ†è¿è¥å•†å¯¹kcpæœ‰qosï¼Œç—‡çŠ¶æ˜¯æ¯éš”ä¸€æ®µæ—¶é—´ï¼Œä¼šå‡ºç°æ–­æµï¼Œä¹Ÿå°±æ˜¯åå‡ æˆ–å‡ ååˆ†é’Ÿåï¼Œé—´æ­‡å‡ºç°ä¸èƒ½ä¸Šå¤–ç½‘çš„æƒ…å†µã€‚ã€‚ã€‚è¿™ä¸€ç‚¹å·²ç»éªŒè¯ã€‚è§£å†³æ–¹æ¡ˆæ˜¯â€”â€”ç”¨v2rayè´Ÿè½½å‡è¡¡,ä½†ä¸èƒ½å®Œå…¨è§£å†³ã€‚ã€‚ã€‚æ¢è¿è¥å•†æ˜¯ç‹é“ã€‚ã€‚ã€‚&lt;/p&gt;

&lt;p&gt;å‚è€ƒèµ„æ–™ï¼š&lt;/p&gt;

&lt;p&gt;1).https://blog.dreamtobe.cn/r7800-openwrt-v2ray/&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>åœ¨Openwrt/Ledeè·¯ç”±ä¸Šå®ç°åŸºäºName.com V4ç‰ˆæœ¬APIçš„å¿«é€Ÿæ›´æ–°çš„DDNS</title>
   <link href="https://jibenfa.github.io/openwrt/2018/02/28/e59ca8openwrt-ledee8b7afe794b1e4b88ae5ae9ee78eb0e59fbae4ba8ename-com-v4e78988e69cacapie79a84ddns/"/>
   <updated>2018-02-28T22:21:35+00:00</updated>
   <id>https://jibenfa.github.io/openwrt/2018/02/28/e59ca8openwrt-ledee8b7afe794b1e4b88ae5ae9ee78eb0e59fbae4ba8ename-com-v4e78988e69cacapie79a84ddns</id>
   <content type="html">&lt;p&gt;ä¹‹å‰ä¸€ç›´ç”¨èŠ±ç”Ÿå£³çš„å…è´¹DDNSï¼Œä½†æ˜¯æœ€è¿‘ä¸€å‘¨ä¸çŸ¥é“ä¸ºå•¥ï¼ŒæœåŠ¡è€æ˜¯æŠ½é£ï¼Œdnsæ›´æ–°é€Ÿåº¦æ˜æ˜¾ä¸‹é™ï¼Œç”šè‡³è¾¾åˆ°1-2å¤©ã€‚äºæ˜¯ç ”ç©¶äº†ä¸€ä¸‹ï¼Œå‘ç°name.comæœ€è¿‘å‘å¸ƒäº†v4ç‰ˆæœ¬çš„apiï¼Œçœ‹äº†æ–‡æ¡£ä»¥åï¼Œæœæ–­å†™äº†ä¸ªè„šæœ¬ï¼Œä¸€æ—¦ipå˜æ›´ï¼Œæ–°dnså¯ä»¥é©¬ä¸Šæ›´æ–°ï¼Œæ¶ˆè€—æ—¶é—´æ— é™æ¥è¿‘0ã€‚ã€‚ã€‚äºæ˜¯ddnsæ›´æ–°æ—¶é—´åªåŸºäºè®¡åˆ’ä»»åŠ¡çš„é—´éš”æ—¶é—´äº†ã€‚ã€‚ã€‚&lt;br /&gt;
ä½¿ç”¨æ­¤è„šæœ¬çš„å‰æï¼š&lt;br /&gt;
1.åŸŸåå¿…é¡»æ˜¯ç”±name.comè´­ä¹°çš„ï¼Œå¹¶ä¸”ç”Ÿæˆä¸€ä¸ªç”Ÿäº§çš„Tokenã€‚&lt;br /&gt;
2.ç™»é™†è´¦æˆ·å¿…é¡»æ²¡æœ‰å¼€å¯äºŒæ¬¡éªŒè¯ï¼Œå¦åˆ™apiä¼šæç¤ºé”™è¯¯ï¼šAccout has Namesafe enabled. ï¼ˆæ³¨æ„è¿™é‡Œaccountæ‹¼å†™è¿˜æ˜¯é”™çš„ã€‚ã€‚å·²å‘ticketç»™name.comï¼‰ã€‚&lt;br /&gt;
3.è·¯ç”±ä¸Šéœ€è¦å®‰è£…curlå’Œca-certificateså’Œca-bundle,ä»¥ä¾¿è§£æhttpsã€‚&lt;br /&gt;
4.é¦–æ¬¡éœ€è¦æ‰‹åŠ¨æ·»åŠ ä¸€æ¬¡åŸŸåï¼Œä»¥ä¾¿è·å–IDå·ç ï¼Œä¾‹å¦‚ä¸ºwww.examle.comæ·»åŠ ç¬¬ä¸€ä¸ªdnsè®°å½•ï¼š&lt;br /&gt;
&lt;!--more--&gt;&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;curl &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;YOUR_USER_NAME:YOUR_API_TOKEN&apos;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;https://api.name.com/v4/domains/example.com/records&apos;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-X&lt;/span&gt; POST &lt;span class=&quot;nt&quot;&gt;--data&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;{&quot;host&quot;:&quot;www&quot;,&quot;type&quot;:&quot;A&quot;,&quot;answer&quot;:&quot;YOUR_IP&quot;,&quot;ttl&quot;:300}&apos;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä»è¿”å›çš„jsoné‡Œé¢è®°å½•ä¸‹idï¼Œjsonæ ¼å¼ä¸ºï¼š&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;id&quot;&lt;/span&gt;: 12345,
    &lt;span class=&quot;s2&quot;&gt;&quot;domainName&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;example.org&quot;&lt;/span&gt;,
    &lt;span class=&quot;s2&quot;&gt;&quot;host&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;www&quot;&lt;/span&gt;,
    &lt;span class=&quot;s2&quot;&gt;&quot;fqdn&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;www.example.org&quot;&lt;/span&gt;,
    &lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;A&quot;&lt;/span&gt;,
    &lt;span class=&quot;s2&quot;&gt;&quot;answer&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;10.0.0.1&quot;&lt;/span&gt;,
    &lt;span class=&quot;s2&quot;&gt;&quot;ttl&quot;&lt;/span&gt;: 300
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ­¤idè¦å†™å…¥è„šæœ¬ã€‚&lt;/p&gt;

&lt;p&gt;åç»­å°±å¯ä»¥é€šè¿‡å¦‚ä¸‹è„šæœ¬æ›´æ–°dnsäº†ã€‚&lt;br /&gt;
è„šæœ¬å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#&lt;span class=&quot;p&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/bin/&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sh&lt;/span&gt;

USER&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;YOUR_USER_NAME&quot;&lt;/span&gt;
TOKEN&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;YOUR_API_TOKEN&quot;&lt;/span&gt;
ID&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;YOUR_URL_ID&quot;&lt;/span&gt;
HOST&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;www&quot;&lt;/span&gt;
DOMAIN&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;example.com&quot;&lt;/span&gt;
URL&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;$&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;HOST&lt;span class=&quot;p&quot;&gt;}.&lt;/span&gt;$&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;DOMAIN&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
IP&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;`ping $&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;URL&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;awk &lt;span class=&quot;s1&quot;&gt;&apos;NR==2 {print $4}&apos;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;awk &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;F &lt;span class=&quot;s1&quot;&gt;&apos;:&apos;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;{print $1}&apos;&lt;/span&gt;`
#å¦‚æœå®‰è£…äº†digä¹Ÿå¯ä»¥è¿™æ ·
#IP&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;`&lt;span class=&quot;k&quot;&gt;dig&lt;/span&gt; $&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;DOMAIN&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; @&lt;span class=&quot;m&quot;&gt;114&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;114&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;114&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;114&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; awk &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;F &lt;span class=&quot;s2&quot;&gt;&quot;[ ]+&quot;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;/IN/{print $1}&apos;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; awk &lt;span class=&quot;s1&quot;&gt;&apos;NR==2 {print $5}&apos;&lt;/span&gt;`
echo &lt;span class=&quot;s2&quot;&gt;&quot;Ip of ${URL} is ${IP}&quot;&lt;/span&gt;
LIP&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;`ifconfig pppoe&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;wan&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;awk &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;F &lt;span class=&quot;s2&quot;&gt;&quot;[: ]+&quot;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;/inet addr/{print $4}&apos;&lt;/span&gt;`
echo &lt;span class=&quot;s2&quot;&gt;&quot;Local Ip is ---${LIP}---&quot;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;${LIP}&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;${IP}&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;; then
   &lt;span class=&quot;k&quot;&gt;exit&lt;/span&gt;
fi

echo &lt;span class=&quot;s2&quot;&gt;&quot;start ddns refresh&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;${LIP}&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;; then
   curl &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;u&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;$&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;USER&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;:&apos;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;$&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;TOKEN&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;https://api.name.com/v4/domains/&apos;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;$&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;DOMAIN&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;/records/&apos;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;$&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;ID&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;X PUT &lt;span class=&quot;p&quot;&gt;--&lt;/span&gt;data &lt;span class=&quot;s1&quot;&gt;&apos;{&quot;host&quot;:&quot;&apos;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;$&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;HOST&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;&quot;,&quot;type&quot;:&quot;A&quot;,&quot;answer&quot;:&quot;&apos;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;$&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;LIP&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;&quot;,&quot;ttl&quot;:300}&apos;&lt;/span&gt;
   echo $&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;LIP&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;/tmp/&lt;/span&gt;ddnsResult
fi
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å‚è€ƒèµ„æ–™ï¼š&lt;br /&gt;
1.https://www.name.com/api-docs/&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>ä½¿ç”¨LEDE/OPENWRT è·¯ç”±å™¨è‡ªåŠ¨å‘é€é‚®ä»¶</title>
   <link href="https://jibenfa.github.io/openwrt/2018/01/30/e4bdbfe794a8ledeopenwrt-e8b7afe794b1e599a8e887aae58aa8e58f91e98081e982aee4bbb6/"/>
   <updated>2018-01-30T22:32:10+00:00</updated>
   <id>https://jibenfa.github.io/openwrt/2018/01/30/e4bdbfe794a8ledeopenwrt-e8b7afe794b1e599a8e887aae58aa8e58f91e98081e982aee4bbb6</id>
   <content type="html">&lt;p&gt;ä»Šå¤©ç ”ç©¶å®ç°äº†æ‰‹åŠ¨æˆ–è€…å®šæ—¶è‡ªåŠ¨é€šè¿‡LEDE/openwrtè·¯ç”±å¯¹å¤–å‘é€é‚®ä»¶çš„åŠŸèƒ½ã€‚&lt;br /&gt;
1.å®‰è£…è½¯ä»¶åŒ…ã€‚&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;opkg update
opkg &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;mutt ssmtp ca-certificates ca-bundle
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2.é…ç½®ssmtp&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;vi /etc/ssmtp/ssmtp.conf

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å†…å®¹ä¸ºï¼š&lt;br /&gt;
&lt;!--more--&gt;&lt;/p&gt;

&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#
# &lt;span class=&quot;sr&quot;&gt;/etc/&lt;/span&gt;ssmtp&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;conf&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;--&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;a&lt;/span&gt; config &lt;span class=&quot;k&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; sSMTP sendmail&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;
#

# The person who gets &lt;span class=&quot;k&quot;&gt;all&lt;/span&gt; mail &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; userids &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1000&lt;/span&gt;
# Make this &lt;span class=&quot;nb&quot;&gt;empty&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;to&lt;/span&gt; disable rewriting&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;
root&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;MY@TEST&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;com&lt;/span&gt;

# The place where the mail goes&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; The actual machine name &lt;span class=&quot;k&quot;&gt;is&lt;/span&gt; required
# no MX records are consulted&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; Commonly mailhosts are named mail&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;domain&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;com&lt;/span&gt;
# The example will fit &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; you are &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; domain&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;com&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;and&lt;/span&gt; your mailhub &lt;span class=&quot;k&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;so&lt;/span&gt; named&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;
# ä¸åŒé‚®ç®±ä¾›åº”å•†çš„é…ç½®ä¸åŒï¼Œéœ€æŸ¥é˜…ä¾›åº”å•†æ‰‹å†Œ
mailhub&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;smtp&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;TEST&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;com&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;465&lt;/span&gt;

# Example &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; SMTP port &lt;span class=&quot;k&quot;&gt;number&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2525&lt;/span&gt;
# mailhub&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;mail&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;your&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;domain&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2525&lt;/span&gt;
# Example &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; SMTP port &lt;span class=&quot;k&quot;&gt;number&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;Standard/RFC&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
# mailhub&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;mail&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;your&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;domain
# Example &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; SSL encrypted connection
# mailhub&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;mail&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;your&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;domain&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;465&lt;/span&gt;

# Where will the mail seem &lt;span class=&quot;k&quot;&gt;to&lt;/span&gt; come from?
rewriteDomain&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;TEST&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;com&lt;/span&gt;

# The full &lt;span class=&quot;nb&quot;&gt;hostname&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;hostname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;TEST&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;com&lt;/span&gt;

# Set this &lt;span class=&quot;k&quot;&gt;to&lt;/span&gt; never rewrite the &lt;span class=&quot;s2&quot;&gt;&quot;From:&quot;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;line&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;unless not given&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;to&lt;/span&gt;
# use that address &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; the &lt;span class=&quot;s2&quot;&gt;&quot;from line&quot;&lt;/span&gt; of the envelope&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;
FromLineOverride&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;YES

# Use SSL/TLS &lt;span class=&quot;k&quot;&gt;to&lt;/span&gt; send &lt;span class=&quot;nb&quot;&gt;secure&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;messages&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;to&lt;/span&gt; server&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;
UseTLS&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;YES

# Use SSL/TLS certificate &lt;span class=&quot;k&quot;&gt;to&lt;/span&gt; authenticate against smtp host&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;
#UseTLSCert&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;YES

# Use this RSA certificate&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;
#TLSCert&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/etc/&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ssl&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/certs/&lt;/span&gt;ssmtp&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;pem

# Get enhanced &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;*really* enhanced&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; debugging information &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; the logs
# If you want &lt;span class=&quot;k&quot;&gt;to&lt;/span&gt; have debugging of the config &lt;span class=&quot;k&quot;&gt;file&lt;/span&gt; parsing&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;move&lt;/span&gt; this option
# &lt;span class=&quot;k&quot;&gt;to&lt;/span&gt; the &lt;span class=&quot;nb&quot;&gt;top&lt;/span&gt; of the config &lt;span class=&quot;k&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;and&lt;/span&gt; uncomment
#Debug&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;YES

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç„¶åï¼š&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;vi /etc/ssmtp/revaliases
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å†…å®¹ä¸ºï¼š&lt;/p&gt;

&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# sSMTP aliases
#
# Format&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;       local_account&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;outgoing_address&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;mailhub
#
# Example&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; root&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;your_login@your&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;domain&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;mailhub&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;your&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;domain&lt;span class=&quot;p&quot;&gt;[:&lt;/span&gt;port&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
# where &lt;span class=&quot;p&quot;&gt;[:&lt;/span&gt;port&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;is&lt;/span&gt; an optional port &lt;span class=&quot;k&quot;&gt;number&lt;/span&gt; that defaults &lt;span class=&quot;k&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;25&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;
root&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;MY@TEST&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;com&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;smtp&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;TEST&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;com&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;465&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3.é…ç½®mutt&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;vi ~/.muttrc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å†…å®¹ä¸ºï¼š&lt;/p&gt;

&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mailboxes &lt;span class=&quot;sr&quot;&gt;/tmp/&lt;/span&gt;mail
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; sendmail&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ssmtp -v -auMY@TEST.com -apMYPASSWORD&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; from&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;MY@TEST.com&quot;&lt;/span&gt;
# Mail folder setup&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; folder&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/tmp/&lt;/span&gt;mail
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; mbox_type&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;mbox
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; spoolfile&lt;span class=&quot;p&quot;&gt;=+&lt;/span&gt;inbox
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; mbox&lt;span class=&quot;p&quot;&gt;=+&lt;/span&gt;received
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; postponed&lt;span class=&quot;p&quot;&gt;=+&lt;/span&gt;postponed
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; record&lt;span class=&quot;p&quot;&gt;=+&lt;/span&gt;sent
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;4.ç¼–å†™è„šæœ¬sendmail.sh&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;vi ./sendmail.sh
&lt;span class=&quot;nb&quot;&gt;chmod&lt;/span&gt; +x ./sendmail.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å†…å®¹ä¸ºï¼š&lt;/p&gt;

&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;/tmp/&lt;/span&gt;mail
&lt;span class=&quot;k&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;/tmp/&lt;/span&gt;sysinfo/model &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; mutt  &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;s &lt;span class=&quot;s2&quot;&gt;&quot;Mail from Router of Coffeecat&quot;&lt;/span&gt;  receiver@TEST&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;com&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;attachment.txt&apos;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç„¶åè¿è¡Œï¼š&lt;br /&gt;
./sendmail.sh&lt;br /&gt;
å°±å¯ä»¥çœ‹åˆ°ç»“æœäº†ï¼ˆå¦‚æœæ˜¯ä»vip.qq.comå‘é€çš„è¯ï¼‰ï¼š&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&amp;lt;-] 220 smtp.qq.com Esmtp QQ Mail Server
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;] EHLO vip.qq.com
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&amp;lt;-] 250 8BITMIME
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;] AUTH LOGIN
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&amp;lt;-] 334 XXYlcm5hbDF6
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;] Z2FyACDDbTT4dBB2aXAucWSuY29t
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&amp;lt;-] 334 REWzc3dverH6
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&amp;lt;-] 235 Authentication successful
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;] MAIL FROM:&amp;lt;MY@TEST.com&amp;gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&amp;lt;-] 250 Ok
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;] RCPT TO:&amp;lt;reciever@TEST.com&amp;gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&amp;lt;-] 250 Ok
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;] DATA
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&amp;lt;-] 354 End data with &amp;lt;CR&amp;gt;&amp;lt;LF&amp;gt;.&amp;lt;CR&amp;gt;&amp;lt;LF&amp;gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;] Received: by vip.qq.com &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;sSMTP sendmail emulation&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; Tue, 30 Jan 2018 22:25:31 +0800
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;] Date: Tue, 30 Jan 2018 22:25:31 +0800
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;] From: root &amp;lt;MY@TEST.com&amp;gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;] To: reciever@TEST.com
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;] Subject: Mail from Router of Coffeecat
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;] Message-ID: &amp;lt;20180130142531.GA1968@Exciting.lan&amp;gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;] MIME-Version: 1.0
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;] Content-Type: multipart/mixed&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;boundary&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Nq2Wo0NMKNjxTN9z&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;] Content-Disposition: inline
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;] User-Agent: Mutt/1.9.2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2017-12-15&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;]
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;]
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;] &lt;span class=&quot;nt&quot;&gt;--Nq2Wo0NMKNjxTN9z&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;] Content-Type: text/plain&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;charset&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;us-ascii
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;] Content-Disposition: inline
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;]
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;] HiWiFi HC5962
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;]
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;] &lt;span class=&quot;nt&quot;&gt;--Nq2Wo0NMKNjxTN9z&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;] Content-Type: text/plain&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;charset&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;us-ascii
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;] Content-Disposition: attachment&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;maclist.txt&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;] .......
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;]
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;] &lt;span class=&quot;nt&quot;&gt;--Nq2Wo0NMKNjxTN9z--&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;] &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&amp;lt;-] 250 Ok: queued as
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;gt;] QUIT
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&amp;lt;-] 221 Bye
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
</content>
 </entry>
 
 <entry>
   <title>å¼€å…³openwrt/ledeè·¯ç”±ä¸Šçš„usbè®¾å¤‡ç”µæº</title>
   <link href="https://jibenfa.github.io/openwrt/2017/10/11/e5bc80e585b3openwrtledee8b7afe794b1e4b88ae79a84usbe8aebee5a487e794b5e6ba90/"/>
   <updated>2017-10-11T22:25:43+00:00</updated>
   <id>https://jibenfa.github.io/openwrt/2017/10/11/e5bc80e585b3openwrtledee8b7afe794b1e4b88ae79a84usbe8aebee5a487e794b5e6ba90</id>
   <content type="html">&lt;p&gt;æœ€è¿‘æäº†ä¸ªåä¸ºçš„usbæ— çº¿ç½‘å¡E8372æ’åœ¨ledeè·¯ç”±ä¸Šï¼Œä½†æ˜¯æƒ³å®ç°ç¨‹åºæ§åˆ¶å…¶ä¾›ç”µï¼ŒæŸ¥é˜…èµ„æ–™åå‘ç°å¯ä»¥è¿™æ ·å®ç°ï¼š&lt;br /&gt;
é¦–å…ˆï¼š&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; /sys/class/gpio/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-vim highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;export&lt;/span&gt;      gpiochip32  unexport    usb3power
gpiochip0   gpiochip64  usb2power
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç”±äºç½‘å¡æ˜¯æ’åœ¨usb3çš„å£ä¸Šã€‚&lt;br /&gt;
äºæ˜¯ï¼š&lt;br /&gt;
è¦æ‰“å¼€ç½‘å¡ç”µæºï¼š&lt;br /&gt;
echo 1 &amp;gt; /sys/class/gpio/usb3power/value&lt;br /&gt;
è¦å…³é—­ç½‘å¡ç”µæºï¼š&lt;br /&gt;
echo 0 &amp;gt; /sys/class/gpio/usb3power/value&lt;/p&gt;

&lt;p&gt;ä¸Šè¿°æ–¹æ³•å¯ä»¥åˆ©ç”¨ç½‘å¡æ–­ç”µé‡å¯æ¥è§£å†³å› å¼€æœºæ—¶ç½‘å¡å¯åŠ¨æ…¢äºè·¯ç”±å¯åŠ¨ï¼Œå¯¼è‡´eth1 interfaceä¸èƒ½æ­£å¸¸upçš„é—®é¢˜ã€‚&lt;/p&gt;

&lt;p&gt;å‚è€ƒèµ„æ–™ï¼š&lt;br /&gt;
https://wiki.openwrt.org/doc/howto/usb.overview&lt;/p&gt;
</content>
 </entry>
 

</feed>
